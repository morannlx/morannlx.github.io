

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/android-chrome-192x192.png">
  <link rel="icon" href="/images/android-chrome-192x192.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#A593E0">
  <meta name="author" content="å¢¨æŸ“_nlx">
  <meta name="keywords" content="InkDyeing,åˆ·æœº,ç©æœº">
  
    <meta name="description" content="åŸæ–‡ä½œè€… XiaoleGunï¼Œå› ä¸ºåŸä½œè€…åšå®¢å¯„äº†æ•…æ¬è¿è‡³åšå®¢ä¾›è‡ªå·±å­¦ä¹ å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree ä¸€äº›è‡ªåº è¿™ç¯‡æ•™ç¨‹ä¸­å¯èƒ½æœ‰äº›ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·å„ä½æŒ‡æ­£ï¼Œæˆ‘ä¹Ÿåˆšæ¥è§¦ Android è®¾å¤‡æµ‹å¼€å‘ä¸¤å¹´ï¼Œè€Œä¸”åªæœ‰åœ¨èŠ‚å‡æ—¥çš„æ—¶å€™æœ‰ç©ºä¸€ä¸ªäººçæ£é¼“ï¼Œä¸ºäº†è–… mjw ç¾Šæ¯›ï¼Œæ•…å†™è¿™ç¯‡æ•™ç¨‹ï¼Œè€Œä¸”æˆ‘ä¸ªäººæ›´æ¨è Aosp Recovery åˆ·å†™ç¬¬ä¸‰æ–¹ ROMï¼ŒTWRP å¯èƒ½">
<meta property="og:type" content="article">
<meta property="og:title" content="ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree">
<meta property="og:url" content="https://moranwp.eu.org/writing-device-tree-twrp.html">
<meta property="og:site_name" content="InkDyeing">
<meta property="og:description" content="åŸæ–‡ä½œè€… XiaoleGunï¼Œå› ä¸ºåŸä½œè€…åšå®¢å¯„äº†æ•…æ¬è¿è‡³åšå®¢ä¾›è‡ªå·±å­¦ä¹ å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree ä¸€äº›è‡ªåº è¿™ç¯‡æ•™ç¨‹ä¸­å¯èƒ½æœ‰äº›ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·å„ä½æŒ‡æ­£ï¼Œæˆ‘ä¹Ÿåˆšæ¥è§¦ Android è®¾å¤‡æµ‹å¼€å‘ä¸¤å¹´ï¼Œè€Œä¸”åªæœ‰åœ¨èŠ‚å‡æ—¥çš„æ—¶å€™æœ‰ç©ºä¸€ä¸ªäººçæ£é¼“ï¼Œä¸ºäº†è–… mjw ç¾Šæ¯›ï¼Œæ•…å†™è¿™ç¯‡æ•™ç¨‹ï¼Œè€Œä¸”æˆ‘ä¸ªäººæ›´æ¨è Aosp Recovery åˆ·å†™ç¬¬ä¸‰æ–¹ ROMï¼ŒTWRP å¯èƒ½">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-11-11T12:04:32.271Z">
<meta property="article:modified_time" content="2025-11-11T12:06:08.653Z">
<meta property="article:author" content="å¢¨æŸ“_nlx">
<meta property="article:tag" content="åˆ·æœº">
<meta property="article:tag" content="twrp">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree - InkDyeing</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/more.css">
<link rel="stylesheet" href="/css/shubiao.css">
<link rel="stylesheet" href="/css/maoboli.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"moranwp.eu.org","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":65,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2,"iconfont":"//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":21681809,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  
    <!-- 51.la Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript('//js.users.51.la/21681809.js');
      }
    </script>
  

  

  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Ink  Dyeing</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/remark/">
                
                <span>ç•™è¨€æ¿</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/images/none.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-11-11 20:04" pubdate>
          2025å¹´11æœˆ11æ—¥ æ™šä¸Š
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          44k å­—
        
      </span>
    

    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree</h1>
            
              <p class="note note-info">
                
                  
                    æœ¬æ–‡æœ€åæ›´æ–°äºï¼š1 åˆ†é’Ÿå‰
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="åŸæ–‡ä½œè€…-XiaoleGunï¼Œå› ä¸ºåŸä½œè€…åšå®¢å¯„äº†æ•…æ¬è¿è‡³åšå®¢ä¾›è‡ªå·±å­¦ä¹ å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤"><a href="#åŸæ–‡ä½œè€…-XiaoleGunï¼Œå› ä¸ºåŸä½œè€…åšå®¢å¯„äº†æ•…æ¬è¿è‡³åšå®¢ä¾›è‡ªå·±å­¦ä¹ å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤" class="headerlink" title="åŸæ–‡ä½œè€… XiaoleGunï¼Œå› ä¸ºåŸä½œè€…åšå®¢å¯„äº†æ•…æ¬è¿è‡³åšå®¢ä¾›è‡ªå·±å­¦ä¹ å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤"></a>åŸæ–‡ä½œè€… XiaoleGunï¼Œå› ä¸ºåŸä½œè€…åšå®¢å¯„äº†æ•…æ¬è¿è‡³åšå®¢ä¾›è‡ªå·±å­¦ä¹ å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤</h1><p>ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree</p>
<p>ä¸€äº›è‡ªåº</p>
<p>è¿™ç¯‡æ•™ç¨‹ä¸­å¯èƒ½æœ‰äº›ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·å„ä½æŒ‡æ­£ï¼Œæˆ‘ä¹Ÿåˆšæ¥è§¦ Android è®¾å¤‡æµ‹å¼€å‘ä¸¤å¹´ï¼Œè€Œä¸”åªæœ‰åœ¨èŠ‚å‡æ—¥çš„æ—¶å€™æœ‰ç©ºä¸€ä¸ªäººçæ£é¼“ï¼Œä¸ºäº†<del>è–… mjw ç¾Šæ¯›</del>ï¼Œæ•…å†™è¿™ç¯‡æ•™ç¨‹ï¼Œè€Œä¸”æˆ‘ä¸ªäººæ›´æ¨è Aosp Recovery åˆ·å†™ç¬¬ä¸‰æ–¹ ROMï¼ŒTWRP å¯èƒ½å¤šå¤šå°‘å°‘æœ‰äº›é—®é¢˜ã€‚Root ä¹‹ç±»çš„ä¸éœ€è¦ TWRP ä¹Ÿå¯ä»¥ï¼Œå¯ä»¥æ‰¾åˆ°åŸæœº boot ä½¿ç”¨ Magisk è¿›è¡Œä¿®è¡¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ KernelSUã€‚å¦å¤–æˆ‘çš„è¯­æ–‡åŠŸåº•ä¸æ˜¯å¾ˆå¥½ï¼Œå†™ä¸å‡ºè¾è—»ï¼Œåªèƒ½æ˜¯åŒ—æ–¹åœ°é“çš„å¤§ç™½è¯ï¼Œè§è°…å“ˆ ğŸ¤£&#x2F;&#x2F;&#x2F;</p>
<p>å‡†å¤‡å·¥ä½œ</p>
<ol>
<li>ä¸€é¢—å‹‡æ•¢çš„ã€ä¸æ€•å›°éš¾çš„å¼ºå¤§å¿ƒè„ã€‚ <del>ä¸¤é¢—å¿ƒå¥½å‹‡æ•¢ â€“ Falling in love</del></li>
<li>ç”µè„‘é…ç½®:</li>
</ol>
<p>ç¡¬ä»¶ éœ€æ±‚<br>CPU å››æ ¸æˆ–æ›´å¤š<br>å†…å­˜ 8G æˆ–æ›´å¤š<br>ç¡¬ç›˜ è‡³å°‘ 80G ç©ºä½™ç©ºé—´<br>ç³»ç»Ÿ WSL æˆ–å®ä½“ Linuxï¼Œå»ºè®® Debian ç³»</p>
<ol>
<li>è¶³å¤Ÿçš„ç©ºé—²æ—¶é—´ã€‚</li>
<li>Vscode å’Œ ğŸ¤Linux çŸ¥è¯†å‚¨å¤‡</li>
<li>ä¸€å°å®Œå¥½æ— æŸçš„æ–°è®¾å¤‡ã€‚</li>
<li>è®¾å¤‡åŸå‚çš„ boot&#x2F;recovery&#x2F;vendor_boot é•œåƒã€‚(æ¨è recovery åˆ†åŒºï¼Œå› ä¸ºé‡Œé¢åŒ…å«ä¸€äº›å¯åŠ¨å¿…é¡»çš„.rc(run command)ï¼Œå¦‚æœæ²¡æœ‰è¯¥åˆ†åŒºï¼Œå¯»æ‰¾åŒ…å«å®˜æ–¹ recovery å†…å®¹çš„åˆ†åŒºã€‚å€¼å¾—æ³¨æ„çš„æ˜¯éƒ¨åˆ†è®¾å¤‡ recovery åˆå¹¶åˆ°äº† boot ä¸­ï¼Œæˆ–æ˜¯å­˜åœ¨äº vendor_bootï¼‰</li>
<li>æŸ¥çœ‹è‡ªå·±çš„è®¾å¤‡å‡ºå‚ Android ç‰ˆæœ¬å¹¶ç¡®å®šç”¨é€”ï¼Œæ˜¯ç”¨äºå®˜æ–¹ ROM è¿˜æ˜¯ç¬¬ä¸‰æ–¹ç±»åŸç”Ÿã€‚å‡ºå‚ç‰ˆæœ¬ä¸º 9 åŠä»¥ä¸Šçš„å¯ä»¥ä½¿ç”¨ twrp-11 åŠä»¥ä¸Šåˆ†æ”¯ï¼Œ9 ä»¥ä¸‹ä½¿ç”¨ twrp-9 åˆ†æ”¯ã€‚</li>
</ol>
<p>é…ç½®ç¯å¢ƒ</p>
<p>å®‰è£…ä¾èµ–</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt update<br>sudo apt-get install bc bison build-essential ccache curl flex g++-multilib gcc-multilib git gnupg gperf imagemagick lib32ncurses5-dev lib32readline-dev lib32z1-dev liblz4-tool libncurses5 libncurses5-dev libsdl1.2-dev libssl-dev libxml2 libxml2-utils lzop pngcrush rsync schedtool squashfs-tools xsltproc zip zlib1g-dev xattr openjdk-11-jdk jq android-sdk-libsparse-utils python3 python2 repo<br></code></pre></td></tr></table></figure>

<p>å¿…è¦æ—¶å¯ä»¥é˜…è¯»Git å’Œ Repo</p>
<p>é…ç½® Git å’Œ Repo</p>
<p>å®‰è£…å®Œä¾èµ–åï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git config --global user.name &quot;your username&quot;<br>git config --global user.email &quot;your email&quot;<br></code></pre></td></tr></table></figure>

<p>åŒæ­¥ TWRP æºç </p>
<p>åœ¨è‡ªå·±æ–¹ä¾¿çš„åœ°æ–¹ï¼Œå»ºç«‹ä¸€ä¸ªç›®å½•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir twrp<br>cd twrp<br></code></pre></td></tr></table></figure>

<p>æ ¹æ®è‡ªå·±åœ¨å‡†å¤‡å·¥ä½œä¸­ç¡®å®šçš„åˆ†æ”¯åŒæ­¥ç›¸åº”çš„æºç ã€‚</p>
<p>TWRP-9</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">repo init --depth=1 -u https://github.com/minimal-manifest-twrp/platform_manifest_twrp_omni.git -b twrp-9.0<br>repo sync<br></code></pre></td></tr></table></figure>

<p>TWRP-11</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">repo init --depth=1 -u https://github.com/minimal-manifest-twrp/platform_manifest_twrp_aosp.git -b twrp-11<br>repo sync<br></code></pre></td></tr></table></figure>

<p>TWRP-12.1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">repo init --depth=1 -u https://github.com/minimal-manifest-twrp/platform_manifest_twrp_aosp.git -b twrp-12.1<br>repo sync<br></code></pre></td></tr></table></figure>

<p>ç¼–å†™è®¾å¤‡æ ‘</p>
<p>æœ€åŸºæœ¬çš„å¼€æœºéƒ¨åˆ†æˆ‘é€šè¿‡ Redmi K50 åšç¤ºä¾‹ï¼Œå¹¶é€‰å– TWRP-12.1 åˆ†æ”¯ã€‚</p>
<p>è§£å¯†éƒ¨åˆ†ä¼šå•ç‹¬æˆä¸€ä¸ªç« èŠ‚å¹¶åˆ†ä¸ºé«˜é€šå’Œè”å‘ç§‘ã€‚</p>
<p>è·å–èµ„æ–™</p>
<p>å°ç±³è®¾å¤‡ä¸€èˆ¬å¯ä»¥åœ¨Xiaomiromä¸­çš„çº¿åˆ·åŒ…è·å– boot&#x2F;recovery&#x2F;vendor_boot é•œåƒï¼Œå…¶å®ƒè®¾å¤‡è¯·è‡ªè¡Œå¯»æ‰¾ã€‚</p>
<p>å®‰è£…å·¥å…·å’Œä¾èµ–</p>
<p>å°†å‡†å¤‡å·¥ä½œä¸­å‡†å¤‡çš„ boot&#x2F;recovery&#x2F;vendor_boot é•œåƒè§£åŒ…ï¼Œå¯ä»¥ç”¨ä»»ä½•å·¥å…·ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨Android_boot_image_editoræŒ‰ç…§è‡ªè¿°æ–‡ä»¶è¿›è¡Œä¾èµ–å®‰è£…æ“ä½œï¼š</p>
<p>Mac(Intel)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">brew install lz4 xz dtc openjdk@17<br>echo &#x27;export PATH=&quot;/usr/local/opt/openjdk@17/bin:$PATH&quot;&#x27; &gt;&gt; ~/.zshrc<br>source ~/.zshrc<br></code></pre></td></tr></table></figure>

<p>Linux:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt update<br>sudo apt install git device-tree-compiler lz4 xz-utils zlib1g-dev openjdk-17-jdk gcc g++ python3 python-is-python3 p7zip-full android-sdk-libsparse-utils erofs-utils<br></code></pre></td></tr></table></figure>

<p>Common:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/cfig/Android_boot_image_editor<br>cd Android_boot_image_editor<br></code></pre></td></tr></table></figure>

<p>è§£åŒ…</p>
<p>è¯·æ³¨æ„â€&#x2F;â€œè¡¨ç¤ºæˆ–çš„æ„æ€ï¼Œè¯·ä¸è¦è¯¯ä»¥ä¸ºæ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚</p>
<p>å¦‚æœä¸ç¡®å®šåˆ†åŒºå¯»æ‰¾çš„æ˜¯å¦æ­£ç¡®ï¼Œè¯·å°è¯•å°†å¯ä»¥çš„åˆ†åŒºè¿›è¡Œè§£åŒ…ï¼Œå¹¶æŸ¥çœ‹å…¶ramdiskå†…æ˜¯å¦åŒ…å«recoveryå­—æ ·çš„æ–‡ä»¶</p>
<p>å°†ä½ å‡†å¤‡å¥½çš„boot&#x2F;recovery&#x2F;vendor_bootå¤åˆ¶åˆ°è¯¥ç›®å½•ï¼Œä½ å¯ä»¥ä½¿ç”¨ GUI æˆ–è€… CLIã€‚å¦‚:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cp &lt;å‡ºå‚boot/recovery/vendor_bootçš„ç»å¯¹è·¯å¾„&gt; boot/recovery/vendor_boot.img<br>./gradlew unpack<br></code></pre></td></tr></table></figure>

<p>æˆ‘è¿™é‡Œä»¥ Redmi K50 ä¸ºä¾‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">10:12:13.188 [main] INFO  cfig.bootimg.v3.VendorBoot -<br>                        Unpack Summary of vendor_boot.img<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚What                                   â”‚Where                                 â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚image info                             â”‚build/unzip_boot/vendor_boot.json     â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚ramdisk                                â”‚build/unzip_boot/ramdisk.img.lz4      â”‚<br>â”‚-- PLATFORM ramdisk[1/1]               â”‚build/unzip_boot/ramdisk.1.lz4        â”‚<br>â”‚------- extracted rootfs               â”‚build/unzip_boot/root.1               â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚dtb                                    â”‚build/unzip_boot/dtb                  â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚AVB info                               â”‚build/unzip_boot/vendor_boot.avb.json â”‚<br>â”‚\-- signing key                        â”‚NONE                                  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>10:12:13.213 [main] WARN  cfig.packable.PackableLauncher - &#x27;unpack&#x27; sequence completed<br><br>BUILD SUCCESSFUL in 2s<br></code></pre></td></tr></table></figure>

<p>è§£åŒ…æˆåŠŸåç»ˆç«¯ä¼šæ‰“å°å‡ºä»¥ä¸Šä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«vendor_bootç›®å½•ç»“æ„ï¼Œæˆ‘ä»¬åªéœ€è¦ramdiské‡Œçš„éƒ¨åˆ†å†…å®¹å°±å¥½äº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls build/unzip_boot/root.1 # è¯·æ ¹æ®è‡ªå·±çš„åˆ†åŒºå’Œè®¾å¤‡åˆ¤æ–­ramdiskçš„å‘½åï¼Œä¸€èˆ¬éƒ½ç›´æ¥æ˜¯ramdisk<br></code></pre></td></tr></table></figure>

<p>ä¸å‡ºæ„å¤–çš„è¯ä¼šè¾“å‡ºä»¥ä¸‹å†…å®¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/dump/bootedit î‚° î‚  master ? î‚° ls build/unzip_boot/root.1<br>acct                         oem<br>apex                         plat_file_contexts<br>bin                          plat_property_contexts<br>bugreports                   postinstall<br>config                       proc<br>d                            product<br>data                         product_file_contexts<br>data_mirror                  product_property_contexts<br>debug_ramdisk                prop.default<br>default.prop                 res<br>dev                          sdcard<br>etc                          second_stage_resources<br>first_stage_ramdisk          sepolicy<br>init                         storage<br>init.recovery.hardware.rc    sys<br>init.recovery.mt6895.rc      system<br>lib                          system_ext<br>linkerconfig                 system_ext_file_contexts<br>miui.factoryreset.fstab      system_ext_property_contexts<br>miui.factoryreset.rc         tmp<br>mnt                          vendor<br>odm                          vendor_dlkm<br>odm_dlkm                     vendor_file_contexts<br>odm_file_contexts            vendor_property_contexts<br>odm_property_contexts<br></code></pre></td></tr></table></figure>

<p>å¦‚æœåŒ…å« init.recovery*çš„å­—æ ·ï¼Œæ­å–œä½ æˆåŠŸæ‰¾åˆ°äº†æ­£ç¡®çš„åˆ†åŒºã€‚å°†è¿™ä¸ªç›®å½•å¤åˆ¶åˆ°ä¸€ä¸ªè‡ªå·±æ–¹ä¾¿çš„åœ°æ–¹ã€‚ è‡³æ­¤èµ„æ–™å·²ç»å¤§è‡´é½å…¨äº†ï¼Œè§£å¯†çš„èµ„æ–™ä¼šåœ¨è§£å¯†ç« èŠ‚æ¥è®²è§£å¦‚ä½•è·å–ã€‚</p>
<p>åˆå§‹åŒ–ç›®å½•ç»“æ„</p>
<p>åœ¨ twrp æºç æ ¹ç›®å½•è¾“å…¥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p device/vendor/codename<br>mkdir -p device/vendor/codename/recovery/root<br>cd device/vendor/codename<br></code></pre></td></tr></table></figure>

<p>vendoræŒ‡çš„æ˜¯ä¾›åº”å•†ï¼Œå¦‚ xiaomiã€oneplusã€huaweiã€vivoã€realmeã€‚ codenameæŒ‡çš„æ˜¯è®¾å¤‡ä»£å·ï¼Œå°ç±³è®¾å¤‡å¯ä»¥åœ¨XiaomiromæŸ¥è¯¢ï¼Œå…¶å®ƒè®¾å¤‡è‡ªè¡ŒæŸ¥è¯¢äº¦æˆ–æ˜¯åœ¨å¼€å‘è€…é€‰é¡¹å‹¾é€‰ USB è°ƒè¯•é€šè¿‡ adb å°è¯•è·å–ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">adb shell getprop ro.product.manufacturer # ä¾›åº”å•†<br>adb shell getprop ro.product.device # è®¾å¤‡ä»£å·<br></code></pre></td></tr></table></figure>

<p>æˆ‘çš„ Redmi K50 ä¼šæ‰“å°ä»¥ä¸‹ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/dump/bootedit î‚° î‚  master ? î‚° adb shell getprop ro.product.manufacturer<br>Xiaomi # æ— è®ºæ‰“å°å‡ºæ¥çš„å†…å®¹æ˜¯å¤§å†™è¿˜æ˜¯å°å†™ï¼Œåœ¨ç›®å½•ç»“æ„ä¸­æˆ‘ä»¬éƒ½é‡‡ç”¨å°å†™<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/dump/bootedit î‚° î‚  master ? î‚° adb shell getprop ro.product.device<br>rubens<br></code></pre></td></tr></table></figure>

<p>æˆ‘çš„ IQOO NEO5 Lite ä¼šæ‰“å°ä»¥ä¸‹ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° adb shell getprop ro.product.manufacturer<br>vivo<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° adb shell getprop ro.product.device<br>PD2118<br></code></pre></td></tr></table></figure>

<p>ä¸€èˆ¬åªè¦ä¸æ˜¯å±±å¯¨æœºï¼Œå°ä½œåŠå‡ºæ¥çš„æœºå­ï¼Œç”¨è¿™ä¸¤æ¡å‘½ä»¤åº”è¯¥æ˜¯å¯ä»¥æ­£ç¡®è·å–çš„ã€‚</p>
<p>åˆå§‹åŒ–æ„å»ºæ—¶å¿…è¦çš„æ–‡ä»¶</p>
<p>æ— è®ºæ˜¯ AOSP device tree äº¦æˆ–æ˜¯ TWRP device tree éƒ½åŸºæœ¬ç±»ä¼¼äºä»¥ä¸‹ç»“æ„ã€‚</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">/<br>â”œâ”€â”€ prebuilt           (å­˜æ”¾kernelã€dtbç­‰é¢„ç¼–è¯‘æ–‡ä»¶) # AOSP device treeè‹¥ä½¿ç”¨build kernelåˆ™æ²¡æœ‰è¯¥ç›®å½•<br>â”œâ”€â”€ recovery/root      (å­˜æ”¾ä¸€äº›.rcå’Œè§£å¯†blobs) # ä¸€èˆ¬ç”¨äºRecovery device tree<br>â”œâ”€â”€ Android.<span class="hljs-keyword">mk</span>         (Androidæ„å»ºç³»ç»Ÿé¦–å…ˆä¼šæ£€æŸ¥æ¯ä¸ªç›®å½•çš„Android.<span class="hljs-keyword">mk</span>ï¼Œé‡Œé¢åŒ…å«ä¸€äº›åˆ¤æ–­ï¼Œç”±å®ƒåŒ…æ‹¬å…¶æ‰€åœ¨ç›®å½•ä¸­æ‰€æœ‰Makefile)<br>â”œâ”€â”€ AndroidProducts.<span class="hljs-keyword">mk</span> (å£°æ˜äº§å“çš„Makefileå’Œlunchæ—¶å¯ç”¨çš„æ„å»ºç±»å‹)<br>â”œâ”€â”€ BoardConfig.<span class="hljs-keyword">mk</span>     (æ¿è½½é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸»æ¿å¿…è¦çš„Flag)<br>â”œâ”€â”€ device.<span class="hljs-keyword">mk</span>          (å£°æ˜è®¾å¤‡æ‰€éœ€çš„æ–‡ä»¶å’Œæ¨¡å—)<br>â””â”€â”€ <span class="hljs-symbol">&lt;ROM&gt;</span>_codename.<span class="hljs-keyword">mk</span>  (å£°æ˜äº§å“ç‰¹å®šä¿¡æ¯ï¼Œä¾‹å¦‚åç§°ã€å“ç‰Œå’Œå‹å·ï¼Œå¼•ç”¨device.<span class="hljs-keyword">mk</span>ç­‰) # ROMå°±æ¯”å¦‚lineageã€arrowç­‰ï¼Œç¼–è¯‘twrpå°±ç›´æ¥å†™twrpï¼Œtwrp-<span class="hljs-number">9</span>åˆ†æ”¯è¦å†™onmi<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æŠŠè¿™æ ·çš„ç»“æ„ç§°ä¸ºéª¨æ¶æ ‘(skeleton tree)ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æŒ‰ç…§ä»¥ä¸Šç»“æ„ä¸ºè‡ªå·±çš„è®¾å¤‡å†™ä¸€ä»½ Recovery device treeã€‚ åœ¨ç»ˆç«¯ä½¿ç”¨touchå‘½ä»¤åˆ›å»ºå¿…è¦çš„æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">touch Android.mk AndroidProducts.mk BoardConfig.mk device.mk twrp_rubens.mk<br>ls .<br></code></pre></td></tr></table></figure>

<p>ä¸å‡ºæ„å¤–çš„è¯ä¼šæ‰“å°å‡ºä»¥ä¸‹ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° touch Android.mk AndroidProducts.mk BoardConfig.mk device.mk twrp_rubens.mk<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° ls .<br>Android.mk         BoardConfig.mk     prebuilt           twrp_rubens.mk<br>AndroidProducts.mk device.mk          recovery<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥ä¸‹ä¸€æ­¥äº†~</p>
<p>åˆå§‹ Android.mk æ–‡ä»¶</p>
<p>æ‰“å¼€ Vscode å¹¶æ‰“å¼€è®¾å¤‡æ ‘ç›®å½•ï¼Œä½ è¶³å¤Ÿå¼ºä¹Ÿå¯ä»¥ä½¿ç”¨ nanoã€vim ç¼–è¾‘ã€‚ é€‰ä¸­ Android.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile">LOCAL_PATH := <span class="hljs-variable">$(<span class="hljs-built_in">call</span> my-<span class="hljs-built_in">dir</span>)</span><br><br><span class="hljs-keyword">ifeq</span> (<span class="hljs-variable">$(TARGET_DEVICE)</span>,codename)<br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(<span class="hljs-built_in">call</span> all-subdir-makefiles,<span class="hljs-variable">$(LOCAL_PATH)</span>)</span><br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure>

<p>Â· codenameæ˜¯éœ€è¦ä½ ä¿®æ”¹çš„éƒ¨åˆ†</p>
<p>æˆ‘ä¿®æ”¹åæ˜¯è¿™æ ·çš„</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile">LOCAL_PATH := <span class="hljs-variable">$(<span class="hljs-built_in">call</span> my-<span class="hljs-built_in">dir</span>)</span><br><br><span class="hljs-keyword">ifeq</span> (<span class="hljs-variable">$(TARGET_DEVICE)</span>,rubens)<br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(<span class="hljs-built_in">call</span> all-subdir-makefiles,<span class="hljs-variable">$(LOCAL_PATH)</span>)</span><br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure>

<p>åˆå§‹ AndroidProducts.mk æ–‡ä»¶</p>
<p>é€‰ä¸­ AndroidProducts.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile">PRODUCT_MAKEFILES := \<br>    <span class="hljs-variable">$(LOCAL_DIR)</span>/&lt;ROM&gt;_&lt;codename&gt;.mk<br><br>COMMON_LUNCH_CHOICES := \<br>    &lt;ROM&gt;_&lt;codename&gt;-eng<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä¿®æ”¹åæ˜¯è¿™æ ·çš„</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile">PRODUCT_MAKEFILES := \<br>    <span class="hljs-variable">$(LOCAL_DIR)</span>/twrp_rubens.mk<br><br>COMMON_LUNCH_CHOICES := \<br>    twrp_rubens-eng<br></code></pre></td></tr></table></figure>

<p>åˆå§‹ BoardConfig.mk æ–‡ä»¶</p>
<p>å°†ä¹‹å‰å‡†å¤‡çš„ramdiskæ–‡ä»¶å¤¹ç”¨æ–°çª—å£æ‰“å¼€ 1.æ‰¾åˆ°ç›®å½•ä¸‹çš„ prop.default æˆ–å« prop å­—æ ·çš„æ–‡ä»¶ã€‚ä»¥ä¸‹æ³¨é‡Šç±»ä¼¼ ro..çš„å°±æ˜¯ä» prop ä¸­è·å–çš„ 2.è§£åŒ… boot&#x2F;recovery&#x2F;vendor_boot çš„ json</p>
<p>ä¾‹å¦‚ build&#x2F;unzip_boot&#x2F;boot.json</p>
<p>é€‰ä¸­ BoardConfig.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs makefile">DEVICE_PATH := device/vendor/codename<br><br><span class="hljs-comment"># Architecture</span><br>TARGET_ARCH := arm64 <span class="hljs-comment"># ro.bionic.arch</span><br>TARGET_ARCH_VARIANT := armv8-a <span class="hljs-comment"># 64ä½é»˜è®¤å˜ä½“</span><br>TARGET_CPU_ABI := arm64-v8a <span class="hljs-comment"># ro.vendor.product.cpu.abilist64 (è‡³å°‘åœ¨å°ç±³è®¾å¤‡ä¸Šæ²¡æœ‰æ‰¾åˆ°ro.product.cpu.abilist)</span><br>TARGET_CPU_ABI2 := <span class="hljs-comment"># 64ä½ç•™ç©º</span><br>TARGET_CPU_VARIANT := generic <span class="hljs-comment"># é»˜è®¤ä¸€èˆ¬éƒ½æ˜¯é€šç”¨</span><br>TARGET_CPU_VARIANT_RUNTIME := cortex-a55 <span class="hljs-comment"># ro.bionic.cpu_variant</span><br><br>TARGET_2ND_ARCH := arm <span class="hljs-comment"># ro.bionic.2nd_arch</span><br>TARGET_2ND_ARCH_VARIANT := <span class="hljs-variable">$(TARGET_ARCH_VARIANT)</span><br>TARGET_2ND_CPU_ABI := armeabi-v7a <span class="hljs-comment"># ro.vendor.product.cpu.abilist32ç¬¬ä¸€ä¸ª</span><br>TARGET_2ND_CPU_ABI2 := armeabi <span class="hljs-comment"># ro.vendor.product.cpu.abilist32ç¬¬äºŒä¸ª</span><br>TARGET_2ND_CPU_VARIANT := <span class="hljs-variable">$(TARGET_CPU_VARIANT)</span><br>TARGET_2ND_CPU_VARIANT_RUNTIME := <span class="hljs-variable">$(TARGET_CPU_VARIANT)</span><br><br><span class="hljs-comment"># Assertation</span><br>TARGET_OTA_ASSERT_DEVICE := rubens <span class="hljs-comment"># codename</span><br><br><span class="hljs-comment"># Bootloader</span><br>TARGET_BOOTLOADER_BOARD_NAME := rubens <span class="hljs-comment"># ro.product.board</span><br>TARGET_NO_BOOTLOADER := true<br>TARGET_USES_UEFI := true<br><br><span class="hljs-comment"># Build Rule</span><br>ALLOW_MISSING_DEPENDENCIES := true <span class="hljs-comment"># ä¸ºäº†recoveryä¸å¥å…¨çš„ä¾èµ–</span><br><br><span class="hljs-comment"># Kernel - æ³¨é‡Šä¼šè¯´æ˜åœ¨boot/recovery/vendor_boot.jsonä¸­å¯¹åº”çš„å˜é‡</span><br>BOARD_BOOT_HEADER_VERSION := 4 <span class="hljs-comment"># headerVersion</span><br>BOARD_KERNEL_BASE := 0x3fff8000 <span class="hljs-comment"># (kernelLoadAddr - 32KB) qcomè®¾å¤‡baseä¸º0ï¼Œä¸”æ²¡æœ‰åç§»(offset)</span><br>BOARD_KERNEL_CMDLINE := bootopt=64S3,32N2,64N2 <span class="hljs-comment"># cmdline</span><br>BOARD_KERNEL_PAGESIZE := 4096 <span class="hljs-comment"># pageSize</span><br>BOARD_RAMDISK_OFFSET := 0x26f08000 <span class="hljs-comment"># (ramdisk,loadAddr - BOARD_KERNEL_BASE)</span><br>BOARD_KERNEL_TAGS_OFFSET := 0x07c88000 <span class="hljs-comment"># (tagsLoadAddr - BOARD_KERNEL_BASE)</span><br>BOARD_MKBOOTIMG_ARGS += --header_version <span class="hljs-variable">$(BOARD_BOOT_HEADER_VERSION)</span><br>BOARD_MKBOOTIMG_ARGS += --ramdisk_offset <span class="hljs-variable">$(BOARD_RAMDISK_OFFSET)</span><br>BOARD_MKBOOTIMG_ARGS += --tags_offset <span class="hljs-variable">$(BOARD_KERNEL_TAGS_OFFSET)</span><br><br><span class="hljs-comment"># Kernel - prebuilt</span><br>TARGET_PREBUILT_KERNEL := <span class="hljs-variable">$(DEVICE_PATH)</span>/prebuilt/kernel <span class="hljs-comment"># é¢„ç¼–è¯‘å†…æ ¸ç›¸å¯¹äºandroidæºç æ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œvendor_bootæœºå‹ä¸éœ€è¦</span><br>TARGET_PREBUILT_DTB := <span class="hljs-variable">$(DEVICE_PATH)</span>/prebuilt/dtb.img <span class="hljs-comment"># åŒä¸Š</span><br>BOARD_MKBOOTIMG_ARGS += --dtb <span class="hljs-variable">$(TARGET_PREBUILT_DTB)</span><br><br><span class="hljs-comment"># Partitions</span><br>BOARD_FLASH_BLOCK_SIZE := 262144 <span class="hljs-comment"># (BOARD_KERNEL_PAGESIZE * 64)</span><br>BOARD_BOOTIMAGE_PARTITION_SIZE := 67108864 <span class="hljs-comment"># boot/recovery/vendor_booté•œåƒçš„å­—èŠ‚å¤§å°éœ€åŸå‚æˆ–æ‰‹æœºå®Œæ•´æå–å‡ºæ¥çš„ï¼Œä¸å®šä¹‰ä¼šæŠ¥é”™</span><br>BOARD_RECOVERYIMAGE_PARTITION_SIZE := 67108864 <span class="hljs-comment"># åŒä¸Š</span><br>BOARD_VENDOR_BOOTIMAGE_PARTITION_SIZE := 67108864 <span class="hljs-comment"># åŒä¸Š</span><br>BOARD_SYSTEMIMAGE_PARTITION_TYPE := ext4 <span class="hljs-comment"># åˆ†åŒºç±»å‹ï¼ŒæŸ¥çœ‹ramdiskä¸­fstabå®šä¹‰çš„ç±»å‹</span><br>BOARD_USERDATAIMAGE_FILE_SYSTEM_TYPE := ext4<br>BOARD_VENDORIMAGE_FILE_SYSTEM_TYPE := ext4<br>TARGET_COPY_OUT_VENDOR := vendor <span class="hljs-comment"># å®šä¹‰vendorç›®å½•ï¼Œä¾‹å¦‚copyä¸“æœ‰blobsè¦ç”¨</span><br>BOARD_SUPER_PARTITION_SIZE := 9126805504 <span class="hljs-comment"># å¯ä»¥é€šè¿‡blockdev --getsize64 /dev/block/bootdevice/by-name/superè·å–ï¼Œéœ€rootï¼Œå¦‚æœæ— æ³•rootå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå€¼ï¼Œä¸å½±å“twrpå¯åŠ¨ï¼Œå¯ä»¥åç»­ä¿®æ­£</span><br>BOARD_SUPER_PARTITION_GROUPS := xiaomi_dynamic_partitions <span class="hljs-comment"># xiaomiæ ¹æ®ä½ è·å–èµ„æ–™çš„vendoræ›¿æ¢ï¼Œæ˜¯ä¸€ä¸ªåŠ¨æ€åˆ†åŒºç»„</span><br>BOARD_XIAOMI_DYNAMIC_PARTITIONS_PARTITION_LIST := system vendor product system_ext odm vendor_dlkm odm_dlkm <span class="hljs-comment"># æ ¹æ®fstabå†…çš„å®šä¹‰ï¼Œä¸€èˆ¬flagåŒ…å«logicaléƒ½å±äºåŠ¨æ€åˆ†åŒºç»„çš„ä¸€éƒ¨åˆ†</span><br>BOARD_XIAOMI_DYNAMIC_PARTITIONS_SIZE := 9122611200 <span class="hljs-comment"># (BOARD_SUPER_PARTITION_SIZE - 4MB)</span><br><br><span class="hljs-comment"># Platform</span><br>TARGET_BOARD_PLATFORM := mt6895 <span class="hljs-comment"># ro.board.platform</span><br><br><span class="hljs-comment"># Recovery - åŸºæœ¬é€šç”¨çš„ä¸å½±å“å¯åŠ¨</span><br>BOARD_HAS_LARGE_FILESYSTEM := true<br>TARGET_RECOVERY_PIXEL_FORMAT := RGBX_8888<br>TARGET_USERIMAGES_USE_EXT4 := true<br>TARGET_USERIMAGES_USE_F2FS := true<br><br><span class="hljs-comment"># Treble</span><br>BOARD_VNDK_VERSION := current <span class="hljs-comment"># å£°æ˜VNDKç‰ˆæœ¬</span><br><br><span class="hljs-comment"># Vendor_boot recovery ramdisk</span><br>BOARD_MOVE_RECOVERY_RESOURCES_TO_VENDOR_BOOT := true <span class="hljs-comment"># å°†recoveryæ–‡ä»¶å¤åˆ¶åˆ°vendor_boot</span><br><br><span class="hljs-comment"># Boot recovery ramdisk</span><br><span class="hljs-comment">#BOARD_USES_RECOVERY_AS_BOOT := true recovery ramdiskåˆå¹¶åœ¨bootä¸­å¯ç”¨</span><br><br><span class="hljs-comment"># Verified Boot</span><br>BOARD_AVB_ENABLE := true<br>BOARD_AVB_MAKE_VBMETA_IMAGE_ARGS += --flags 3<br><br><span class="hljs-comment"># TWRP Configurations</span><br>TW_DEFAULT_LANGUAGE := zh_CN <span class="hljs-comment"># é»˜è®¤ä¸ºä¸­æ–‡</span><br>TW_EXTRA_LANGUAGES := true <span class="hljs-comment"># é¢å¤–çš„è¯­è¨€</span><br>TW_THEME := portrait_hdpi <span class="hljs-comment"># ä¸»é¢˜</span><br>TW_INCLUDE_FASTBOOTD := true <span class="hljs-comment"># åŒ…æ‹¬fastbootdï¼Œä¸ºåŠ¨æ€åˆ†åŒº</span><br><br><span class="hljs-comment"># å…¶å®ƒflagè¿˜æœ‰å¾ˆå¤šï¼Œå¯ä»¥åœ¨https://xdaforums.com/t/twrp-flags-for-boardconfig-mk.3333970 æŸ¥æ‰¾ï¼Œ</span><br><span class="hljs-comment"># è¿™ç¯‡æ–‡ç« ä¹Ÿå¾ˆè€äº†ï¼Œä½†æˆ‘å¹¶ä¸æ¨ètwrpï¼Œæ‰€ä»¥flagæˆ‘ä¹Ÿä¸æ˜¯å¾ˆäº†è§£ï¼Œå¤šç¿»ç¿»github:)</span><br><br><span class="hljs-comment"># Debug</span><br>TARGET_USES_LOGD := true <span class="hljs-comment"># è°ƒè¯•flag</span><br>TWRP_INCLUDE_LOGCAT := true<br></code></pre></td></tr></table></figure>

<p>æ— æ³¨é‡Šç‰ˆ</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs makefile">DEVICE_PATH := device/vendor/codename<br><br><span class="hljs-comment"># Architecture</span><br>TARGET_ARCH := arm64<br>TARGET_ARCH_VARIANT := armv8-a<br>TARGET_CPU_ABI := arm64-v8a<br>TARGET_CPU_ABI2 :=<br>TARGET_CPU_VARIANT := generic<br>TARGET_CPU_VARIANT_RUNTIME := cortex-a55<br><br>TARGET_2ND_ARCH := arm<br>TARGET_2ND_ARCH_VARIANT := <span class="hljs-variable">$(TARGET_ARCH_VARIANT)</span><br>TARGET_2ND_CPU_ABI := armeabi-v7a<br>TARGET_2ND_CPU_ABI2 := armeabi<br>TARGET_2ND_CPU_VARIANT := <span class="hljs-variable">$(TARGET_CPU_VARIANT)</span><br>TARGET_2ND_CPU_VARIANT_RUNTIME := <span class="hljs-variable">$(TARGET_CPU_VARIANT)</span><br><br><span class="hljs-comment"># Assertation</span><br>TARGET_OTA_ASSERT_DEVICE := rubens<br><br><span class="hljs-comment"># Bootloader</span><br>TARGET_BOOTLOADER_BOARD_NAME := rubens<br>TARGET_NO_BOOTLOADER := true<br>TARGET_USES_UEFI := true<br><br><span class="hljs-comment"># Build Rule</span><br>ALLOW_MISSING_DEPENDENCIES := true<br><br><span class="hljs-comment"># Kernel</span><br>BOARD_BOOT_HEADER_VERSION := 4<br>BOARD_KERNEL_BASE := 0x3fff8000<br>BOARD_KERNEL_CMDLINE := bootopt=64S3,32N2,64N2<br>BOARD_KERNEL_PAGESIZE := 4096<br>BOARD_RAMDISK_OFFSET := 0x26f08000<br>BOARD_KERNEL_TAGS_OFFSET := 0x07c88000<br>BOARD_MKBOOTIMG_ARGS += --header_version <span class="hljs-variable">$(BOARD_BOOT_HEADER_VERSION)</span><br>BOARD_MKBOOTIMG_ARGS += --ramdisk_offset <span class="hljs-variable">$(BOARD_RAMDISK_OFFSET)</span><br>BOARD_MKBOOTIMG_ARGS += --tags_offset <span class="hljs-variable">$(BOARD_KERNEL_TAGS_OFFSET)</span><br>BOARD_KERNEL_IMAGE_NAME := Image<br><br><span class="hljs-comment"># Kernel - prebuilt</span><br>TARGET_PREBUILT_DTB := <span class="hljs-variable">$(DEVICE_PATH)</span>/prebuilt/dtb.img<br>BOARD_MKBOOTIMG_ARGS += --dtb <span class="hljs-variable">$(TARGET_PREBUILT_DTB)</span><br><br><span class="hljs-comment"># Partitions</span><br>BOARD_FLASH_BLOCK_SIZE := 262144<br>BOARD_BOOTIMAGE_PARTITION_SIZE := 67108864<br>BOARD_RECOVERYIMAGE_PARTITION_SIZE := 67108864<br>BOARD_VENDOR_BOOTIMAGE_PARTITION_SIZE := 67108864<br>BOARD_SYSTEMIMAGE_PARTITION_TYPE := ext4<br>BOARD_USERDATAIMAGE_FILE_SYSTEM_TYPE := ext4<br>BOARD_VENDORIMAGE_FILE_SYSTEM_TYPE := ext4<br>TARGET_COPY_OUT_VENDOR := vendor<br>BOARD_SUPER_PARTITION_SIZE := 9126805504<br>BOARD_SUPER_PARTITION_GROUPS := xiaomi_dynamic_partitions<br>BOARD_XIAOMI_DYNAMIC_PARTITIONS_PARTITION_LIST := system vendor product system_ext odm vendor_dlkm odm_dlkm<br>BOARD_XIAOMI_DYNAMIC_PARTITIONS_SIZE := 9122611200<br><br><span class="hljs-comment"># Platform</span><br>TARGET_BOARD_PLATFORM := mt6895<br><br><span class="hljs-comment"># Recovery</span><br>BOARD_HAS_LARGE_FILESYSTEM := true<br>TARGET_RECOVERY_PIXEL_FORMAT := RGBX_8888<br>TARGET_USERIMAGES_USE_EXT4 := true<br>TARGET_USERIMAGES_USE_F2FS := true<br><br><span class="hljs-comment"># Treble</span><br>BOARD_VNDK_VERSION := current<br><br><span class="hljs-comment"># Vendor_boot recovery ramdisk</span><br>BOARD_MOVE_RECOVERY_RESOURCES_TO_VENDOR_BOOT := true<br><br><span class="hljs-comment"># Boot recovery ramdisk</span><br><span class="hljs-comment">#BOARD_USES_RECOVERY_AS_BOOT := true</span><br><br><span class="hljs-comment"># Verified Boot</span><br>BOARD_AVB_ENABLE := true<br>BOARD_AVB_MAKE_VBMETA_IMAGE_ARGS += --flags 3<br><br><span class="hljs-comment"># TWRP Configurations</span><br>TW_DEFAULT_LANGUAGE := zh_CN<br>TW_EXTRA_LANGUAGES := true<br>TW_THEME := portrait_hdpi<br>TW_INCLUDE_FASTBOOTD := true<br><br><span class="hljs-comment"># Debug</span><br>TARGET_USES_LOGD := true<br>TWRP_INCLUDE_LOGCAT := true<br></code></pre></td></tr></table></figure>

<p>è¿™å—å†™äº†å¥½ä¹…æˆ‘ä¹Ÿä¸ç¡®å®šå¯¹ä¸å¯¹ï¼Œè¯·å„ä½æŒ‡æ­£ï¼Œå°¤å…¶æ˜¯ Kernel éƒ¨åˆ†ã€‚</p>
<p>åˆå§‹ device.mk æ–‡ä»¶</p>
<p>Â· å‡†å¤‡å¥½ prop.default</p>
<p>é€‰ä¸­ AndroidProducts.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs makefile">DEVICE_PATH := device/xiaomi/rubens<br><br><span class="hljs-comment"># API</span><br>PRODUCT_SHIPPING_API_LEVEL := 31 <span class="hljs-comment"># ro.board.first_api_level</span><br><br><span class="hljs-comment"># A/B</span><br>AB_OTA_UPDATER := true <span class="hljs-comment"># å¯ç”¨A/Bæ— ç¼æ›´æ–°</span><br>AB_OTA_PARTITIONS += \ <span class="hljs-comment"># å®šä¹‰A/Båˆ†åŒºï¼Œå‚è€ƒfstab</span><br>    boot \<br>    dtbo \<br>    system \<br>    product \<br>    vendor \<br>    odm \<br>    odm_dlkm \<br>    vbmeta \<br>    vendor_boot \<br>    vendor_dlkm \<br>    vbmeta_system \<br>    vbmeta_vendor<br><br>PRODUCT_PACKAGES += \<br>    update_engine \<br>    update_engine_sideload \<br>    update_verifier \<br>    checkpoint_gc<br><br>AB_OTA_POSTINSTALL_CONFIG += \<br>    RUN_POSTINSTALL_system=true \<br>    POSTINSTALL_PATH_system=system/bin/mtk_plpath_utils \<br>    FILESYSTEM_TYPE_system=ext4 \<br>    POSTINSTALL_OPTIONAL_system=true<br><br>AB_OTA_POSTINSTALL_CONFIG += \<br>    RUN_POSTINSTALL_vendor=true \<br>    POSTINSTALL_PATH_vendor=bin/checkpoint_gc \<br>    FILESYSTEM_TYPE_vendor=ext4 \<br>    POSTINSTALL_OPTIONAL_vendor=true<br><br><span class="hljs-comment"># Dynamic</span><br>PRODUCT_USE_DYNAMIC_PARTITIONS := true <span class="hljs-comment"># åŠ¨æ€åˆ†åŒº</span><br><br><span class="hljs-comment"># Soong namespaces</span><br>PRODUCT_SOONG_NAMESPACES += <span class="hljs-variable">$(DEVICE_PATH)</span> <span class="hljs-comment"># å‘½åç©ºé—´</span><br></code></pre></td></tr></table></figure>

<p>Â· A&#x2F;B æ— ç¼æ›´æ–°éƒ¨åˆ†é«˜é€šå’Œè”å‘ç§‘ä¸ä¸€æ ·ï¼Œè”å‘ç§‘è®¾å¤‡å¯ä»¥ç…§æŠ„ï¼Œæ³¨æ„ system&#x2F;bin&#x2F;mtk_plpath_utils å°±å¥½ã€‚é«˜é€šå‚è€ƒvenus twrp treeï¼Œå¹¶ä¸”é«˜é€šçš„bootctrlå’Œgpt-utilså¯ä»¥ä» CLO æ‹¿ã€‚</p>
<p>æ— æ³¨é‡Šç‰ˆ</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs makefile">PRODUCT_SHIPPING_API_LEVEL := 31<br><br><span class="hljs-comment"># A/B</span><br>AB_OTA_UPDATER := true<br>AB_OTA_PARTITIONS += \<br>    boot \<br>    dtbo \<br>    system \<br>    product \<br>    vendor \<br>    odm \<br>    odm_dlkm \<br>    vbmeta \<br>    vendor_boot \<br>    vendor_dlkm \<br>    vbmeta_system \<br>    vbmeta_vendor<br><br>PRODUCT_PACKAGES += \<br>    update_engine \<br>    update_engine_sideload \<br>    update_verifier \<br>    checkpoint_gc<br><br>AB_OTA_POSTINSTALL_CONFIG += \<br>    RUN_POSTINSTALL_system=true \<br>    POSTINSTALL_PATH_system=system/bin/mtk_plpath_utils \<br>    FILESYSTEM_TYPE_system=ext4 \<br>    POSTINSTALL_OPTIONAL_system=true<br><br>AB_OTA_POSTINSTALL_CONFIG += \<br>    RUN_POSTINSTALL_vendor=true \<br>    POSTINSTALL_PATH_vendor=bin/checkpoint_gc \<br>    FILESYSTEM_TYPE_vendor=ext4 \<br>    POSTINSTALL_OPTIONAL_vendor=true<br><br><span class="hljs-comment"># Dynamic</span><br>PRODUCT_USE_DYNAMIC_PARTITIONS := true<br><br><span class="hljs-comment"># Soong namespaces</span><br>PRODUCT_SOONG_NAMESPACES += <span class="hljs-variable">$(DEVICE_PATH)</span><br></code></pre></td></tr></table></figure>

<p>åˆå§‹ twrp_rubens.mk æ–‡ä»¶</p>
<p>é€‰ä¸­ AndroidProducts.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># Inherit from common AOSP config</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/base.mk)</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/core_64_bit_only.mk)</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/virtual_ab_ota/launch_with_vendor_ramdisk.mk)</span> <span class="hljs-comment"># vabåŠ è½½åˆ°vendor booté‡Œä½¿ç”¨</span><br><br><span class="hljs-comment"># Inherit from TWRP product configuration</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, vendor/twrp/config/common.mk)</span> <span class="hljs-comment"># twrp-9åˆ†æ”¯æ”¹ä¸ºonmi</span><br><br><span class="hljs-comment"># Device specific configs</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, device/xiaomi/rubens/device.mk)</span><br><br><span class="hljs-comment"># Device identifier</span><br>PRODUCT_DEVICE := rubens <span class="hljs-comment"># è®¾å¤‡å‹å·</span><br>PRODUCT_NAME := twrp_rubens <span class="hljs-comment"># è®¾å¤‡åç§°</span><br>PRODUCT_BRAND := Redmi <span class="hljs-comment"># è‡ªå®šä¹‰å“ç‰Œï¼Œå¦‚æœæœ‰</span><br>PRODUCT_MODEL := 22041211AC <span class="hljs-comment"># äº§å“æœ€ç»ˆç”¨æˆ·å¯è§åç§°</span><br>PRODUCT_MANUFACTURER := Xiaomi <span class="hljs-comment"># åˆ¶é€ å•†</span><br><br>PRODUCT_PROPERTY_OVERRIDES += ro.twrp.vendor_boot=true <span class="hljs-comment"># å¯¹twrpå¯åŠ¨vendor_bootæ”¯æŒ</span><br></code></pre></td></tr></table></figure>

<p>æ— æ³¨é‡Šç‰ˆ</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># Inherit from common AOSP config</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/base.mk)</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/core_64_bit_only.mk)</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/virtual_ab_ota/launch_with_vendor_ramdisk.mk)</span> <span class="hljs-comment"># vabåŠ è½½åˆ°vendor booté‡Œä½¿ç”¨</span><br><br><span class="hljs-comment"># Inherit from TWRP product configuration</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, vendor/twrp/config/common.mk)</span><br><br><span class="hljs-comment"># Device specific configs</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, device/xiaomi/rubens/device.mk)</span><br><br><span class="hljs-comment"># Device identifier</span><br>PRODUCT_DEVICE := rubens<br>PRODUCT_NAME := twrp_rubens<br>PRODUCT_BRAND := Redmi<br>PRODUCT_MODEL := 22041211AC<br>PRODUCT_MANUFACTURER := Xiaomi<br><br>PRODUCT_PROPERTY_OVERRIDES += ro.twrp.vendor_boot=true<br></code></pre></td></tr></table></figure>

<p>åˆå§‹ recovery ç›®å½•</p>
<p>æ‹¿å‡ºæˆ‘ä»¬å¥½ä¹…ä¹‹å‰å‡†å¤‡çš„ ramdisk å­</p>
<p>é€šè¿‡treeå‘½ä»¤æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ ramdisk çš„æ ‘çŠ¶å›¾ï¼Œå¯ä»¥å¾ˆæ¸…æ™°çš„æŸ¥çœ‹åŒ…å«çš„æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs shell">â”œâ”€â”€ acct<br>â”œâ”€â”€ apex<br>â”œâ”€â”€ bin -&gt; /system/bin<br>â”œâ”€â”€ bugreports -&gt; /data/user_de/0/com.android.shell/files/bugreports<br>â”œâ”€â”€ config<br>â”œâ”€â”€ d -&gt; /sys/kernel/debug<br>â”œâ”€â”€ data<br>â”œâ”€â”€ data_mirror<br>â”œâ”€â”€ debug_ramdisk<br>â”œâ”€â”€ default.prop -&gt; prop.default<br>â”œâ”€â”€ dev<br>â”œâ”€â”€ etc -&gt; /system/etc<br>â”œâ”€â”€ first_stage_ramdisk<br>â”‚Â Â  â”œâ”€â”€ fstab.emmc<br>â”‚Â Â  â”œâ”€â”€ fstab.mt6895<br>â”‚Â Â  â””â”€â”€ system<br>â”‚Â Â      â”œâ”€â”€ bin<br>â”‚Â Â      â”‚Â Â  â”œâ”€â”€ e2fsck<br>â”‚Â Â      â”‚Â Â  â”œâ”€â”€ linker64<br>â”‚Â Â      â”‚Â Â  â”œâ”€â”€ linker_asan64 -&gt; linker64<br>â”‚Â Â      â”‚Â Â  â””â”€â”€ snapuserd<br>â”‚Â Â      â””â”€â”€ lib64<br>â”‚Â Â          â”œâ”€â”€ ld-android.so<br>â”‚Â Â          â”œâ”€â”€ libbase.so<br>â”‚Â Â          â”œâ”€â”€ libc++.so<br>â”‚Â Â          â”œâ”€â”€ libc.so<br>â”‚Â Â          â”œâ”€â”€ libdl.so<br>â”‚Â Â          â”œâ”€â”€ libext2_blkid.so<br>â”‚Â Â          â”œâ”€â”€ libext2_com_err.so<br>â”‚Â Â          â”œâ”€â”€ libext2_e2p.so<br>â”‚Â Â          â”œâ”€â”€ libext2_quota.so<br>â”‚Â Â          â”œâ”€â”€ libext2_uuid.so<br>â”‚Â Â          â”œâ”€â”€ libext2fs.so<br>â”‚Â Â          â”œâ”€â”€ liblog.so<br>â”‚Â Â          â”œâ”€â”€ libm.so<br>â”‚Â Â          â”œâ”€â”€ libsparse.so<br>â”‚Â Â          â””â”€â”€ libz.so<br>â”œâ”€â”€ init -&gt; /system/bin/init<br>â”œâ”€â”€ init.recovery.hardware.rc<br>â”œâ”€â”€ init.recovery.mt6895.rc<br>â””â”€â”€ ç­‰ç­‰ç­‰ç­‰...çœç•¥å¤§æ¦‚1000ä¸ªæ–‡ä»¶å§<br></code></pre></td></tr></table></figure>

<p>å› ä¸ºé¿å…æ•™ç¨‹æ—¶æ•ˆæ€§ï¼Œæˆ‘ä»¬å°½å¯èƒ½é€‰å– prebuilt çš„åŠæ³•ï¼Œå¦‚ boot å’Œ mtk_plpath_utils éƒ½é‡‡ç”¨é¢„ç¼–è¯‘ã€‚</p>
<p>é‡Œé¢æœ‰å¾ˆå¤šæ–‡ä»¶æ˜¯æ²¡ç”¨çš„ï¼Œæ•´ç†ä¸€ä¸‹ï¼Œå¯¹æˆ‘ä»¬æœ‰ç”¨çš„åªæœ‰è¿™äº›</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell">.<br>â”œâ”€â”€ first_stage_ramdisk<br>â”‚Â Â  â”œâ”€â”€ fstab.emmc<br>â”‚Â Â  â””â”€â”€ fstab.mt6895<br>â”œâ”€â”€ init.recovery.mt6895.rc<br>â”œâ”€â”€ lib<br>â”‚Â Â  â””â”€â”€ modules<br>â”‚Â Â      â”œâ”€â”€ 8250_mtk.ko<br>â”‚Â Â      â”œâ”€â”€ adapter_class.ko<br>â”‚Â Â      â”œâ”€â”€ adsp.ko<br>â”‚Â Â      â”œâ”€â”€ aee_aed.ko<br>â”‚Â Â      â”œâ”€â”€ aee_hangdet.ko<br>â”‚Â Â      â”œâ”€â”€ aee_rs.ko<br>â”‚Â Â      â”œâ”€â”€ blocktag.ko<br>â”‚Â Â      â”œâ”€â”€ bootprof.ko<br>â”‚Â Â      â”œâ”€â”€ bq28z610.ko<br>â”‚Â Â      â”œâ”€â”€ cache-parity.ko<br>â”‚Â Â      â”œâ”€â”€ cfg80211.ko<br>â”‚Â Â      â”œâ”€â”€ charger_class.ko<br>â”‚Â Â      â””â”€â”€ çœç•¥ä¸€ç™¾å¤šä¸ªæ¨¡å—ï¼Œè¿™ä¸ªç›®å½•é‡Œçš„ä¸œè¥¿å…¨è¦<br>â””â”€â”€ system<br>    â”œâ”€â”€ bin<br>    â”‚Â Â  â””â”€â”€ mtk_plpath_utils<br>    â”œâ”€â”€ etc<br>    â”‚Â Â  â”œâ”€â”€ init<br>    â”‚Â Â  â”‚Â Â  â”‚â”€â”€ mtk-plpath-utils.rc<br>    â”‚   â”‚   â””â”€â”€hw<br>    â”‚   â”‚      â””â”€â”€init.rc<br>    â”‚Â Â  â”œâ”€â”€ recovery.fstab<br>    â”‚Â Â  â”œâ”€â”€ security<br>    â”‚Â Â  â”‚Â Â  â””â”€â”€ otacerts.zip<br>    â”‚Â Â  â””â”€â”€ ueventd.rc<br>    â””â”€â”€ lib64<br>        â””â”€â”€ hw<br>            â””â”€â”€ android.hardware.boot@1.0-impl-1.2-mtkimpl.so<br></code></pre></td></tr></table></figure>

<p>å°†å®ƒä»¬æŒ‰ç…§ä»¥ä¸‹æ“ä½œå¤åˆ¶</p>
<p>Â· first_stage_ramdisk â€“&gt; recovery&#x2F;root&#x2F;first_stage_ramdisk<br>Â· init.recovery.mt6895.rc â€“&gt; recovery&#x2F;root&#x2F;init.recovery.mt6895.rc<br>Â· lib â€“&gt; recovery&#x2F;root&#x2F;lib<br>Â· system â€“&gt; recovery&#x2F;root&#x2F;system (security å’Œ hw æ–‡ä»¶å¤¹é‡Œçš„å†…å®¹ä½œä¸ºå¤‡ç”¨ï¼Œä¸è¦å¤åˆ¶è¿›å») å¾—åˆ°ä»¥ä¸‹ç›®å½•ç»“æ„</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell">.<br>â”œâ”€â”€ Android.mk<br>â”œâ”€â”€ AndroidProducts.mk<br>â”œâ”€â”€ BoardConfig.mk<br>â”œâ”€â”€ device.mk<br>â”œâ”€â”€ prebuilt<br>â”œâ”€â”€ recovery<br>â”‚Â Â  â””â”€â”€ root<br>â”‚Â Â      â”œâ”€â”€ first_stage_ramdisk<br>â”‚Â Â      â”‚Â Â  â”œâ”€â”€ fstab.emmc<br>â”‚Â Â      â”‚Â Â  â””â”€â”€ fstab.mt6895<br>â”‚Â Â      â”œâ”€â”€ init.recovery.mt6895.rc<br>â”‚Â Â      â”œâ”€â”€ lib<br>â”‚Â Â      â”‚Â Â  â””â”€â”€ modules<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ 8250_mtk.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ adapter_class.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ adsp.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ aee_aed.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ aee_hangdet.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ aee_rs.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ blocktag.ko<br>â”‚Â Â      â”‚Â Â      â””â”€â”€ çœç•¥....<br>â”‚Â Â      â””â”€â”€ system<br>â”‚Â Â          â”œâ”€â”€ bin<br>â”‚Â Â          â”‚Â Â  â””â”€â”€ mtk_plpath_utils<br>â”‚Â Â          â”œâ”€â”€ etc<br>â”‚Â Â          â”‚Â Â  â”œâ”€â”€ recovery.fstab<br>â”‚Â Â          â”‚Â Â  â””â”€â”€ ueventd.rc<br>â”‚Â Â          â””â”€â”€ lib64<br>â”‚Â Â              â””â”€â”€ hw<br>â”‚Â Â                  â””â”€â”€ android.hardware.boot@1.0-impl-1.2-mtkimpl.so<br>â””â”€â”€ twrp_rubens.mk<br></code></pre></td></tr></table></figure>

<p>æ‰“å¼€ init.recovery.mt6895.rc æ·»åŠ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">on boot<br>    start health-hal-2-1<br><br>on post-fs<br>    start boot-hal-1-2<br></code></pre></td></tr></table></figure>

<p>ä¾‹å¦‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">on post-fs<br>    start boot-hal-1-2<br><br>on init<br>    setprop sys.usb.configfs 1<br>    setprop sys.usb.controller &quot;11201000.usb0&quot;<br>    setprop sys.usb.ffs.aio_compat 1<br><br>on fs &amp;&amp; property:ro.debuggable=0<br>    # distinguish USB shoulde connect or not, i.e. CDP vs SDP<br>    # set charging free due to it wait for USB activation<br><br>on boot<br>    start health-hal-2-1<br>    exec u:r:update_engine:s0 root root -- /system/bin/mtk_plpath_utils<br></code></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å¯ä»¥å¼€å§‹ç¼–è¯‘å’¯~~</p>
<p>ç¼–è¯‘</p>
<p>ç¼–è¯‘å‰è¯·æ£€æŸ¥æ³¨é‡Šæ˜¯å¦å…¨éƒ¨åˆ é™¤</p>
<p>twrp æºç æ ¹ç›®å½•æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">. build/envsetup.sh<br>lunch twrp_codename-eng # twrp-9ä¸ºonmi<br>mka vendorbootimage/bootimage/recoveryimage<br></code></pre></td></tr></table></figure>

<p>ä¸å‡ºæ„å¤–çš„è¯ä¸€è·¯ç»¿ç¯ï¼Œå¦‚æœæœ‰æŠ¥é”™çš„è¯è¯·å‘é‚®ç®±è‡³ <a href="mailto:&#49;&#53;&#x39;&#x32;&#53;&#x30;&#49;&#54;&#48;&#x35;&#64;&#x71;&#113;&#46;&#99;&#111;&#109;">&#49;&#53;&#x39;&#x32;&#53;&#x30;&#49;&#54;&#48;&#x35;&#64;&#x71;&#113;&#46;&#99;&#111;&#109;</a> å’¨è¯¢æˆ‘</p>
<p>äº§ç‰©åœ¨ out&#x2F;target&#x2F;product&#x2F;codename&#x2F;vendor_boot.img\boot.img\recovery.img æ‰‹æœºé‡å¯åˆ° fastboot æ¨¡å¼ï¼Œä½¿ç”¨ fastboot flash åˆ·å†™ï¼Œä¾‹å¦‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">fastboot flash vendor_boot /Users/xiaolegun/Downloads/vendor_boot.img<br></code></pre></td></tr></table></figure>

<p>åˆ™è¾“å‡º</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">ERROR: could not clear input pipe; result e0005000, ignoring...<br>ERROR: could not clear output pipe; result e0005000, ignoring....<br>Sending &#x27;vendor_boot_a&#x27; (65536 KB)                 OKAY [  1.396s]<br>Writing &#x27;vendor_boot_a&#x27;                            OKAY [  0.167s]<br>Finished. Total time: 1.625s<br></code></pre></td></tr></table></figure>

<p>å°±å¯ä»¥é‡å¯æŒ‰ç”µæºåŠ éŸ³é‡ä¸Šå°è¯•äº†ï¼Œæˆ‘è‡ªå·±æ˜¯ä¸€æ¬¡ç‚¹äº®ï¼Œä½†æœ‰ bugã€‚</p>
<p>ä¿® BUG</p>
<p>ä¿®å¤ USB</p>
<p>æˆ‘çœ‹åˆ° twrp æ§åˆ¶å°æœ‰å¾ˆå¤šæŠ¥é”™ï¼Œç¬¬ä¸€æ­¥è‚¯å®šæ˜¯å…ˆè·å–æ—¥å¿—ï¼Œä½¿ç”¨logcatå‘½ä»¤è·å–ï¼Œåœ¨æ­¤ä¹‹å‰å…ˆä½¿ç”¨adb devicesæ£€æµ‹ä¸€ä¸‹è®¾å¤‡ usb æ˜¯å¦å·¥ä½œæ­£å¸¸ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~ î‚° adb devices         î‚² âœ” î‚² 10208 î‚² 10:05:31<br>* daemon not running; starting now at tcp:5037<br>* daemon started successfully<br>List of devices attached<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°adbæ²¡æœ‰æ£€æµ‹åˆ°è®¾å¤‡ï¼ŒåŸå› ä¸€èˆ¬æ˜¯ usb çš„é…ç½®ä¸å¯¹ï¼Œä½† usb æ˜¯å¥½çš„ã€‚è¿™æ—¶å¯ä»¥å°è¯•å…³é—­ mtpï¼Œå†å¼€å¯ï¼Œå¦‚æœç”µè„‘æœ‰ååº”ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»§ç»­ä¸‹ä¸€æ­¥äº†ã€‚ åœ¨è®¾å¤‡æ ‘ä¸­çš„ recovery&#x2F;rootï¼Œåˆ›å»º init.recovery.usb.rc çš„æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">touch recovery/root/init.recovery.usb.rc<br></code></pre></td></tr></table></figure>

<p>å¹¶å¯¼å…¥ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">on property:sys.usb.config=mtp,adb<br>    start adbd<br><br>on property:sys.usb.ffs.ready=1 &amp;&amp; property:sys.usb.config=mtp,adb<br>    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration &quot;mtp_adb&quot;<br>    rm /config/usb_gadget/g1/configs/b.1/f1<br>    rm /config/usb_gadget/g1/configs/b.1/f2<br>    rm /config/usb_gadget/g1/configs/b.1/f3<br>    rm /config/usb_gadget/g1/configs/b.1/f4<br>    rm /config/usb_gadget/g1/configs/b.1/f5<br>    write /config/usb_gadget/g1/idVendor 0x18d1<br>    write /config/usb_gadget/g1/idProduct 0x2d08<br>    symlink /config/usb_gadget/g1/functions/mtp.gs0 /config/usb_gadget/g1/configs/b.1/f1<br>    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2<br>    write /config/usb_gadget/g1/UDC $&#123;sys.usb.controller&#125;<br>    setprop sys.usb.state $&#123;sys.usb.config&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™æ˜¯æˆ‘ä»æˆ‘ç»´æŠ¤çš„ MI 6X çš„ device tree æ‹¿è¿‡æ¥çš„ï¼Œå¯ä»¥åœ¨è”å‘ç§‘è®¾å¤‡ä¸Šæ­£å¸¸å·¥ä½œã€‚è¿™æ®µ shell çš„å¤§è‡´æ„æ€å°±æ˜¯åœ¨ usb é…ç½®èŠ‚ç‚¹å†™å…¥ mtp å’Œ adb åŒæ—¶å·¥ä½œçš„å­—ç¬¦ä¸²ï¼Œè¿™æ · adb å°±èƒ½é¡ºåˆ©å·¥ä½œäº†ã€‚</p>
<p>æ­¤å¤–æ‰“å¼€åŸå‚ init.rc ä¿®æ­£ä¸€ä¸‹ usb è®¾å¤‡çš„ id</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">MIUI ADD: START</span><br>import /init.recovery.hardware.rc<br>import /miui.factoryreset.rc<br><span class="hljs-meta prompt_"># </span><span class="language-bash">END</span><br>import /init.recovery.$&#123;ro.hardware&#125;.rc<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">######### çœç•¥ä¸€ä¸‡å­—</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">MIUI ADD: START</span><br>on property:sys.usb.config=mtp,adb &amp;&amp; property:sys.usb.configfs=0<br>    write /sys/class/android_usb/android0/enable 0<br>    write /sys/class/android_usb/android0/idVendor 2717<br>    write /sys/class/android_usb/android0/idProduct 904D<br>    write /sys/class/android_usb/android0/functions mtp,adb<br>    write /sys/class/android_usb/android0/enable 1<br>    setprop sys.usb.state  $&#123;sys.usb.config&#125;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">END</span><br></code></pre></td></tr></table></figure>

<p>å°†&#x2F;sys&#x2F;class&#x2F;android_usb&#x2F;android0&#x2F;idVendorå’Œwrite &#x2F;sys&#x2F;class&#x2F;android_usb&#x2F;android0&#x2F;idProductåé¢çš„ id åˆ†åˆ«æ›¿æ¢åˆ°&#x2F;config&#x2F;usb_gadget&#x2F;g1&#x2F;idVendorå’Œ&#x2F;config&#x2F;usb_gadget&#x2F;g1&#x2F;idProductå¤„ç†å®Œå°±æ˜¯è¿™æ ·çš„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">on property:sys.usb.config=mtp,adb<br>    start adbd<br><br>on property:sys.usb.ffs.ready=1 &amp;&amp; property:sys.usb.config=mtp,adb<br>    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration &quot;mtp_adb&quot;<br>    rm /config/usb_gadget/g1/configs/b.1/f1<br>    rm /config/usb_gadget/g1/configs/b.1/f2<br>    rm /config/usb_gadget/g1/configs/b.1/f3<br>    rm /config/usb_gadget/g1/configs/b.1/f4<br>    rm /config/usb_gadget/g1/configs/b.1/f5<br>    write /config/usb_gadget/g1/idVendor 0x2717<br>    write /config/usb_gadget/g1/idProduct 0x904D<br>    symlink /config/usb_gadget/g1/functions/mtp.gs0 /config/usb_gadget/g1/configs/b.1/f1<br>    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2<br>    write /config/usb_gadget/g1/UDC $&#123;sys.usb.controller&#125;<br>    setprop sys.usb.state $&#123;sys.usb.config&#125;<br></code></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å¼€æœºä¹‹å adb å’Œ mtp å°±èƒ½åŒæ—¶å·¥ä½œäº†ã€‚</p>
<p>ä¿®å¤ Resetprop</p>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥ä¿®å¤å…¶å®ƒ bug äº†ï¼Œæˆ‘çœ‹åˆ°æ§åˆ¶å°æœ‰ä¸€å †çº¢è‰²çš„æŠ¥é”™:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">E:Unknown File System:&#x27;/mi_ext&#x27;<br>E:Unable to override &#x27;external_storage.projid.enabled&#x27; due to missing libresetprop<br>æŒ‚è½½&quot;/data&quot;å¤±è´¥(Invalid argument)<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸‰ä¸ªæŠ¥é”™ä¸­ç¬¬äºŒä¸ªæœ€å¥½ä¿®ï¼Œç¬¬ä¸€ä¸ªæ¬¡ä¹‹ï¼Œç¬¬ä¸‰ä¸ªä¸è§£å¯†æœ‰å…³ï¼Œæ”¾åœ¨å¦ä¸€ä¸ªå¤§ç« èŠ‚è®²ã€‚ ç¬¬äºŒä¸ªæŠ¥é”™åªéœ€è¦åœ¨ BoardConfig.mk ä¸­æ·»åŠ </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># Tool</span><br>TW_INCLUDE_RESETPROP := true<br>TW_INCLUDE_LIBRESETPROP := true<br></code></pre></td></tr></table></figure>

<p>ä¸ç”¨ç¼–è¯‘æµ‹è¯•ç›´æ¥ç§’æ€</p>
<p>ä¿®å¤æŒ‚è½½</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">E:Unknown File System:&#x27;/mi_ext&#x27;<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€ recovery&#x2F;root&#x2F;system&#x2F;etc ä¸­çš„ recovery.fstabï¼Œå‘ç°é‡Œé¢æœ‰å¾ˆå¤šç©ºæ ¼ï¼Œæˆ‘ä»¬å…ˆå°†å®ƒæ ¼å¼åŒ–ä¸€ä¸‹ï¼Œæœ‰å®åŠ›çš„å¯ä»¥æŠŠåé¢çš„ flag ä¹Ÿå¯¹é½æ•´ç†å¥½ã€‚ æˆ‘æ¯”è¾ƒæ²¡å®åŠ›ï¼Œç®€å•æ ¼å¼åŒ–äº†ä¸€ä¸‹ï¼Œæ˜¯è¿™æ ·çš„</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 1</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="hljs-comment"># 341 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="hljs-comment"># 1 &quot;&lt;command line&gt;&quot; 1</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 2</span><br><span class="hljs-comment"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot; 2</span><br><span class="hljs-comment"># 173 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br>system <span class="hljs-regexp">/system erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>system <span class="hljs-regexp">/system ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>vendor /vendor erofs ro wait,slotselect,avb,logical,first_stage_mount<br>vendor /vendor ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>product /product erofs ro wait,slotselect,avb,logical,first_stage_mount<br>product /product ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>mi_ext <span class="hljs-regexp">/mnt/</span>vendor/mi_ext erofs ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail<br>mi_ext <span class="hljs-regexp">/mnt/</span>vendor/mi_ext ext4 ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail<br><span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext /mi</span>_ext none ro,bind wait,nofail<br>overlay <span class="hljs-regexp">/product/</span>overlay overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/overlay/</span>:<span class="hljs-regexp">/product/</span>overlay check,nofail<br>overlay <span class="hljs-regexp">/product/</span>app overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/app/</span>:<span class="hljs-regexp">/product/</span>app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>priv-app overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/priv-app/</span>:<span class="hljs-regexp">/product/</span>priv-app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>lib overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/lib/</span>:<span class="hljs-regexp">/product/</span>lib check,nofail<br>overlay <span class="hljs-regexp">/product/</span>lib64 overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/lib64/</span>:<span class="hljs-regexp">/product/</span>lib64 check,nofail<br>overlay <span class="hljs-regexp">/product/</span>bin overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/bin/</span>:<span class="hljs-regexp">/product/</span>bin check,nofail<br>overlay <span class="hljs-regexp">/product/</span>framework overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/framework/</span>:<span class="hljs-regexp">/product/</span>framework check,nofail<br>overlay <span class="hljs-regexp">/product/m</span>edia overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/media/</span>:<span class="hljs-regexp">/product/m</span>edia check,nofail<br>overlay <span class="hljs-regexp">/product/</span>opcust overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/opcust/</span>:<span class="hljs-regexp">/product/</span>opcust check,nofail<br>overlay <span class="hljs-regexp">/product/</span>data-app overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/data-app/</span>:<span class="hljs-regexp">/product/</span>data-app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/sysconfig overlay ro,lowerdir=/m</span>nt<span class="hljs-regexp">/vendor/mi</span>_ext<span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/sysconfig/</span>:<span class="hljs-regexp">/product/</span>etc/sysconfig check,nofail<br>overlay <span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/permissions overlay ro,lowerdir=/m</span>nt<span class="hljs-regexp">/vendor/mi</span>_ext<span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/product/</span>etc/permissions check,nofail<br>overlay <span class="hljs-regexp">/system/</span>app overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>system<span class="hljs-regexp">/app/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>app<span class="hljs-regexp">/:/</span>system/app check,nofail<br>overlay <span class="hljs-regexp">/system/</span>priv-app overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>system<span class="hljs-regexp">/priv-app/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>priv-app<span class="hljs-regexp">/:/</span>system/priv-app check,nofail<br>overlay <span class="hljs-regexp">/system/</span>framework overlay ro,lowerdir=<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>framework<span class="hljs-regexp">/:/</span>system/framework check,nofail<br>overlay <span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/sysconfig overlay ro,lowerdir=/m</span>nt<span class="hljs-regexp">/vendor/mi</span>_ext<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/sysconfig/</span>:<span class="hljs-regexp">/system/</span>etc/sysconfig check,nofail<br>overlay <span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions overlay ro,lowerdir=/m</span>nt<span class="hljs-regexp">/vendor/mi</span>_ext<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/system/</span>etc/permissions check,nofail<br>system_ext <span class="hljs-regexp">/system_ext erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>system_ext <span class="hljs-regexp">/system_ext ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>odm /odm erofs ro wait,slotselect,avb,logical,first_stage_mount<br>odm /odm ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>vendor_dlkm /vendor_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount<br>odm_dlkm /odm_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>etadata /metadata ext4 noatime,nosuid,nodev,discard wait,check,formattable,first_stage_mount<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/u</span>serdata <span class="hljs-regexp">/data f2fs noatime,nosuid,nodev,discard,noflush_merge,fsync_mode=nobarrier,reserve_root=134217,resgid=1065,checkpoint_merge,gc_merge,inlinecrypt wait,check,formattable,quota,latemount,resize,reservedsize=128m,checkpoint=fs,fileencryption=aes-256-xts:aes-256-cts:v2+inlinecrypt_optimized,keydirectory=/m</span>etadata<span class="hljs-regexp">/vold/m</span>etadata_encryption,fsverity<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>rescue /cache ext4 noatime,nosuid,nodev,noauto_da_alloc,discard wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>protect1 <span class="hljs-regexp">/mnt/</span>vendor/protect_f ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>protect2 <span class="hljs-regexp">/mnt/</span>vendor/protect_s ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvdata <span class="hljs-regexp">/mnt/</span>vendor/nvdata ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvcfg <span class="hljs-regexp">/mnt/</span>vendor/nvcfg ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>persist <span class="hljs-regexp">/mnt/</span>vendor/persist ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/devices/</span>platform<span class="hljs-regexp">/soc/</span><span class="hljs-number">11240000</span>.mmc* auto auto defaults voldmanaged=sdcard1:auto,encryptable=userdata<br><span class="hljs-regexp">/devices/</span>platform/usb_xhci* auto vfat defaults voldmanaged=usbotg:auto<br><span class="hljs-regexp">/devices/</span>platform<span class="hljs-regexp">/soc/</span><span class="hljs-number">11201000</span>.usb0/<span class="hljs-number">11200000</span>.xhci* auto vfat defaults voldmanaged=usbotg:auto<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>frp /persistent emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvram /nvram emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>proinfo /proinfo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>lk /bootloader emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>lk2 /bootloader2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>para /para emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/mi</span>sc /misc emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>boot /boot emmc defaults first_stage_mount,nofail,slotselect<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta_vendor /vbmeta_vendor emmc defaults first_stage_mount,nofail,slotselect<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta_system /vbmeta_system emmc defaults first_stage_mount,nofail,slotselect,avb=vbmeta<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>logo /logo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>expdb /expdb emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>seccfg /seccfg emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>tee1 /tee1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>tee2 /tee2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>scp1 /scp1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>scp2 /scp2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>sspm_1 /sspm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>sspm_2 /sspm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dpm_1 /dpm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dpm_2 /dpm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>cupm_1 /mcupm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>cupm_2 /mcupm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1img /md1img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1dsp /md1dsp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1arm7 /md1arm7 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d3img /md3img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/g</span>z1 /gz1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/g</span>z2 /gz2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>spmfw /spmfw emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>audio_dsp /audio_dsp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>pi_img /pi_img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>boot_para /boot_para emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>odmdtbo /odmdtbo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dtbo /dtbo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>otp /otp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta /vbmeta emmc defaults defaults<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œé¢æœ‰å¾ˆå¤šæ— ç”¨åˆ†åŒºï¼Œæˆ‘ä»¬åœ¨ twrp ä¸­æ“ä½œä¸åˆ°ï¼Œä½†æ˜¯æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡é€‚é… MTK è®¾å¤‡ï¼Œæ‰€ä»¥ä¸â€çè¯´â€è¯¯äººå­å¼Ÿäº†ï¼Œå…ˆæŠŠ bug ä¿®å¥½ã€‚ åƒ xiaomi è¿™æ ·å¸¸è§çš„æŒ‚è½½é”™è¯¯ï¼Œæˆ‘è‡ªå·±ä¸€èˆ¬éƒ½æ˜¯å°è¯•æŠŠ&#x2F;mnt&#x2F;vendor ä½¿ç”¨ vscode å…¨éƒ¨åˆ é™¤ï¼Œè®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚å¹¶ä¸”è¦æŠŠè¿™ä¸€è¡Œåˆ é™¤ï¼Œè¿™è¡Œåœ¨æˆ‘çœ‹æ¥æ˜¯é‡å¤å®šä¹‰ï¼ˆï¼Ÿè€Œä¸”ä¹Ÿæ²¡æŒ‡å®šåˆ†åŒºæ ¼å¼ã€‚</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext /mi</span>_ext none ro,bind wait,nofail<br></code></pre></td></tr></table></figure>

<p>æ•´ç†å®Œä¹‹åæ˜¯è¿™æ ·çš„</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 1</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="hljs-comment"># 341 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="hljs-comment"># 1 &quot;&lt;command line&gt;&quot; 1</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 2</span><br><span class="hljs-comment"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot; 2</span><br><span class="hljs-comment"># 173 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br>system <span class="hljs-regexp">/system erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>system <span class="hljs-regexp">/system ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>vendor /vendor erofs ro wait,slotselect,avb,logical,first_stage_mount<br>vendor /vendor ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>product /product erofs ro wait,slotselect,avb,logical,first_stage_mount<br>product /product ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>mi_ext /mi_ext erofs ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail<br>mi_ext /mi_ext ext4 ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail<br>overlay <span class="hljs-regexp">/product/</span>overlay overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/overlay/</span>:<span class="hljs-regexp">/product/</span>overlay check,nofail<br>overlay <span class="hljs-regexp">/product/</span>app overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/app/</span>:<span class="hljs-regexp">/product/</span>app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>priv-app overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/priv-app/</span>:<span class="hljs-regexp">/product/</span>priv-app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>lib overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/lib/</span>:<span class="hljs-regexp">/product/</span>lib check,nofail<br>overlay <span class="hljs-regexp">/product/</span>lib64 overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/lib64/</span>:<span class="hljs-regexp">/product/</span>lib64 check,nofail<br>overlay <span class="hljs-regexp">/product/</span>bin overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/bin/</span>:<span class="hljs-regexp">/product/</span>bin check,nofail<br>overlay <span class="hljs-regexp">/product/</span>framework overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/framework/</span>:<span class="hljs-regexp">/product/</span>framework check,nofail<br>overlay <span class="hljs-regexp">/product/m</span>edia overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/media/</span>:<span class="hljs-regexp">/product/m</span>edia check,nofail<br>overlay <span class="hljs-regexp">/product/</span>opcust overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/opcust/</span>:<span class="hljs-regexp">/product/</span>opcust check,nofail<br>overlay <span class="hljs-regexp">/product/</span>data-app overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/data-app/</span>:<span class="hljs-regexp">/product/</span>data-app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/sysconfig overlay ro,lowerdir=/mi</span>_ext<span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/sysconfig/</span>:<span class="hljs-regexp">/product/</span>etc/sysconfig check,nofail<br>overlay <span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/permissions overlay ro,lowerdir=/mi</span>_ext<span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/product/</span>etc/permissions check,nofail<br>overlay <span class="hljs-regexp">/system/</span>app overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>system<span class="hljs-regexp">/app/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>app<span class="hljs-regexp">/:/</span>system/app check,nofail<br>overlay <span class="hljs-regexp">/system/</span>priv-app overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>system<span class="hljs-regexp">/priv-app/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>priv-app<span class="hljs-regexp">/:/</span>system/priv-app check,nofail<br>overlay <span class="hljs-regexp">/system/</span>framework overlay ro,lowerdir=<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>framework<span class="hljs-regexp">/:/</span>system/framework check,nofail<br>overlay <span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/sysconfig overlay ro,lowerdir=/mi</span>_ext<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/sysconfig/</span>:<span class="hljs-regexp">/system/</span>etc/sysconfig check,nofail<br>overlay <span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions overlay ro,lowerdir=/mi</span>_ext<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/system/</span>etc/permissions check,nofail<br>system_ext <span class="hljs-regexp">/system_ext erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>system_ext <span class="hljs-regexp">/system_ext ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>odm /odm erofs ro wait,slotselect,avb,logical,first_stage_mount<br>odm /odm ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>vendor_dlkm /vendor_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount<br>odm_dlkm /odm_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>etadata /metadata ext4 noatime,nosuid,nodev,discard wait,check,formattable,first_stage_mount<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/u</span>serdata <span class="hljs-regexp">/data f2fs noatime,nosuid,nodev,discard,noflush_merge,fsync_mode=nobarrier,reserve_root=134217,resgid=1065,checkpoint_merge,gc_merge,inlinecrypt wait,check,formattable,quota,latemount,resize,reservedsize=128m,checkpoint=fs,fileencryption=aes-256-xts:aes-256-cts:v2+inlinecrypt_optimized,keydirectory=/m</span>etadata<span class="hljs-regexp">/vold/m</span>etadata_encryption,fsverity<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>rescue /cache ext4 noatime,nosuid,nodev,noauto_da_alloc,discard wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>protect1 /protect_f ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>protect2 /protect_s ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvdata /nvdata ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvcfg /nvcfg ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>persist /persist ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/devices/</span>platform<span class="hljs-regexp">/soc/</span><span class="hljs-number">11240000</span>.mmc* auto auto defaults voldmanaged=sdcard1:auto,encryptable=userdata<br><span class="hljs-regexp">/devices/</span>platform/usb_xhci* auto vfat defaults voldmanaged=usbotg:auto<br><span class="hljs-regexp">/devices/</span>platform<span class="hljs-regexp">/soc/</span><span class="hljs-number">11201000</span>.usb0/<span class="hljs-number">11200000</span>.xhci* auto vfat defaults voldmanaged=usbotg:auto<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>frp /persistent emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvram /nvram emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>proinfo /proinfo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>lk /bootloader emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>lk2 /bootloader2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>para /para emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/mi</span>sc /misc emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>boot /boot emmc defaults first_stage_mount,nofail,slotselect<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta_vendor /vbmeta_vendor emmc defaults first_stage_mount,nofail,slotselect<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta_system /vbmeta_system emmc defaults first_stage_mount,nofail,slotselect,avb=vbmeta<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>logo /logo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>expdb /expdb emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>seccfg /seccfg emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>tee1 /tee1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>tee2 /tee2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>scp1 /scp1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>scp2 /scp2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>sspm_1 /sspm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>sspm_2 /sspm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dpm_1 /dpm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dpm_2 /dpm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>cupm_1 /mcupm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>cupm_2 /mcupm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1img /md1img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1dsp /md1dsp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1arm7 /md1arm7 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d3img /md3img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/g</span>z1 /gz1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/g</span>z2 /gz2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>spmfw /spmfw emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>audio_dsp /audio_dsp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>pi_img /pi_img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>boot_para /boot_para emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>odmdtbo /odmdtbo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dtbo /dtbo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>otp /otp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta /vbmeta emmc defaults defaults<br></code></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬ç¼–è¯‘è¯•ä¸€ä¸‹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œtwrp æ¯æ¬¡æ›´æ”¹æœ€å¥½åˆ é™¤ out é‡æ–°ç¼–è¯‘ï¼Œä¸è¦ä½¿ç”¨å¦‚make installcleanç­‰å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¼€æœºé»‘å±æˆ–æ›´æ”¹ä¸ç”Ÿæ•ˆã€‚ ç»è¿‡ä¸€åˆ†é’Ÿï¼Œç¼–è¯‘å¥½äº†ï¼Œåˆ·å…¥ï¼Œå¼€æœºï¼Œå¯åŠ¨ï¼å¯ä»¥çœ‹è§æŒ‚è½½æˆåŠŸè¢«ä¿®å¥½ã€‚</p>
<p>ä¿®å¤å±å¹•æ˜¾ç¤º</p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç°åœ¨å±å¹•çš„é¡¶éƒ¨çš„æ—¶é—´è¢«æ‘„åƒå¤´æŒ–å­”æŒ¡ä½äº†ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªåç§» Flag æ¥ä¿®å¤å®ƒã€‚ åœ¨ BoardConfig.mk ä¸­ï¼ŒåŠ å…¥ä»¥ä¸‹ flag</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile">TW_Y_OFFSET := 106 <span class="hljs-comment">#å¯¼èˆªæ å‘ä¸Š</span><br>TW_H_OFFSET := -106 <span class="hljs-comment">#ç•Œé¢æ•´ä½“å‘ä¸‹</span><br></code></pre></td></tr></table></figure>

<p>ä¿®å¤æŒ¯åŠ¨</p>
<p>ä»…ä¾›å‚è€ƒï¼Œç ”ç©¶åŠå¤©å‘ç°åªæœ‰è§£å¯†åŠŸèƒ½æ­£å¸¸æ‰èƒ½ä¿®æŒ¯åŠ¨ï¼Œä¸ç„¶ä¼šå†»å±ï¼ï¼ï¼</p>
<p>ä¸ä¸€å®šæ­£ç¡®ï¼Œä¹Ÿä¸ä¸€å®šæ™®éï¼Œä»…ä¾›æŒ‡è·¯</p>
<p>è€è®¾å¤‡ä¸€èˆ¬éƒ½æ˜¯æ­£å¸¸çš„ï¼Œä¸éœ€è¦é¢å¤–å¤„ç†ï¼Œæ–°è®¾å¤‡ä½¿ç”¨ aidl hal éœ€è¦æˆ‘ä»¬è‡ªå·±å¤„ç†ä¸€ä¸‹è®© service æ­£å¸¸å·¥ä½œã€‚ æŒ‚è½½ vendorï¼Œä½¿ç”¨ twrp çš„æ–‡ä»¶ç®¡ç†ï¼Œåœ¨ vendor&#x2F;etc&#x2F;vintf&#x2F;manifest æ‰¾åˆ°å«æœ‰ vibrator å­—æ ·çš„æ–‡ä»¶ã€‚æ‰“å¼€ä¹‹åæ£€æŸ¥æ˜¯å¦ç±»ä¼¼è¿™æ ·çš„æ–‡æ®µ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.0&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;device&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hal</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;aidl&quot;</span> <span class="hljs-attr">override</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>android.hardware.vibrator<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">fqname</span>&gt;</span>IVibrator/vibratorfeature<span class="hljs-tag">&lt;/<span class="hljs-name">fqname</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">hal</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>é‚£æ­å–œä½ ï¼Œæ‰¾å¯¹äº†ï¼Œæˆ‘çš„æ–‡ä»¶åæ˜¯ vendor.xiaomi.hardware.vibratorfeature.service.xml å°†å®ƒä½¿ç”¨adb pullæ”¾åˆ°ç”µè„‘ä¸Šè‡ªå·±æ–¹ä¾¿çš„ä½ç½®å¤‡ç”¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /vendor/etc/vintf/manifest/vendor.xiaomi.hardware.vibratorfeature.service.xml .<br>/vendor/etc/vintf/manifest/vendor.xiao...ipped. 0.2 MB/s (1718 bytes in 0.009s)<br></code></pre></td></tr></table></figure>

<p>ä¸çœ‹æ‰©å±•åï¼Œåˆ° vendor&#x2F;bin&#x2F;hw&#x2F;æ‰¾åˆ°åŒåçš„ service åŒæ ·åˆ©ç”¨adb pullæ”¾ç”µè„‘å¤‡ç”¨ã€‚æ¯”å¦‚æˆ‘çš„å« vendor.xiaomi.hardware.vibratorfeature.service ç„¶ååˆ° vendor&#x2F;etc&#x2F;init&#x2F;æ‰¾åˆ°åŒå.rc æ–‡ä»¶ï¼Œæ‹‰åˆ°ç”µè„‘ä¸Šï¼Œåœ¨é‡Œé¢åŠ ä¸€æ¡ã€‚å¹¶åœ¨å®šä¹‰ service çš„æœ€ä¸‹é¢åŠ ä¸Šseclabel u:r:recovery:s0å¯ä»¥è¢« recovery ä½¿ç”¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">on boot<br>    start serviceè¢«å®šä¹‰çš„åå­—<br></code></pre></td></tr></table></figure>

<p>ä¾‹å¦‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">on post-fs-data<br>    chown system system /sys/bus/i2c/drivers/aw8697_haptic/2-005a/f0_save<br>    chown system system /sys/bus/i2c/drivers/aw8697_haptic/2-005a/osc_save<br>    chown system system /sys/bus/i2c/drivers/aw8697_haptic/3-005a/osc_save<br>    # çœç•¥ä¸€ä¸‡å­—<br><br>on boot<br>    start vibratorfeature-hal-service<br><br>service vibratorfeature-hal-service /vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service<br>    class hal<br>    user system<br>    group system input<br>    onrestart restart vibratorfeature<br>    seclabel u:r:recovery:s0<br></code></pre></td></tr></table></figure>

<p>æ­¤å¤–è¿™ç§æ–°è®¾å¤‡åœ¨å†…æ ¸é‡Œè¿˜æœ‰æŒ¯åŠ¨æ¨¡å—éœ€è¦åŠ è½½ï¼Œè¯·åˆ°&#x2F;vendor&#x2F;modules&#x2F;1.1&#x2F;ä¸­å¯»æ‰¾ï¼Œä¾‹å¦‚æˆ‘è¿™å°è®¾å¤‡æ˜¯haptic.koï¼Œç”¨ adb pull æ‹‰å–åˆ°ç”µè„‘ä¸Šï¼Œç„¶å</p>
<p>Â· haptic.ko â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;modules&#x2F;1.1</p>
<p>è‡³æ­¤æ‰€æœ‰å¿…è¦çš„èµ„æ–™å°±å‡†å¤‡å¥½äº†ã€‚å¯èƒ½å¼€æœºåä»ç„¶ä¸å·¥ä½œï¼Œéœ€è¦æŠ“å– log è¡¥ç¼ºå¤±çš„ libraryï¼Œå½“ç„¶è¿™æ˜¯åè¯äº†ã€‚</p>
<p>å¼€å¹²ï¼</p>
<p>åœ¨ BoardConfig.mk ä¸­åŠ å…¥ä»¥ä¸‹ flag</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile">TW_SUPPORT_INPUT_AIDL_HAPTICS := true<br></code></pre></td></tr></table></figure>

<p>å°†å¤‡ç”¨æ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æ“ä½œå¤åˆ¶</p>
<p>Â· vendor.xiaomi.hardware.vibratorfeature.service.xml â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;etc&#x2F;vintf&#x2F;manifest<br>Â· vendor.xiaomi.hardware.vibratorfeature.service â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;bin&#x2F;hw<br>Â· vendor.xiaomi.hardware.vibratorfeature.service.rc â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;etc&#x2F;init</p>
<p>ä¹‹åç¼–è¯‘ï¼Œåˆ·å…¥ï¼Œå¼€æœºï¼Œå–œæå†»å±â€¦â€¦ é—®é¢˜ä¸å¤§ï¼Œä½¿ç”¨adb logcatæŠ“å–æ—¥å¿—</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">adb logcat &gt; log.log<br></code></pre></td></tr></table></figure>

<p>æ‰“å¼€ logï¼Œæœç´¢F linkerã€linkerã€libraryã€beginning of crashè¿™å‡ ä¸ªå…³é”®è¯ï¼Œæˆ‘æœç´¢ç¬¬ä¸€ä¸ªå°±å‡ºæ¥äº†ã€‚</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">F linker  : CANNOT <span class="hljs-keyword">LINK</span> EXECUTABLE <span class="hljs-string">&quot;/vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service&quot;</span>: library <span class="hljs-string">&quot;android.hardware.vibrator-V1-ndk_platform.so&quot;</span> <span class="hljs-literal">not</span> found: needed <span class="hljs-keyword">by</span> main executable<br></code></pre></td></tr></table></figure>

<p>è¿™æ®µæŠ¥é”™çš„æ„æ€å°±æ˜¯vendor.xiaomi.hardware.vibratorfeature.serviceæ‰¾ä¸åˆ°android.hardware.vibrator-V1-ndk_platform.soè¿™ä¸ªåº“ï¼Œæ‰€ä»¥æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p>
<p>æ‰“å¼€ BoardConfig.mk åŠ å…¥ä»¥ä¸‹ flag</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># Library</span><br>TARGET_RECOVERY_DEVICE_MODULES += \<br>    android.hardware.vibrator-V1-ndk_platform.vendor<br><br>TW_RECOVERY_ADDITIONAL_RELINK_LIBRARY_FILES += \<br>    <span class="hljs-variable">$(TARGET_OUT_SHARED_LIBRARIES)</span>/android.hardware.vibrator-V1-ndk_platform.so<br></code></pre></td></tr></table></figure>

<p>å†æ¬¡ç¼–è¯‘å°è¯• å¼€æœºä¹‹åä¾ç„¶å†»å±ï¼Œç»§ç»­æŠ“ logï¼ŒæŸ¥æ‰¾</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">F linker  : CANNOT <span class="hljs-keyword">LINK</span> EXECUTABLE <span class="hljs-string">&quot;/vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service&quot;</span>: library <span class="hljs-string">&quot;vendor.hardware.vibratorfeature.IVibratorExt-V1-ndk_platform.so&quot;</span> <span class="hljs-literal">not</span> found: needed <span class="hljs-keyword">by</span> main executable<br></code></pre></td></tr></table></figure>

<p>vendor.hardware.vibratorfeatureå­—æ ·å’Œæˆ‘ä»¬ä¹‹å‰å¯¼å…¥çš„æ–‡ä»¶é•¿å¾—å·®ä¸å¤šï¼Œä¸€èˆ¬éƒ½æ˜¯ä¾›åº”å•†ä¸“æœ‰æ–‡ä»¶ï¼Œæ‰€ä»¥å»è®¾å¤‡æå–ï¼Œè·¯å¾„åœ¨ vendor&#x2F;lib64 é‡Œï¼Œè™½ç„¶è®¾å¤‡å†»å±äº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨adb pullç›´æ¥æ‹‰å–åˆ°ç”µè„‘ã€‚å°±åƒè¿™æ ·ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb shell mount /vendor<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /vendor/lib64/vendor.hardware.vibratorfeature.IVibratorExt-V1-ndk_platform.so .<br>/vendor/lib64/vendor.hardware.vibratorfeature.IVi...led, 0 skipped. 14.7 MB/s (33552 bytes in 0.002s<br></code></pre></td></tr></table></figure>

<p>å°†è¿™ä¸ªæ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æç¤ºæ“ä½œ</p>
<p>Â· vendor.hardware.vibratorfeature.IVibratorExt-V1-ndk_platform.so â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;lib64</p>
<p>ç»§ç»­ç¼–è¯‘æµ‹è¯• è¿˜æ˜¯å†»å±ï¼Œç»§ç»­æŠ“ log</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">F linker  : CANNOT <span class="hljs-keyword">LINK</span> EXECUTABLE <span class="hljs-string">&quot;/vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service&quot;</span>: library <span class="hljs-string">&quot;libtinyalsa.so&quot;</span> <span class="hljs-literal">not</span> found: needed <span class="hljs-keyword">by</span> main executable<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸ª library twrp çš„æºç ä¸­åº”è¯¥æ²¡æœ‰ï¼Œå»è®¾å¤‡æ‹¿ä¸€ä¸ª prebuilt å§</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb shell mount /system_root<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /system_root/system/lib64/libtinyalsa.so .<br>/system_root/system/lib64/libtinyalsa.so: 1 file ...led, 0 skipped. 13.6 MB/s (45032 bytes in 0.003s<br></code></pre></td></tr></table></figure>

<p>å°†è¿™ä¸ªæ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æç¤ºæ“ä½œ</p>
<p>Â· libtinyalsa.so â€“&gt; recovery&#x2F;root&#x2F;system&#x2F;lib64</p>
<p>ç¼–è¯‘æµ‹è¯• æˆ‘è‰¹äº†ï¼Œè¿˜æ˜¯å†»å±ï¼Œè¿™æ¬¡æœé‚£å‡ ä¸ªå…³é”®è¯éƒ½æœä¸åˆ°äº†ï¼Œæœvibratorçœ‹çœ‹è¿™é¬¼ä¸œè¥¿æŠ¥ä»€ä¹ˆ</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">E vendor<span class="hljs-selector-class">.xiaomi</span><span class="hljs-selector-class">.hardware</span><span class="hljs-selector-class">.vibratorfeature</span><span class="hljs-selector-class">.service</span>: fail to load lib : /vendor/lib64/libaachaptics.so<br></code></pre></td></tr></table></figure>

<p>è¿™æ¬¡éƒ½ç›´æ¥ç»™è·¯å¾„äº†ï¼Œç›´æ¥æ‹¿ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb shell mount /vendor<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /vendor/lib64/libaachaptics.so .<br>/vendor/lib64/libaachaptics.so: 1 file pulled, 0 skipped. 15.8 MB/s (56232 bytes in 0.003s)<br></code></pre></td></tr></table></figure>

<p>å°†è¿™ä¸ªæ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æç¤ºæ“ä½œ</p>
<p>Â· libaachaptics.so â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;lib64</p>
<p>è‡³æ­¤åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜äº†ï¼Œä½†æ˜¯æœ‰ä¸ª flag è²Œä¼¼è¦æ“ä½œ data å†…çš„ä¸œè¥¿ï¼Œæœªè§£å¯†ä¼šå¯¼è‡´å†»å±ï¼Œæ‰€ä»¥ç­‰ä¿®å®Œè§£å¯†åå†æ¥ä¿®æŒ¯åŠ¨ã€‚</p>
<p>ä¿®å¤ CPU æ¸©åº¦</p>
<p>ä½¿ç”¨adb shell + grepå‘½ä»¤åœ¨æ‰‹æœºèŠ‚ç‚¹é‡Œæœç´¢ type å…³é”®è¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~ î‚° adb shell &#x27;grep &quot;cp_master&quot; /sys/class/thermal/*/type&#x27;<br>/sys/class/thermal/thermal_zone54/type:cp_master<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~ î‚° adb shell &#x27;grep &quot;cpu&quot; /sys/class/thermal/*/type&#x27;<br>/sys/class/thermal/thermal_zone1/type:cpu_little1<br>/sys/class/thermal/thermal_zone10/type:cpu_bigbig1<br>/sys/class/thermal/thermal_zone11/type:cpu_big6<br>/sys/class/thermal/thermal_zone12/type:cpu_bigbig2<br>/sys/class/thermal/thermal_zone2/type:cpu_little2<br>/sys/class/thermal/thermal_zone3/type:cpu_little3<br>/sys/class/thermal/thermal_zone4/type:cpu_little4<br>/sys/class/thermal/thermal_zone5/type:cpu_big1<br>/sys/class/thermal/thermal_zone6/type:cpu_big2<br>/sys/class/thermal/thermal_zone7/type:cpu_big3<br>/sys/class/thermal/thermal_zone8/type:cpu_big4<br>/sys/class/thermal/thermal_zone9/type:cpu_big5<br></code></pre></td></tr></table></figure>

<p>æˆ‘è¿™é‡Œé€‰ç”¨cp_masterèŠ‚ç‚¹æ¥è¯»å–æ¸©åº¦ã€‚æˆ‘çš„èŠ‚ç‚¹è·¯å¾„ä¸º&#x2F;sys&#x2F;class&#x2F;thermal&#x2F;thermal_zone54åœ¨åé¢æ·»åŠ  temp æ¥è¯»å–æ¸©åº¦ï¼Œä½ å¯ä»¥ä½¿ç”¨catæ¥æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å¯ä»¥æ­£å¸¸è¯»å–æ¸©åº¦</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">adb shell &#x27;cat /sys/class/thermal/thermal_zone54/temp&#x27;<br></code></pre></td></tr></table></figure>

<p>å¦‚æœè¿”å›å¦‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">28000<br></code></pre></td></tr></table></figure>

<p>è¿™ç§ç±»ä¼¼çš„æ•°å€¼ï¼Œé‚£å¤šåŠæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ æˆ‘ä»¬åœ¨ BoardConfig.mk ä¸­åŠ å…¥</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile">TW_CUSTOM_CPU_TEMP_PATH := <span class="hljs-string">&quot;/sys/class/thermal/thermal_zone54/temp&quot;</span><br></code></pre></td></tr></table></figure>

<p>è‡³æ­¤ cpu æ¸©åº¦å°±ä¿®å¤å¥½äº†ã€‚</p>
<p>ååº</p>
<p>è¿™æ˜¯æˆ‘ç© Android ä¸¤å¹´å†…ç¬¬ä¸€æ¬¡å†™å…³äº Android çš„æ–‡ç« ï¼Œå†…å®¹å’Œæªè¾å¯èƒ½ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œå†åŠ ä¸Šå¼€å­¦ç„¦è™‘ï¼Œç§Ÿæˆ¿å› ç§Ÿé‡‘å’Œæˆ¿æºä¸é¡ºåˆ©ï¼Œå†™çš„å¾ˆä¹±ï¼Œè¯·å„ä½æŒ‡æ­£ã€‚ è§£å¯†ç­‰æœ‰ç©ºè¡¥ï¼Œå…ˆè¡¥ä½œä¸šã€‚</p>
<p>æœ‰å®åŠ›çš„å·¨ä½¬ä»¬ç»™ç‚¹é¥­æ°ï¼ˆ çˆ±å‘ç”µï¼šxiaoleGunæˆ–åšå®¢å¾®ä¿¡æ— æ‰‹ç»­è´¹</p>
<p>å‚è€ƒèµ„æ–™</p>
<p>Google - æ·»åŠ æ–°è®¾å¤‡</p>
<p>Google - A&#x2F;Bï¼ˆæ— ç¼ï¼‰ç³»ç»Ÿæ›´æ–°</p>
<p>Lynnrin - å¿«é€Ÿä¸Šæ‰‹ Android Custom ROM é€‚é… - Prebuilt Vendor</p>
<p>Google - ä¾›åº”å•†æ¥å£å¯¹è±¡</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%88%B7%E6%9C%BA%E6%97%A5%E5%B8%B8/" class="category-chain-item">åˆ·æœºæ—¥å¸¸</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%88%B7%E6%9C%BA/" class="print-no-link">#åˆ·æœº</a>
      
        <a href="/tags/twrp/" class="print-no-link">#twrp</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree</div>
      <div>https://moranwp.eu.org/writing-device-tree-twrp.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>å¢¨æŸ“_nlx</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2025å¹´11æœˆ11æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/avbtool.html" title="ä½¿ç”¨avbtool ä¸ºAndroid é•œåƒç­¾åä»¥å¯åŠ¨ä¸»çº¿Linux">
                        <span class="hidden-mobile">ä½¿ç”¨avbtool ä¸ºAndroid é•œåƒç­¾åä»¥å¯åŠ¨ä¸»çº¿Linux</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createCssLink('https://cdn.staticfile.org/waline/2.15.5/waline.min.css')
      Fluid.utils.createScript('https://cdn.staticfile.org/waline/2.15.5/waline.min.js', function() {
        var options = Object.assign(
          {"serverURL":"https://comment.moranwp.eu.org","path":"window.location.pathname","meta":["nick","mail","link"],"requiredMeta":["nick"],"lang":"zh-CN","emoji":["https://cdn.jsdelivr.net/gh/morannlx/emojis@v1.2.2/coolapk"],"dark":"html[data-user-color-scheme=\"dark\"]","wordLimit":0,"pageSize":10},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        Waline.init(options);
        Fluid.utils.waitElementVisible('#waline .vcontent', () => {
          var imgSelector = '#waline .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <span>åšå®¢ï¼šHexo</span> <span>ä¸»é¢˜ï¼šFluid</span> <div style="font-size: 0.85rem"> <span id="timeDate">è½½å…¥å¤©æ•°...</span> <script src="/js/runningday.js"></script> </div> <div> <div> <a target="_blank" rel="noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral">æœ¬ç½‘ç«™ç”± <img src="images/upyun1.png" srcset="/img/loading.gif" lazyload width="45px" />æä¾›CDNåŠ é€Ÿ/äº‘å­˜å‚¨æœåŠ¡</a> </div>
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/js/more.js"></script>
<script src="/js/snow.js"></script>
<script src="/js/scrollAnimation.js"></script>



<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
