<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree</title>
    <link href="/writing-device-tree-twrp.html"/>
    <url>/writing-device-tree-twrp.html</url>
    
    <content type="html"><![CDATA[<h1 id="åŸæ–‡ä½œè€…-XiaoleGunï¼Œå› ä¸ºåŸä½œè€…åšå®¢å¯„äº†æ•…æ¬è¿è‡³åšå®¢ä¾›è‡ªå·±å­¦ä¹ å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤"><a href="#åŸæ–‡ä½œè€…-XiaoleGunï¼Œå› ä¸ºåŸä½œè€…åšå®¢å¯„äº†æ•…æ¬è¿è‡³åšå®¢ä¾›è‡ªå·±å­¦ä¹ å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤" class="headerlink" title="åŸæ–‡ä½œè€… XiaoleGunï¼Œå› ä¸ºåŸä½œè€…åšå®¢å¯„äº†æ•…æ¬è¿è‡³åšå®¢ä¾›è‡ªå·±å­¦ä¹ å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤"></a>åŸæ–‡ä½œè€… XiaoleGunï¼Œå› ä¸ºåŸä½œè€…åšå®¢å¯„äº†æ•…æ¬è¿è‡³åšå®¢ä¾›è‡ªå·±å­¦ä¹ å‚è€ƒï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤</h1><p>ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree</p><p>ä¸€äº›è‡ªåº</p><p>è¿™ç¯‡æ•™ç¨‹ä¸­å¯èƒ½æœ‰äº›ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·å„ä½æŒ‡æ­£ï¼Œæˆ‘ä¹Ÿåˆšæ¥è§¦ Android è®¾å¤‡æµ‹å¼€å‘ä¸¤å¹´ï¼Œè€Œä¸”åªæœ‰åœ¨èŠ‚å‡æ—¥çš„æ—¶å€™æœ‰ç©ºä¸€ä¸ªäººçæ£é¼“ï¼Œä¸ºäº†<del>è–… mjw ç¾Šæ¯›</del>ï¼Œæ•…å†™è¿™ç¯‡æ•™ç¨‹ï¼Œè€Œä¸”æˆ‘ä¸ªäººæ›´æ¨è Aosp Recovery åˆ·å†™ç¬¬ä¸‰æ–¹ ROMï¼ŒTWRP å¯èƒ½å¤šå¤šå°‘å°‘æœ‰äº›é—®é¢˜ã€‚Root ä¹‹ç±»çš„ä¸éœ€è¦ TWRP ä¹Ÿå¯ä»¥ï¼Œå¯ä»¥æ‰¾åˆ°åŸæœº boot ä½¿ç”¨ Magisk è¿›è¡Œä¿®è¡¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ KernelSUã€‚å¦å¤–æˆ‘çš„è¯­æ–‡åŠŸåº•ä¸æ˜¯å¾ˆå¥½ï¼Œå†™ä¸å‡ºè¾è—»ï¼Œåªèƒ½æ˜¯åŒ—æ–¹åœ°é“çš„å¤§ç™½è¯ï¼Œè§è°…å“ˆ ğŸ¤£&#x2F;&#x2F;&#x2F;</p><p>å‡†å¤‡å·¥ä½œ</p><ol><li>ä¸€é¢—å‹‡æ•¢çš„ã€ä¸æ€•å›°éš¾çš„å¼ºå¤§å¿ƒè„ã€‚ <del>ä¸¤é¢—å¿ƒå¥½å‹‡æ•¢ â€“ Falling in love</del></li><li>ç”µè„‘é…ç½®:</li></ol><p>ç¡¬ä»¶ éœ€æ±‚<br>CPU å››æ ¸æˆ–æ›´å¤š<br>å†…å­˜ 8G æˆ–æ›´å¤š<br>ç¡¬ç›˜ è‡³å°‘ 80G ç©ºä½™ç©ºé—´<br>ç³»ç»Ÿ WSL æˆ–å®ä½“ Linuxï¼Œå»ºè®® Debian ç³»</p><ol><li>è¶³å¤Ÿçš„ç©ºé—²æ—¶é—´ã€‚</li><li>Vscode å’Œ ğŸ¤Linux çŸ¥è¯†å‚¨å¤‡</li><li>ä¸€å°å®Œå¥½æ— æŸçš„æ–°è®¾å¤‡ã€‚</li><li>è®¾å¤‡åŸå‚çš„ boot&#x2F;recovery&#x2F;vendor_boot é•œåƒã€‚(æ¨è recovery åˆ†åŒºï¼Œå› ä¸ºé‡Œé¢åŒ…å«ä¸€äº›å¯åŠ¨å¿…é¡»çš„.rc(run command)ï¼Œå¦‚æœæ²¡æœ‰è¯¥åˆ†åŒºï¼Œå¯»æ‰¾åŒ…å«å®˜æ–¹ recovery å†…å®¹çš„åˆ†åŒºã€‚å€¼å¾—æ³¨æ„çš„æ˜¯éƒ¨åˆ†è®¾å¤‡ recovery åˆå¹¶åˆ°äº† boot ä¸­ï¼Œæˆ–æ˜¯å­˜åœ¨äº vendor_bootï¼‰</li><li>æŸ¥çœ‹è‡ªå·±çš„è®¾å¤‡å‡ºå‚ Android ç‰ˆæœ¬å¹¶ç¡®å®šç”¨é€”ï¼Œæ˜¯ç”¨äºå®˜æ–¹ ROM è¿˜æ˜¯ç¬¬ä¸‰æ–¹ç±»åŸç”Ÿã€‚å‡ºå‚ç‰ˆæœ¬ä¸º 9 åŠä»¥ä¸Šçš„å¯ä»¥ä½¿ç”¨ twrp-11 åŠä»¥ä¸Šåˆ†æ”¯ï¼Œ9 ä»¥ä¸‹ä½¿ç”¨ twrp-9 åˆ†æ”¯ã€‚</li></ol><p>é…ç½®ç¯å¢ƒ</p><p>å®‰è£…ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt update<br>sudo apt-get install bc bison build-essential ccache curl flex g++-multilib gcc-multilib git gnupg gperf imagemagick lib32ncurses5-dev lib32readline-dev lib32z1-dev liblz4-tool libncurses5 libncurses5-dev libsdl1.2-dev libssl-dev libxml2 libxml2-utils lzop pngcrush rsync schedtool squashfs-tools xsltproc zip zlib1g-dev xattr openjdk-11-jdk jq android-sdk-libsparse-utils python3 python2 repo<br></code></pre></td></tr></table></figure><p>å¿…è¦æ—¶å¯ä»¥é˜…è¯»Git å’Œ Repo</p><p>é…ç½® Git å’Œ Repo</p><p>å®‰è£…å®Œä¾èµ–åï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git config --global user.name &quot;your username&quot;<br>git config --global user.email &quot;your email&quot;<br></code></pre></td></tr></table></figure><p>åŒæ­¥ TWRP æºç </p><p>åœ¨è‡ªå·±æ–¹ä¾¿çš„åœ°æ–¹ï¼Œå»ºç«‹ä¸€ä¸ªç›®å½•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir twrp<br>cd twrp<br></code></pre></td></tr></table></figure><p>æ ¹æ®è‡ªå·±åœ¨å‡†å¤‡å·¥ä½œä¸­ç¡®å®šçš„åˆ†æ”¯åŒæ­¥ç›¸åº”çš„æºç ã€‚</p><p>TWRP-9</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">repo init --depth=1 -u https://github.com/minimal-manifest-twrp/platform_manifest_twrp_omni.git -b twrp-9.0<br>repo sync<br></code></pre></td></tr></table></figure><p>TWRP-11</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">repo init --depth=1 -u https://github.com/minimal-manifest-twrp/platform_manifest_twrp_aosp.git -b twrp-11<br>repo sync<br></code></pre></td></tr></table></figure><p>TWRP-12.1</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">repo init --depth=1 -u https://github.com/minimal-manifest-twrp/platform_manifest_twrp_aosp.git -b twrp-12.1<br>repo sync<br></code></pre></td></tr></table></figure><p>ç¼–å†™è®¾å¤‡æ ‘</p><p>æœ€åŸºæœ¬çš„å¼€æœºéƒ¨åˆ†æˆ‘é€šè¿‡ Redmi K50 åšç¤ºä¾‹ï¼Œå¹¶é€‰å– TWRP-12.1 åˆ†æ”¯ã€‚</p><p>è§£å¯†éƒ¨åˆ†ä¼šå•ç‹¬æˆä¸€ä¸ªç« èŠ‚å¹¶åˆ†ä¸ºé«˜é€šå’Œè”å‘ç§‘ã€‚</p><p>è·å–èµ„æ–™</p><p>å°ç±³è®¾å¤‡ä¸€èˆ¬å¯ä»¥åœ¨Xiaomiromä¸­çš„çº¿åˆ·åŒ…è·å– boot&#x2F;recovery&#x2F;vendor_boot é•œåƒï¼Œå…¶å®ƒè®¾å¤‡è¯·è‡ªè¡Œå¯»æ‰¾ã€‚</p><p>å®‰è£…å·¥å…·å’Œä¾èµ–</p><p>å°†å‡†å¤‡å·¥ä½œä¸­å‡†å¤‡çš„ boot&#x2F;recovery&#x2F;vendor_boot é•œåƒè§£åŒ…ï¼Œå¯ä»¥ç”¨ä»»ä½•å·¥å…·ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨Android_boot_image_editoræŒ‰ç…§è‡ªè¿°æ–‡ä»¶è¿›è¡Œä¾èµ–å®‰è£…æ“ä½œï¼š</p><p>Mac(Intel)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">brew install lz4 xz dtc openjdk@17<br>echo &#x27;export PATH=&quot;/usr/local/opt/openjdk@17/bin:$PATH&quot;&#x27; &gt;&gt; ~/.zshrc<br>source ~/.zshrc<br></code></pre></td></tr></table></figure><p>Linux:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt update<br>sudo apt install git device-tree-compiler lz4 xz-utils zlib1g-dev openjdk-17-jdk gcc g++ python3 python-is-python3 p7zip-full android-sdk-libsparse-utils erofs-utils<br></code></pre></td></tr></table></figure><p>Common:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/cfig/Android_boot_image_editor<br>cd Android_boot_image_editor<br></code></pre></td></tr></table></figure><p>è§£åŒ…</p><p>è¯·æ³¨æ„â€&#x2F;â€œè¡¨ç¤ºæˆ–çš„æ„æ€ï¼Œè¯·ä¸è¦è¯¯ä»¥ä¸ºæ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚</p><p>å¦‚æœä¸ç¡®å®šåˆ†åŒºå¯»æ‰¾çš„æ˜¯å¦æ­£ç¡®ï¼Œè¯·å°è¯•å°†å¯ä»¥çš„åˆ†åŒºè¿›è¡Œè§£åŒ…ï¼Œå¹¶æŸ¥çœ‹å…¶ramdiskå†…æ˜¯å¦åŒ…å«recoveryå­—æ ·çš„æ–‡ä»¶</p><p>å°†ä½ å‡†å¤‡å¥½çš„boot&#x2F;recovery&#x2F;vendor_bootå¤åˆ¶åˆ°è¯¥ç›®å½•ï¼Œä½ å¯ä»¥ä½¿ç”¨ GUI æˆ–è€… CLIã€‚å¦‚:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cp &lt;å‡ºå‚boot/recovery/vendor_bootçš„ç»å¯¹è·¯å¾„&gt; boot/recovery/vendor_boot.img<br>./gradlew unpack<br></code></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œä»¥ Redmi K50 ä¸ºä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">10:12:13.188 [main] INFO  cfig.bootimg.v3.VendorBoot -<br>                        Unpack Summary of vendor_boot.img<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚What                                   â”‚Where                                 â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚image info                             â”‚build/unzip_boot/vendor_boot.json     â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚ramdisk                                â”‚build/unzip_boot/ramdisk.img.lz4      â”‚<br>â”‚-- PLATFORM ramdisk[1/1]               â”‚build/unzip_boot/ramdisk.1.lz4        â”‚<br>â”‚------- extracted rootfs               â”‚build/unzip_boot/root.1               â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚dtb                                    â”‚build/unzip_boot/dtb                  â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚AVB info                               â”‚build/unzip_boot/vendor_boot.avb.json â”‚<br>â”‚\-- signing key                        â”‚NONE                                  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>10:12:13.213 [main] WARN  cfig.packable.PackableLauncher - &#x27;unpack&#x27; sequence completed<br><br>BUILD SUCCESSFUL in 2s<br></code></pre></td></tr></table></figure><p>è§£åŒ…æˆåŠŸåç»ˆç«¯ä¼šæ‰“å°å‡ºä»¥ä¸Šä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«vendor_bootç›®å½•ç»“æ„ï¼Œæˆ‘ä»¬åªéœ€è¦ramdiské‡Œçš„éƒ¨åˆ†å†…å®¹å°±å¥½äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls build/unzip_boot/root.1 # è¯·æ ¹æ®è‡ªå·±çš„åˆ†åŒºå’Œè®¾å¤‡åˆ¤æ–­ramdiskçš„å‘½åï¼Œä¸€èˆ¬éƒ½ç›´æ¥æ˜¯ramdisk<br></code></pre></td></tr></table></figure><p>ä¸å‡ºæ„å¤–çš„è¯ä¼šè¾“å‡ºä»¥ä¸‹å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/dump/bootedit î‚° î‚  master ? î‚° ls build/unzip_boot/root.1<br>acct                         oem<br>apex                         plat_file_contexts<br>bin                          plat_property_contexts<br>bugreports                   postinstall<br>config                       proc<br>d                            product<br>data                         product_file_contexts<br>data_mirror                  product_property_contexts<br>debug_ramdisk                prop.default<br>default.prop                 res<br>dev                          sdcard<br>etc                          second_stage_resources<br>first_stage_ramdisk          sepolicy<br>init                         storage<br>init.recovery.hardware.rc    sys<br>init.recovery.mt6895.rc      system<br>lib                          system_ext<br>linkerconfig                 system_ext_file_contexts<br>miui.factoryreset.fstab      system_ext_property_contexts<br>miui.factoryreset.rc         tmp<br>mnt                          vendor<br>odm                          vendor_dlkm<br>odm_dlkm                     vendor_file_contexts<br>odm_file_contexts            vendor_property_contexts<br>odm_property_contexts<br></code></pre></td></tr></table></figure><p>å¦‚æœåŒ…å« init.recovery*çš„å­—æ ·ï¼Œæ­å–œä½ æˆåŠŸæ‰¾åˆ°äº†æ­£ç¡®çš„åˆ†åŒºã€‚å°†è¿™ä¸ªç›®å½•å¤åˆ¶åˆ°ä¸€ä¸ªè‡ªå·±æ–¹ä¾¿çš„åœ°æ–¹ã€‚ è‡³æ­¤èµ„æ–™å·²ç»å¤§è‡´é½å…¨äº†ï¼Œè§£å¯†çš„èµ„æ–™ä¼šåœ¨è§£å¯†ç« èŠ‚æ¥è®²è§£å¦‚ä½•è·å–ã€‚</p><p>åˆå§‹åŒ–ç›®å½•ç»“æ„</p><p>åœ¨ twrp æºç æ ¹ç›®å½•è¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p device/vendor/codename<br>mkdir -p device/vendor/codename/recovery/root<br>cd device/vendor/codename<br></code></pre></td></tr></table></figure><p>vendoræŒ‡çš„æ˜¯ä¾›åº”å•†ï¼Œå¦‚ xiaomiã€oneplusã€huaweiã€vivoã€realmeã€‚ codenameæŒ‡çš„æ˜¯è®¾å¤‡ä»£å·ï¼Œå°ç±³è®¾å¤‡å¯ä»¥åœ¨XiaomiromæŸ¥è¯¢ï¼Œå…¶å®ƒè®¾å¤‡è‡ªè¡ŒæŸ¥è¯¢äº¦æˆ–æ˜¯åœ¨å¼€å‘è€…é€‰é¡¹å‹¾é€‰ USB è°ƒè¯•é€šè¿‡ adb å°è¯•è·å–ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">adb shell getprop ro.product.manufacturer # ä¾›åº”å•†<br>adb shell getprop ro.product.device # è®¾å¤‡ä»£å·<br></code></pre></td></tr></table></figure><p>æˆ‘çš„ Redmi K50 ä¼šæ‰“å°ä»¥ä¸‹ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/dump/bootedit î‚° î‚  master ? î‚° adb shell getprop ro.product.manufacturer<br>Xiaomi # æ— è®ºæ‰“å°å‡ºæ¥çš„å†…å®¹æ˜¯å¤§å†™è¿˜æ˜¯å°å†™ï¼Œåœ¨ç›®å½•ç»“æ„ä¸­æˆ‘ä»¬éƒ½é‡‡ç”¨å°å†™<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/dump/bootedit î‚° î‚  master ? î‚° adb shell getprop ro.product.device<br>rubens<br></code></pre></td></tr></table></figure><p>æˆ‘çš„ IQOO NEO5 Lite ä¼šæ‰“å°ä»¥ä¸‹ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° adb shell getprop ro.product.manufacturer<br>vivo<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° adb shell getprop ro.product.device<br>PD2118<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬åªè¦ä¸æ˜¯å±±å¯¨æœºï¼Œå°ä½œåŠå‡ºæ¥çš„æœºå­ï¼Œç”¨è¿™ä¸¤æ¡å‘½ä»¤åº”è¯¥æ˜¯å¯ä»¥æ­£ç¡®è·å–çš„ã€‚</p><p>åˆå§‹åŒ–æ„å»ºæ—¶å¿…è¦çš„æ–‡ä»¶</p><p>æ— è®ºæ˜¯ AOSP device tree äº¦æˆ–æ˜¯ TWRP device tree éƒ½åŸºæœ¬ç±»ä¼¼äºä»¥ä¸‹ç»“æ„ã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">/<br>â”œâ”€â”€ prebuilt           (å­˜æ”¾kernelã€dtbç­‰é¢„ç¼–è¯‘æ–‡ä»¶) # AOSP device treeè‹¥ä½¿ç”¨build kernelåˆ™æ²¡æœ‰è¯¥ç›®å½•<br>â”œâ”€â”€ recovery/root      (å­˜æ”¾ä¸€äº›.rcå’Œè§£å¯†blobs) # ä¸€èˆ¬ç”¨äºRecovery device tree<br>â”œâ”€â”€ Android.<span class="hljs-keyword">mk</span>         (Androidæ„å»ºç³»ç»Ÿé¦–å…ˆä¼šæ£€æŸ¥æ¯ä¸ªç›®å½•çš„Android.<span class="hljs-keyword">mk</span>ï¼Œé‡Œé¢åŒ…å«ä¸€äº›åˆ¤æ–­ï¼Œç”±å®ƒåŒ…æ‹¬å…¶æ‰€åœ¨ç›®å½•ä¸­æ‰€æœ‰Makefile)<br>â”œâ”€â”€ AndroidProducts.<span class="hljs-keyword">mk</span> (å£°æ˜äº§å“çš„Makefileå’Œlunchæ—¶å¯ç”¨çš„æ„å»ºç±»å‹)<br>â”œâ”€â”€ BoardConfig.<span class="hljs-keyword">mk</span>     (æ¿è½½é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸»æ¿å¿…è¦çš„Flag)<br>â”œâ”€â”€ device.<span class="hljs-keyword">mk</span>          (å£°æ˜è®¾å¤‡æ‰€éœ€çš„æ–‡ä»¶å’Œæ¨¡å—)<br>â””â”€â”€ <span class="hljs-symbol">&lt;ROM&gt;</span>_codename.<span class="hljs-keyword">mk</span>  (å£°æ˜äº§å“ç‰¹å®šä¿¡æ¯ï¼Œä¾‹å¦‚åç§°ã€å“ç‰Œå’Œå‹å·ï¼Œå¼•ç”¨device.<span class="hljs-keyword">mk</span>ç­‰) # ROMå°±æ¯”å¦‚lineageã€arrowç­‰ï¼Œç¼–è¯‘twrpå°±ç›´æ¥å†™twrpï¼Œtwrp-<span class="hljs-number">9</span>åˆ†æ”¯è¦å†™onmi<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠè¿™æ ·çš„ç»“æ„ç§°ä¸ºéª¨æ¶æ ‘(skeleton tree)ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æŒ‰ç…§ä»¥ä¸Šç»“æ„ä¸ºè‡ªå·±çš„è®¾å¤‡å†™ä¸€ä»½ Recovery device treeã€‚ åœ¨ç»ˆç«¯ä½¿ç”¨touchå‘½ä»¤åˆ›å»ºå¿…è¦çš„æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">touch Android.mk AndroidProducts.mk BoardConfig.mk device.mk twrp_rubens.mk<br>ls .<br></code></pre></td></tr></table></figure><p>ä¸å‡ºæ„å¤–çš„è¯ä¼šæ‰“å°å‡ºä»¥ä¸‹ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° touch Android.mk AndroidProducts.mk BoardConfig.mk device.mk twrp_rubens.mk<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° ls .<br>Android.mk         BoardConfig.mk     prebuilt           twrp_rubens.mk<br>AndroidProducts.mk device.mk          recovery<br></code></pre></td></tr></table></figure><p>å¯ä»¥ä¸‹ä¸€æ­¥äº†~</p><p>åˆå§‹ Android.mk æ–‡ä»¶</p><p>æ‰“å¼€ Vscode å¹¶æ‰“å¼€è®¾å¤‡æ ‘ç›®å½•ï¼Œä½ è¶³å¤Ÿå¼ºä¹Ÿå¯ä»¥ä½¿ç”¨ nanoã€vim ç¼–è¾‘ã€‚ é€‰ä¸­ Android.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile">LOCAL_PATH := <span class="hljs-variable">$(<span class="hljs-built_in">call</span> my-<span class="hljs-built_in">dir</span>)</span><br><br><span class="hljs-keyword">ifeq</span> (<span class="hljs-variable">$(TARGET_DEVICE)</span>,codename)<br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(<span class="hljs-built_in">call</span> all-subdir-makefiles,<span class="hljs-variable">$(LOCAL_PATH)</span>)</span><br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure><p>Â· codenameæ˜¯éœ€è¦ä½ ä¿®æ”¹çš„éƒ¨åˆ†</p><p>æˆ‘ä¿®æ”¹åæ˜¯è¿™æ ·çš„</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile">LOCAL_PATH := <span class="hljs-variable">$(<span class="hljs-built_in">call</span> my-<span class="hljs-built_in">dir</span>)</span><br><br><span class="hljs-keyword">ifeq</span> (<span class="hljs-variable">$(TARGET_DEVICE)</span>,rubens)<br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(<span class="hljs-built_in">call</span> all-subdir-makefiles,<span class="hljs-variable">$(LOCAL_PATH)</span>)</span><br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure><p>åˆå§‹ AndroidProducts.mk æ–‡ä»¶</p><p>é€‰ä¸­ AndroidProducts.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile">PRODUCT_MAKEFILES := \<br>    <span class="hljs-variable">$(LOCAL_DIR)</span>/&lt;ROM&gt;_&lt;codename&gt;.mk<br><br>COMMON_LUNCH_CHOICES := \<br>    &lt;ROM&gt;_&lt;codename&gt;-eng<br></code></pre></td></tr></table></figure><p>æˆ‘ä¿®æ”¹åæ˜¯è¿™æ ·çš„</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile">PRODUCT_MAKEFILES := \<br>    <span class="hljs-variable">$(LOCAL_DIR)</span>/twrp_rubens.mk<br><br>COMMON_LUNCH_CHOICES := \<br>    twrp_rubens-eng<br></code></pre></td></tr></table></figure><p>åˆå§‹ BoardConfig.mk æ–‡ä»¶</p><p>å°†ä¹‹å‰å‡†å¤‡çš„ramdiskæ–‡ä»¶å¤¹ç”¨æ–°çª—å£æ‰“å¼€ 1.æ‰¾åˆ°ç›®å½•ä¸‹çš„ prop.default æˆ–å« prop å­—æ ·çš„æ–‡ä»¶ã€‚ä»¥ä¸‹æ³¨é‡Šç±»ä¼¼ ro..çš„å°±æ˜¯ä» prop ä¸­è·å–çš„ 2.è§£åŒ… boot&#x2F;recovery&#x2F;vendor_boot çš„ json</p><p>ä¾‹å¦‚ build&#x2F;unzip_boot&#x2F;boot.json</p><p>é€‰ä¸­ BoardConfig.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs makefile">DEVICE_PATH := device/vendor/codename<br><br><span class="hljs-comment"># Architecture</span><br>TARGET_ARCH := arm64 <span class="hljs-comment"># ro.bionic.arch</span><br>TARGET_ARCH_VARIANT := armv8-a <span class="hljs-comment"># 64ä½é»˜è®¤å˜ä½“</span><br>TARGET_CPU_ABI := arm64-v8a <span class="hljs-comment"># ro.vendor.product.cpu.abilist64 (è‡³å°‘åœ¨å°ç±³è®¾å¤‡ä¸Šæ²¡æœ‰æ‰¾åˆ°ro.product.cpu.abilist)</span><br>TARGET_CPU_ABI2 := <span class="hljs-comment"># 64ä½ç•™ç©º</span><br>TARGET_CPU_VARIANT := generic <span class="hljs-comment"># é»˜è®¤ä¸€èˆ¬éƒ½æ˜¯é€šç”¨</span><br>TARGET_CPU_VARIANT_RUNTIME := cortex-a55 <span class="hljs-comment"># ro.bionic.cpu_variant</span><br><br>TARGET_2ND_ARCH := arm <span class="hljs-comment"># ro.bionic.2nd_arch</span><br>TARGET_2ND_ARCH_VARIANT := <span class="hljs-variable">$(TARGET_ARCH_VARIANT)</span><br>TARGET_2ND_CPU_ABI := armeabi-v7a <span class="hljs-comment"># ro.vendor.product.cpu.abilist32ç¬¬ä¸€ä¸ª</span><br>TARGET_2ND_CPU_ABI2 := armeabi <span class="hljs-comment"># ro.vendor.product.cpu.abilist32ç¬¬äºŒä¸ª</span><br>TARGET_2ND_CPU_VARIANT := <span class="hljs-variable">$(TARGET_CPU_VARIANT)</span><br>TARGET_2ND_CPU_VARIANT_RUNTIME := <span class="hljs-variable">$(TARGET_CPU_VARIANT)</span><br><br><span class="hljs-comment"># Assertation</span><br>TARGET_OTA_ASSERT_DEVICE := rubens <span class="hljs-comment"># codename</span><br><br><span class="hljs-comment"># Bootloader</span><br>TARGET_BOOTLOADER_BOARD_NAME := rubens <span class="hljs-comment"># ro.product.board</span><br>TARGET_NO_BOOTLOADER := true<br>TARGET_USES_UEFI := true<br><br><span class="hljs-comment"># Build Rule</span><br>ALLOW_MISSING_DEPENDENCIES := true <span class="hljs-comment"># ä¸ºäº†recoveryä¸å¥å…¨çš„ä¾èµ–</span><br><br><span class="hljs-comment"># Kernel - æ³¨é‡Šä¼šè¯´æ˜åœ¨boot/recovery/vendor_boot.jsonä¸­å¯¹åº”çš„å˜é‡</span><br>BOARD_BOOT_HEADER_VERSION := 4 <span class="hljs-comment"># headerVersion</span><br>BOARD_KERNEL_BASE := 0x3fff8000 <span class="hljs-comment"># (kernelLoadAddr - 32KB) qcomè®¾å¤‡baseä¸º0ï¼Œä¸”æ²¡æœ‰åç§»(offset)</span><br>BOARD_KERNEL_CMDLINE := bootopt=64S3,32N2,64N2 <span class="hljs-comment"># cmdline</span><br>BOARD_KERNEL_PAGESIZE := 4096 <span class="hljs-comment"># pageSize</span><br>BOARD_RAMDISK_OFFSET := 0x26f08000 <span class="hljs-comment"># (ramdisk,loadAddr - BOARD_KERNEL_BASE)</span><br>BOARD_KERNEL_TAGS_OFFSET := 0x07c88000 <span class="hljs-comment"># (tagsLoadAddr - BOARD_KERNEL_BASE)</span><br>BOARD_MKBOOTIMG_ARGS += --header_version <span class="hljs-variable">$(BOARD_BOOT_HEADER_VERSION)</span><br>BOARD_MKBOOTIMG_ARGS += --ramdisk_offset <span class="hljs-variable">$(BOARD_RAMDISK_OFFSET)</span><br>BOARD_MKBOOTIMG_ARGS += --tags_offset <span class="hljs-variable">$(BOARD_KERNEL_TAGS_OFFSET)</span><br><br><span class="hljs-comment"># Kernel - prebuilt</span><br>TARGET_PREBUILT_KERNEL := <span class="hljs-variable">$(DEVICE_PATH)</span>/prebuilt/kernel <span class="hljs-comment"># é¢„ç¼–è¯‘å†…æ ¸ç›¸å¯¹äºandroidæºç æ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œvendor_bootæœºå‹ä¸éœ€è¦</span><br>TARGET_PREBUILT_DTB := <span class="hljs-variable">$(DEVICE_PATH)</span>/prebuilt/dtb.img <span class="hljs-comment"># åŒä¸Š</span><br>BOARD_MKBOOTIMG_ARGS += --dtb <span class="hljs-variable">$(TARGET_PREBUILT_DTB)</span><br><br><span class="hljs-comment"># Partitions</span><br>BOARD_FLASH_BLOCK_SIZE := 262144 <span class="hljs-comment"># (BOARD_KERNEL_PAGESIZE * 64)</span><br>BOARD_BOOTIMAGE_PARTITION_SIZE := 67108864 <span class="hljs-comment"># boot/recovery/vendor_booté•œåƒçš„å­—èŠ‚å¤§å°éœ€åŸå‚æˆ–æ‰‹æœºå®Œæ•´æå–å‡ºæ¥çš„ï¼Œä¸å®šä¹‰ä¼šæŠ¥é”™</span><br>BOARD_RECOVERYIMAGE_PARTITION_SIZE := 67108864 <span class="hljs-comment"># åŒä¸Š</span><br>BOARD_VENDOR_BOOTIMAGE_PARTITION_SIZE := 67108864 <span class="hljs-comment"># åŒä¸Š</span><br>BOARD_SYSTEMIMAGE_PARTITION_TYPE := ext4 <span class="hljs-comment"># åˆ†åŒºç±»å‹ï¼ŒæŸ¥çœ‹ramdiskä¸­fstabå®šä¹‰çš„ç±»å‹</span><br>BOARD_USERDATAIMAGE_FILE_SYSTEM_TYPE := ext4<br>BOARD_VENDORIMAGE_FILE_SYSTEM_TYPE := ext4<br>TARGET_COPY_OUT_VENDOR := vendor <span class="hljs-comment"># å®šä¹‰vendorç›®å½•ï¼Œä¾‹å¦‚copyä¸“æœ‰blobsè¦ç”¨</span><br>BOARD_SUPER_PARTITION_SIZE := 9126805504 <span class="hljs-comment"># å¯ä»¥é€šè¿‡blockdev --getsize64 /dev/block/bootdevice/by-name/superè·å–ï¼Œéœ€rootï¼Œå¦‚æœæ— æ³•rootå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå€¼ï¼Œä¸å½±å“twrpå¯åŠ¨ï¼Œå¯ä»¥åç»­ä¿®æ­£</span><br>BOARD_SUPER_PARTITION_GROUPS := xiaomi_dynamic_partitions <span class="hljs-comment"># xiaomiæ ¹æ®ä½ è·å–èµ„æ–™çš„vendoræ›¿æ¢ï¼Œæ˜¯ä¸€ä¸ªåŠ¨æ€åˆ†åŒºç»„</span><br>BOARD_XIAOMI_DYNAMIC_PARTITIONS_PARTITION_LIST := system vendor product system_ext odm vendor_dlkm odm_dlkm <span class="hljs-comment"># æ ¹æ®fstabå†…çš„å®šä¹‰ï¼Œä¸€èˆ¬flagåŒ…å«logicaléƒ½å±äºåŠ¨æ€åˆ†åŒºç»„çš„ä¸€éƒ¨åˆ†</span><br>BOARD_XIAOMI_DYNAMIC_PARTITIONS_SIZE := 9122611200 <span class="hljs-comment"># (BOARD_SUPER_PARTITION_SIZE - 4MB)</span><br><br><span class="hljs-comment"># Platform</span><br>TARGET_BOARD_PLATFORM := mt6895 <span class="hljs-comment"># ro.board.platform</span><br><br><span class="hljs-comment"># Recovery - åŸºæœ¬é€šç”¨çš„ä¸å½±å“å¯åŠ¨</span><br>BOARD_HAS_LARGE_FILESYSTEM := true<br>TARGET_RECOVERY_PIXEL_FORMAT := RGBX_8888<br>TARGET_USERIMAGES_USE_EXT4 := true<br>TARGET_USERIMAGES_USE_F2FS := true<br><br><span class="hljs-comment"># Treble</span><br>BOARD_VNDK_VERSION := current <span class="hljs-comment"># å£°æ˜VNDKç‰ˆæœ¬</span><br><br><span class="hljs-comment"># Vendor_boot recovery ramdisk</span><br>BOARD_MOVE_RECOVERY_RESOURCES_TO_VENDOR_BOOT := true <span class="hljs-comment"># å°†recoveryæ–‡ä»¶å¤åˆ¶åˆ°vendor_boot</span><br><br><span class="hljs-comment"># Boot recovery ramdisk</span><br><span class="hljs-comment">#BOARD_USES_RECOVERY_AS_BOOT := true recovery ramdiskåˆå¹¶åœ¨bootä¸­å¯ç”¨</span><br><br><span class="hljs-comment"># Verified Boot</span><br>BOARD_AVB_ENABLE := true<br>BOARD_AVB_MAKE_VBMETA_IMAGE_ARGS += --flags 3<br><br><span class="hljs-comment"># TWRP Configurations</span><br>TW_DEFAULT_LANGUAGE := zh_CN <span class="hljs-comment"># é»˜è®¤ä¸ºä¸­æ–‡</span><br>TW_EXTRA_LANGUAGES := true <span class="hljs-comment"># é¢å¤–çš„è¯­è¨€</span><br>TW_THEME := portrait_hdpi <span class="hljs-comment"># ä¸»é¢˜</span><br>TW_INCLUDE_FASTBOOTD := true <span class="hljs-comment"># åŒ…æ‹¬fastbootdï¼Œä¸ºåŠ¨æ€åˆ†åŒº</span><br><br><span class="hljs-comment"># å…¶å®ƒflagè¿˜æœ‰å¾ˆå¤šï¼Œå¯ä»¥åœ¨https://xdaforums.com/t/twrp-flags-for-boardconfig-mk.3333970 æŸ¥æ‰¾ï¼Œ</span><br><span class="hljs-comment"># è¿™ç¯‡æ–‡ç« ä¹Ÿå¾ˆè€äº†ï¼Œä½†æˆ‘å¹¶ä¸æ¨ètwrpï¼Œæ‰€ä»¥flagæˆ‘ä¹Ÿä¸æ˜¯å¾ˆäº†è§£ï¼Œå¤šç¿»ç¿»github:)</span><br><br><span class="hljs-comment"># Debug</span><br>TARGET_USES_LOGD := true <span class="hljs-comment"># è°ƒè¯•flag</span><br>TWRP_INCLUDE_LOGCAT := true<br></code></pre></td></tr></table></figure><p>æ— æ³¨é‡Šç‰ˆ</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs makefile">DEVICE_PATH := device/vendor/codename<br><br><span class="hljs-comment"># Architecture</span><br>TARGET_ARCH := arm64<br>TARGET_ARCH_VARIANT := armv8-a<br>TARGET_CPU_ABI := arm64-v8a<br>TARGET_CPU_ABI2 :=<br>TARGET_CPU_VARIANT := generic<br>TARGET_CPU_VARIANT_RUNTIME := cortex-a55<br><br>TARGET_2ND_ARCH := arm<br>TARGET_2ND_ARCH_VARIANT := <span class="hljs-variable">$(TARGET_ARCH_VARIANT)</span><br>TARGET_2ND_CPU_ABI := armeabi-v7a<br>TARGET_2ND_CPU_ABI2 := armeabi<br>TARGET_2ND_CPU_VARIANT := <span class="hljs-variable">$(TARGET_CPU_VARIANT)</span><br>TARGET_2ND_CPU_VARIANT_RUNTIME := <span class="hljs-variable">$(TARGET_CPU_VARIANT)</span><br><br><span class="hljs-comment"># Assertation</span><br>TARGET_OTA_ASSERT_DEVICE := rubens<br><br><span class="hljs-comment"># Bootloader</span><br>TARGET_BOOTLOADER_BOARD_NAME := rubens<br>TARGET_NO_BOOTLOADER := true<br>TARGET_USES_UEFI := true<br><br><span class="hljs-comment"># Build Rule</span><br>ALLOW_MISSING_DEPENDENCIES := true<br><br><span class="hljs-comment"># Kernel</span><br>BOARD_BOOT_HEADER_VERSION := 4<br>BOARD_KERNEL_BASE := 0x3fff8000<br>BOARD_KERNEL_CMDLINE := bootopt=64S3,32N2,64N2<br>BOARD_KERNEL_PAGESIZE := 4096<br>BOARD_RAMDISK_OFFSET := 0x26f08000<br>BOARD_KERNEL_TAGS_OFFSET := 0x07c88000<br>BOARD_MKBOOTIMG_ARGS += --header_version <span class="hljs-variable">$(BOARD_BOOT_HEADER_VERSION)</span><br>BOARD_MKBOOTIMG_ARGS += --ramdisk_offset <span class="hljs-variable">$(BOARD_RAMDISK_OFFSET)</span><br>BOARD_MKBOOTIMG_ARGS += --tags_offset <span class="hljs-variable">$(BOARD_KERNEL_TAGS_OFFSET)</span><br>BOARD_KERNEL_IMAGE_NAME := Image<br><br><span class="hljs-comment"># Kernel - prebuilt</span><br>TARGET_PREBUILT_DTB := <span class="hljs-variable">$(DEVICE_PATH)</span>/prebuilt/dtb.img<br>BOARD_MKBOOTIMG_ARGS += --dtb <span class="hljs-variable">$(TARGET_PREBUILT_DTB)</span><br><br><span class="hljs-comment"># Partitions</span><br>BOARD_FLASH_BLOCK_SIZE := 262144<br>BOARD_BOOTIMAGE_PARTITION_SIZE := 67108864<br>BOARD_RECOVERYIMAGE_PARTITION_SIZE := 67108864<br>BOARD_VENDOR_BOOTIMAGE_PARTITION_SIZE := 67108864<br>BOARD_SYSTEMIMAGE_PARTITION_TYPE := ext4<br>BOARD_USERDATAIMAGE_FILE_SYSTEM_TYPE := ext4<br>BOARD_VENDORIMAGE_FILE_SYSTEM_TYPE := ext4<br>TARGET_COPY_OUT_VENDOR := vendor<br>BOARD_SUPER_PARTITION_SIZE := 9126805504<br>BOARD_SUPER_PARTITION_GROUPS := xiaomi_dynamic_partitions<br>BOARD_XIAOMI_DYNAMIC_PARTITIONS_PARTITION_LIST := system vendor product system_ext odm vendor_dlkm odm_dlkm<br>BOARD_XIAOMI_DYNAMIC_PARTITIONS_SIZE := 9122611200<br><br><span class="hljs-comment"># Platform</span><br>TARGET_BOARD_PLATFORM := mt6895<br><br><span class="hljs-comment"># Recovery</span><br>BOARD_HAS_LARGE_FILESYSTEM := true<br>TARGET_RECOVERY_PIXEL_FORMAT := RGBX_8888<br>TARGET_USERIMAGES_USE_EXT4 := true<br>TARGET_USERIMAGES_USE_F2FS := true<br><br><span class="hljs-comment"># Treble</span><br>BOARD_VNDK_VERSION := current<br><br><span class="hljs-comment"># Vendor_boot recovery ramdisk</span><br>BOARD_MOVE_RECOVERY_RESOURCES_TO_VENDOR_BOOT := true<br><br><span class="hljs-comment"># Boot recovery ramdisk</span><br><span class="hljs-comment">#BOARD_USES_RECOVERY_AS_BOOT := true</span><br><br><span class="hljs-comment"># Verified Boot</span><br>BOARD_AVB_ENABLE := true<br>BOARD_AVB_MAKE_VBMETA_IMAGE_ARGS += --flags 3<br><br><span class="hljs-comment"># TWRP Configurations</span><br>TW_DEFAULT_LANGUAGE := zh_CN<br>TW_EXTRA_LANGUAGES := true<br>TW_THEME := portrait_hdpi<br>TW_INCLUDE_FASTBOOTD := true<br><br><span class="hljs-comment"># Debug</span><br>TARGET_USES_LOGD := true<br>TWRP_INCLUDE_LOGCAT := true<br></code></pre></td></tr></table></figure><p>è¿™å—å†™äº†å¥½ä¹…æˆ‘ä¹Ÿä¸ç¡®å®šå¯¹ä¸å¯¹ï¼Œè¯·å„ä½æŒ‡æ­£ï¼Œå°¤å…¶æ˜¯ Kernel éƒ¨åˆ†ã€‚</p><p>åˆå§‹ device.mk æ–‡ä»¶</p><p>Â· å‡†å¤‡å¥½ prop.default</p><p>é€‰ä¸­ AndroidProducts.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs makefile">DEVICE_PATH := device/xiaomi/rubens<br><br><span class="hljs-comment"># API</span><br>PRODUCT_SHIPPING_API_LEVEL := 31 <span class="hljs-comment"># ro.board.first_api_level</span><br><br><span class="hljs-comment"># A/B</span><br>AB_OTA_UPDATER := true <span class="hljs-comment"># å¯ç”¨A/Bæ— ç¼æ›´æ–°</span><br>AB_OTA_PARTITIONS += \ <span class="hljs-comment"># å®šä¹‰A/Båˆ†åŒºï¼Œå‚è€ƒfstab</span><br>    boot \<br>    dtbo \<br>    system \<br>    product \<br>    vendor \<br>    odm \<br>    odm_dlkm \<br>    vbmeta \<br>    vendor_boot \<br>    vendor_dlkm \<br>    vbmeta_system \<br>    vbmeta_vendor<br><br>PRODUCT_PACKAGES += \<br>    update_engine \<br>    update_engine_sideload \<br>    update_verifier \<br>    checkpoint_gc<br><br>AB_OTA_POSTINSTALL_CONFIG += \<br>    RUN_POSTINSTALL_system=true \<br>    POSTINSTALL_PATH_system=system/bin/mtk_plpath_utils \<br>    FILESYSTEM_TYPE_system=ext4 \<br>    POSTINSTALL_OPTIONAL_system=true<br><br>AB_OTA_POSTINSTALL_CONFIG += \<br>    RUN_POSTINSTALL_vendor=true \<br>    POSTINSTALL_PATH_vendor=bin/checkpoint_gc \<br>    FILESYSTEM_TYPE_vendor=ext4 \<br>    POSTINSTALL_OPTIONAL_vendor=true<br><br><span class="hljs-comment"># Dynamic</span><br>PRODUCT_USE_DYNAMIC_PARTITIONS := true <span class="hljs-comment"># åŠ¨æ€åˆ†åŒº</span><br><br><span class="hljs-comment"># Soong namespaces</span><br>PRODUCT_SOONG_NAMESPACES += <span class="hljs-variable">$(DEVICE_PATH)</span> <span class="hljs-comment"># å‘½åç©ºé—´</span><br></code></pre></td></tr></table></figure><p>Â· A&#x2F;B æ— ç¼æ›´æ–°éƒ¨åˆ†é«˜é€šå’Œè”å‘ç§‘ä¸ä¸€æ ·ï¼Œè”å‘ç§‘è®¾å¤‡å¯ä»¥ç…§æŠ„ï¼Œæ³¨æ„ system&#x2F;bin&#x2F;mtk_plpath_utils å°±å¥½ã€‚é«˜é€šå‚è€ƒvenus twrp treeï¼Œå¹¶ä¸”é«˜é€šçš„bootctrlå’Œgpt-utilså¯ä»¥ä» CLO æ‹¿ã€‚</p><p>æ— æ³¨é‡Šç‰ˆ</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs makefile">PRODUCT_SHIPPING_API_LEVEL := 31<br><br><span class="hljs-comment"># A/B</span><br>AB_OTA_UPDATER := true<br>AB_OTA_PARTITIONS += \<br>    boot \<br>    dtbo \<br>    system \<br>    product \<br>    vendor \<br>    odm \<br>    odm_dlkm \<br>    vbmeta \<br>    vendor_boot \<br>    vendor_dlkm \<br>    vbmeta_system \<br>    vbmeta_vendor<br><br>PRODUCT_PACKAGES += \<br>    update_engine \<br>    update_engine_sideload \<br>    update_verifier \<br>    checkpoint_gc<br><br>AB_OTA_POSTINSTALL_CONFIG += \<br>    RUN_POSTINSTALL_system=true \<br>    POSTINSTALL_PATH_system=system/bin/mtk_plpath_utils \<br>    FILESYSTEM_TYPE_system=ext4 \<br>    POSTINSTALL_OPTIONAL_system=true<br><br>AB_OTA_POSTINSTALL_CONFIG += \<br>    RUN_POSTINSTALL_vendor=true \<br>    POSTINSTALL_PATH_vendor=bin/checkpoint_gc \<br>    FILESYSTEM_TYPE_vendor=ext4 \<br>    POSTINSTALL_OPTIONAL_vendor=true<br><br><span class="hljs-comment"># Dynamic</span><br>PRODUCT_USE_DYNAMIC_PARTITIONS := true<br><br><span class="hljs-comment"># Soong namespaces</span><br>PRODUCT_SOONG_NAMESPACES += <span class="hljs-variable">$(DEVICE_PATH)</span><br></code></pre></td></tr></table></figure><p>åˆå§‹ twrp_rubens.mk æ–‡ä»¶</p><p>é€‰ä¸­ AndroidProducts.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># Inherit from common AOSP config</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/base.mk)</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/core_64_bit_only.mk)</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/virtual_ab_ota/launch_with_vendor_ramdisk.mk)</span> <span class="hljs-comment"># vabåŠ è½½åˆ°vendor booté‡Œä½¿ç”¨</span><br><br><span class="hljs-comment"># Inherit from TWRP product configuration</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, vendor/twrp/config/common.mk)</span> <span class="hljs-comment"># twrp-9åˆ†æ”¯æ”¹ä¸ºonmi</span><br><br><span class="hljs-comment"># Device specific configs</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, device/xiaomi/rubens/device.mk)</span><br><br><span class="hljs-comment"># Device identifier</span><br>PRODUCT_DEVICE := rubens <span class="hljs-comment"># è®¾å¤‡å‹å·</span><br>PRODUCT_NAME := twrp_rubens <span class="hljs-comment"># è®¾å¤‡åç§°</span><br>PRODUCT_BRAND := Redmi <span class="hljs-comment"># è‡ªå®šä¹‰å“ç‰Œï¼Œå¦‚æœæœ‰</span><br>PRODUCT_MODEL := 22041211AC <span class="hljs-comment"># äº§å“æœ€ç»ˆç”¨æˆ·å¯è§åç§°</span><br>PRODUCT_MANUFACTURER := Xiaomi <span class="hljs-comment"># åˆ¶é€ å•†</span><br><br>PRODUCT_PROPERTY_OVERRIDES += ro.twrp.vendor_boot=true <span class="hljs-comment"># å¯¹twrpå¯åŠ¨vendor_bootæ”¯æŒ</span><br></code></pre></td></tr></table></figure><p>æ— æ³¨é‡Šç‰ˆ</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># Inherit from common AOSP config</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/base.mk)</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/core_64_bit_only.mk)</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, <span class="hljs-variable">$(SRC_TARGET_DIR)</span>/product/virtual_ab_ota/launch_with_vendor_ramdisk.mk)</span> <span class="hljs-comment"># vabåŠ è½½åˆ°vendor booté‡Œä½¿ç”¨</span><br><br><span class="hljs-comment"># Inherit from TWRP product configuration</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, vendor/twrp/config/common.mk)</span><br><br><span class="hljs-comment"># Device specific configs</span><br><span class="hljs-variable">$(<span class="hljs-built_in">call</span> inherit-product, device/xiaomi/rubens/device.mk)</span><br><br><span class="hljs-comment"># Device identifier</span><br>PRODUCT_DEVICE := rubens<br>PRODUCT_NAME := twrp_rubens<br>PRODUCT_BRAND := Redmi<br>PRODUCT_MODEL := 22041211AC<br>PRODUCT_MANUFACTURER := Xiaomi<br><br>PRODUCT_PROPERTY_OVERRIDES += ro.twrp.vendor_boot=true<br></code></pre></td></tr></table></figure><p>åˆå§‹ recovery ç›®å½•</p><p>æ‹¿å‡ºæˆ‘ä»¬å¥½ä¹…ä¹‹å‰å‡†å¤‡çš„ ramdisk å­</p><p>é€šè¿‡treeå‘½ä»¤æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ ramdisk çš„æ ‘çŠ¶å›¾ï¼Œå¯ä»¥å¾ˆæ¸…æ™°çš„æŸ¥çœ‹åŒ…å«çš„æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs shell">â”œâ”€â”€ acct<br>â”œâ”€â”€ apex<br>â”œâ”€â”€ bin -&gt; /system/bin<br>â”œâ”€â”€ bugreports -&gt; /data/user_de/0/com.android.shell/files/bugreports<br>â”œâ”€â”€ config<br>â”œâ”€â”€ d -&gt; /sys/kernel/debug<br>â”œâ”€â”€ data<br>â”œâ”€â”€ data_mirror<br>â”œâ”€â”€ debug_ramdisk<br>â”œâ”€â”€ default.prop -&gt; prop.default<br>â”œâ”€â”€ dev<br>â”œâ”€â”€ etc -&gt; /system/etc<br>â”œâ”€â”€ first_stage_ramdisk<br>â”‚Â Â  â”œâ”€â”€ fstab.emmc<br>â”‚Â Â  â”œâ”€â”€ fstab.mt6895<br>â”‚Â Â  â””â”€â”€ system<br>â”‚Â Â      â”œâ”€â”€ bin<br>â”‚Â Â      â”‚Â Â  â”œâ”€â”€ e2fsck<br>â”‚Â Â      â”‚Â Â  â”œâ”€â”€ linker64<br>â”‚Â Â      â”‚Â Â  â”œâ”€â”€ linker_asan64 -&gt; linker64<br>â”‚Â Â      â”‚Â Â  â””â”€â”€ snapuserd<br>â”‚Â Â      â””â”€â”€ lib64<br>â”‚Â Â          â”œâ”€â”€ ld-android.so<br>â”‚Â Â          â”œâ”€â”€ libbase.so<br>â”‚Â Â          â”œâ”€â”€ libc++.so<br>â”‚Â Â          â”œâ”€â”€ libc.so<br>â”‚Â Â          â”œâ”€â”€ libdl.so<br>â”‚Â Â          â”œâ”€â”€ libext2_blkid.so<br>â”‚Â Â          â”œâ”€â”€ libext2_com_err.so<br>â”‚Â Â          â”œâ”€â”€ libext2_e2p.so<br>â”‚Â Â          â”œâ”€â”€ libext2_quota.so<br>â”‚Â Â          â”œâ”€â”€ libext2_uuid.so<br>â”‚Â Â          â”œâ”€â”€ libext2fs.so<br>â”‚Â Â          â”œâ”€â”€ liblog.so<br>â”‚Â Â          â”œâ”€â”€ libm.so<br>â”‚Â Â          â”œâ”€â”€ libsparse.so<br>â”‚Â Â          â””â”€â”€ libz.so<br>â”œâ”€â”€ init -&gt; /system/bin/init<br>â”œâ”€â”€ init.recovery.hardware.rc<br>â”œâ”€â”€ init.recovery.mt6895.rc<br>â””â”€â”€ ç­‰ç­‰ç­‰ç­‰...çœç•¥å¤§æ¦‚1000ä¸ªæ–‡ä»¶å§<br></code></pre></td></tr></table></figure><p>å› ä¸ºé¿å…æ•™ç¨‹æ—¶æ•ˆæ€§ï¼Œæˆ‘ä»¬å°½å¯èƒ½é€‰å– prebuilt çš„åŠæ³•ï¼Œå¦‚ boot å’Œ mtk_plpath_utils éƒ½é‡‡ç”¨é¢„ç¼–è¯‘ã€‚</p><p>é‡Œé¢æœ‰å¾ˆå¤šæ–‡ä»¶æ˜¯æ²¡ç”¨çš„ï¼Œæ•´ç†ä¸€ä¸‹ï¼Œå¯¹æˆ‘ä»¬æœ‰ç”¨çš„åªæœ‰è¿™äº›</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell">.<br>â”œâ”€â”€ first_stage_ramdisk<br>â”‚Â Â  â”œâ”€â”€ fstab.emmc<br>â”‚Â Â  â””â”€â”€ fstab.mt6895<br>â”œâ”€â”€ init.recovery.mt6895.rc<br>â”œâ”€â”€ lib<br>â”‚Â Â  â””â”€â”€ modules<br>â”‚Â Â      â”œâ”€â”€ 8250_mtk.ko<br>â”‚Â Â      â”œâ”€â”€ adapter_class.ko<br>â”‚Â Â      â”œâ”€â”€ adsp.ko<br>â”‚Â Â      â”œâ”€â”€ aee_aed.ko<br>â”‚Â Â      â”œâ”€â”€ aee_hangdet.ko<br>â”‚Â Â      â”œâ”€â”€ aee_rs.ko<br>â”‚Â Â      â”œâ”€â”€ blocktag.ko<br>â”‚Â Â      â”œâ”€â”€ bootprof.ko<br>â”‚Â Â      â”œâ”€â”€ bq28z610.ko<br>â”‚Â Â      â”œâ”€â”€ cache-parity.ko<br>â”‚Â Â      â”œâ”€â”€ cfg80211.ko<br>â”‚Â Â      â”œâ”€â”€ charger_class.ko<br>â”‚Â Â      â””â”€â”€ çœç•¥ä¸€ç™¾å¤šä¸ªæ¨¡å—ï¼Œè¿™ä¸ªç›®å½•é‡Œçš„ä¸œè¥¿å…¨è¦<br>â””â”€â”€ system<br>    â”œâ”€â”€ bin<br>    â”‚Â Â  â””â”€â”€ mtk_plpath_utils<br>    â”œâ”€â”€ etc<br>    â”‚Â Â  â”œâ”€â”€ init<br>    â”‚Â Â  â”‚Â Â  â”‚â”€â”€ mtk-plpath-utils.rc<br>    â”‚   â”‚   â””â”€â”€hw<br>    â”‚   â”‚      â””â”€â”€init.rc<br>    â”‚Â Â  â”œâ”€â”€ recovery.fstab<br>    â”‚Â Â  â”œâ”€â”€ security<br>    â”‚Â Â  â”‚Â Â  â””â”€â”€ otacerts.zip<br>    â”‚Â Â  â””â”€â”€ ueventd.rc<br>    â””â”€â”€ lib64<br>        â””â”€â”€ hw<br>            â””â”€â”€ android.hardware.boot@1.0-impl-1.2-mtkimpl.so<br></code></pre></td></tr></table></figure><p>å°†å®ƒä»¬æŒ‰ç…§ä»¥ä¸‹æ“ä½œå¤åˆ¶</p><p>Â· first_stage_ramdisk â€“&gt; recovery&#x2F;root&#x2F;first_stage_ramdisk<br>Â· init.recovery.mt6895.rc â€“&gt; recovery&#x2F;root&#x2F;init.recovery.mt6895.rc<br>Â· lib â€“&gt; recovery&#x2F;root&#x2F;lib<br>Â· system â€“&gt; recovery&#x2F;root&#x2F;system (security å’Œ hw æ–‡ä»¶å¤¹é‡Œçš„å†…å®¹ä½œä¸ºå¤‡ç”¨ï¼Œä¸è¦å¤åˆ¶è¿›å») å¾—åˆ°ä»¥ä¸‹ç›®å½•ç»“æ„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell">.<br>â”œâ”€â”€ Android.mk<br>â”œâ”€â”€ AndroidProducts.mk<br>â”œâ”€â”€ BoardConfig.mk<br>â”œâ”€â”€ device.mk<br>â”œâ”€â”€ prebuilt<br>â”œâ”€â”€ recovery<br>â”‚Â Â  â””â”€â”€ root<br>â”‚Â Â      â”œâ”€â”€ first_stage_ramdisk<br>â”‚Â Â      â”‚Â Â  â”œâ”€â”€ fstab.emmc<br>â”‚Â Â      â”‚Â Â  â””â”€â”€ fstab.mt6895<br>â”‚Â Â      â”œâ”€â”€ init.recovery.mt6895.rc<br>â”‚Â Â      â”œâ”€â”€ lib<br>â”‚Â Â      â”‚Â Â  â””â”€â”€ modules<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ 8250_mtk.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ adapter_class.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ adsp.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ aee_aed.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ aee_hangdet.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ aee_rs.ko<br>â”‚Â Â      â”‚Â Â      â”œâ”€â”€ blocktag.ko<br>â”‚Â Â      â”‚Â Â      â””â”€â”€ çœç•¥....<br>â”‚Â Â      â””â”€â”€ system<br>â”‚Â Â          â”œâ”€â”€ bin<br>â”‚Â Â          â”‚Â Â  â””â”€â”€ mtk_plpath_utils<br>â”‚Â Â          â”œâ”€â”€ etc<br>â”‚Â Â          â”‚Â Â  â”œâ”€â”€ recovery.fstab<br>â”‚Â Â          â”‚Â Â  â””â”€â”€ ueventd.rc<br>â”‚Â Â          â””â”€â”€ lib64<br>â”‚Â Â              â””â”€â”€ hw<br>â”‚Â Â                  â””â”€â”€ android.hardware.boot@1.0-impl-1.2-mtkimpl.so<br>â””â”€â”€ twrp_rubens.mk<br></code></pre></td></tr></table></figure><p>æ‰“å¼€ init.recovery.mt6895.rc æ·»åŠ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">on boot<br>    start health-hal-2-1<br><br>on post-fs<br>    start boot-hal-1-2<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">on post-fs<br>    start boot-hal-1-2<br><br>on init<br>    setprop sys.usb.configfs 1<br>    setprop sys.usb.controller &quot;11201000.usb0&quot;<br>    setprop sys.usb.ffs.aio_compat 1<br><br>on fs &amp;&amp; property:ro.debuggable=0<br>    # distinguish USB shoulde connect or not, i.e. CDP vs SDP<br>    # set charging free due to it wait for USB activation<br><br>on boot<br>    start health-hal-2-1<br>    exec u:r:update_engine:s0 root root -- /system/bin/mtk_plpath_utils<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¯ä»¥å¼€å§‹ç¼–è¯‘å’¯~~</p><p>ç¼–è¯‘</p><p>ç¼–è¯‘å‰è¯·æ£€æŸ¥æ³¨é‡Šæ˜¯å¦å…¨éƒ¨åˆ é™¤</p><p>twrp æºç æ ¹ç›®å½•æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">. build/envsetup.sh<br>lunch twrp_codename-eng # twrp-9ä¸ºonmi<br>mka vendorbootimage/bootimage/recoveryimage<br></code></pre></td></tr></table></figure><p>ä¸å‡ºæ„å¤–çš„è¯ä¸€è·¯ç»¿ç¯ï¼Œå¦‚æœæœ‰æŠ¥é”™çš„è¯è¯·å‘é‚®ç®±è‡³ <a href="mailto:&#49;&#x35;&#x39;&#50;&#53;&#48;&#49;&#x36;&#x30;&#53;&#64;&#x71;&#x71;&#x2e;&#99;&#111;&#109;">&#49;&#x35;&#x39;&#50;&#53;&#48;&#49;&#x36;&#x30;&#53;&#64;&#x71;&#x71;&#x2e;&#99;&#111;&#109;</a> å’¨è¯¢æˆ‘</p><p>äº§ç‰©åœ¨ out&#x2F;target&#x2F;product&#x2F;codename&#x2F;vendor_boot.img\boot.img\recovery.img æ‰‹æœºé‡å¯åˆ° fastboot æ¨¡å¼ï¼Œä½¿ç”¨ fastboot flash åˆ·å†™ï¼Œä¾‹å¦‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">fastboot flash vendor_boot /Users/xiaolegun/Downloads/vendor_boot.img<br></code></pre></td></tr></table></figure><p>åˆ™è¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">ERROR: could not clear input pipe; result e0005000, ignoring...<br>ERROR: could not clear output pipe; result e0005000, ignoring....<br>Sending &#x27;vendor_boot_a&#x27; (65536 KB)                 OKAY [  1.396s]<br>Writing &#x27;vendor_boot_a&#x27;                            OKAY [  0.167s]<br>Finished. Total time: 1.625s<br></code></pre></td></tr></table></figure><p>å°±å¯ä»¥é‡å¯æŒ‰ç”µæºåŠ éŸ³é‡ä¸Šå°è¯•äº†ï¼Œæˆ‘è‡ªå·±æ˜¯ä¸€æ¬¡ç‚¹äº®ï¼Œä½†æœ‰ bugã€‚</p><p>ä¿® BUG</p><p>ä¿®å¤ USB</p><p>æˆ‘çœ‹åˆ° twrp æ§åˆ¶å°æœ‰å¾ˆå¤šæŠ¥é”™ï¼Œç¬¬ä¸€æ­¥è‚¯å®šæ˜¯å…ˆè·å–æ—¥å¿—ï¼Œä½¿ç”¨logcatå‘½ä»¤è·å–ï¼Œåœ¨æ­¤ä¹‹å‰å…ˆä½¿ç”¨adb devicesæ£€æµ‹ä¸€ä¸‹è®¾å¤‡ usb æ˜¯å¦å·¥ä½œæ­£å¸¸ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~ î‚° adb devices         î‚² âœ” î‚² 10208 î‚² 10:05:31<br>* daemon not running; starting now at tcp:5037<br>* daemon started successfully<br>List of devices attached<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°adbæ²¡æœ‰æ£€æµ‹åˆ°è®¾å¤‡ï¼ŒåŸå› ä¸€èˆ¬æ˜¯ usb çš„é…ç½®ä¸å¯¹ï¼Œä½† usb æ˜¯å¥½çš„ã€‚è¿™æ—¶å¯ä»¥å°è¯•å…³é—­ mtpï¼Œå†å¼€å¯ï¼Œå¦‚æœç”µè„‘æœ‰ååº”ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»§ç»­ä¸‹ä¸€æ­¥äº†ã€‚ åœ¨è®¾å¤‡æ ‘ä¸­çš„ recovery&#x2F;rootï¼Œåˆ›å»º init.recovery.usb.rc çš„æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">touch recovery/root/init.recovery.usb.rc<br></code></pre></td></tr></table></figure><p>å¹¶å¯¼å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">on property:sys.usb.config=mtp,adb<br>    start adbd<br><br>on property:sys.usb.ffs.ready=1 &amp;&amp; property:sys.usb.config=mtp,adb<br>    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration &quot;mtp_adb&quot;<br>    rm /config/usb_gadget/g1/configs/b.1/f1<br>    rm /config/usb_gadget/g1/configs/b.1/f2<br>    rm /config/usb_gadget/g1/configs/b.1/f3<br>    rm /config/usb_gadget/g1/configs/b.1/f4<br>    rm /config/usb_gadget/g1/configs/b.1/f5<br>    write /config/usb_gadget/g1/idVendor 0x18d1<br>    write /config/usb_gadget/g1/idProduct 0x2d08<br>    symlink /config/usb_gadget/g1/functions/mtp.gs0 /config/usb_gadget/g1/configs/b.1/f1<br>    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2<br>    write /config/usb_gadget/g1/UDC $&#123;sys.usb.controller&#125;<br>    setprop sys.usb.state $&#123;sys.usb.config&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯æˆ‘ä»æˆ‘ç»´æŠ¤çš„ MI 6X çš„ device tree æ‹¿è¿‡æ¥çš„ï¼Œå¯ä»¥åœ¨è”å‘ç§‘è®¾å¤‡ä¸Šæ­£å¸¸å·¥ä½œã€‚è¿™æ®µ shell çš„å¤§è‡´æ„æ€å°±æ˜¯åœ¨ usb é…ç½®èŠ‚ç‚¹å†™å…¥ mtp å’Œ adb åŒæ—¶å·¥ä½œçš„å­—ç¬¦ä¸²ï¼Œè¿™æ · adb å°±èƒ½é¡ºåˆ©å·¥ä½œäº†ã€‚</p><p>æ­¤å¤–æ‰“å¼€åŸå‚ init.rc ä¿®æ­£ä¸€ä¸‹ usb è®¾å¤‡çš„ id</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">MIUI ADD: START</span><br>import /init.recovery.hardware.rc<br>import /miui.factoryreset.rc<br><span class="hljs-meta prompt_"># </span><span class="language-bash">END</span><br>import /init.recovery.$&#123;ro.hardware&#125;.rc<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">######### çœç•¥ä¸€ä¸‡å­—</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">MIUI ADD: START</span><br>on property:sys.usb.config=mtp,adb &amp;&amp; property:sys.usb.configfs=0<br>    write /sys/class/android_usb/android0/enable 0<br>    write /sys/class/android_usb/android0/idVendor 2717<br>    write /sys/class/android_usb/android0/idProduct 904D<br>    write /sys/class/android_usb/android0/functions mtp,adb<br>    write /sys/class/android_usb/android0/enable 1<br>    setprop sys.usb.state  $&#123;sys.usb.config&#125;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">END</span><br></code></pre></td></tr></table></figure><p>å°†&#x2F;sys&#x2F;class&#x2F;android_usb&#x2F;android0&#x2F;idVendorå’Œwrite &#x2F;sys&#x2F;class&#x2F;android_usb&#x2F;android0&#x2F;idProductåé¢çš„ id åˆ†åˆ«æ›¿æ¢åˆ°&#x2F;config&#x2F;usb_gadget&#x2F;g1&#x2F;idVendorå’Œ&#x2F;config&#x2F;usb_gadget&#x2F;g1&#x2F;idProductå¤„ç†å®Œå°±æ˜¯è¿™æ ·çš„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">on property:sys.usb.config=mtp,adb<br>    start adbd<br><br>on property:sys.usb.ffs.ready=1 &amp;&amp; property:sys.usb.config=mtp,adb<br>    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration &quot;mtp_adb&quot;<br>    rm /config/usb_gadget/g1/configs/b.1/f1<br>    rm /config/usb_gadget/g1/configs/b.1/f2<br>    rm /config/usb_gadget/g1/configs/b.1/f3<br>    rm /config/usb_gadget/g1/configs/b.1/f4<br>    rm /config/usb_gadget/g1/configs/b.1/f5<br>    write /config/usb_gadget/g1/idVendor 0x2717<br>    write /config/usb_gadget/g1/idProduct 0x904D<br>    symlink /config/usb_gadget/g1/functions/mtp.gs0 /config/usb_gadget/g1/configs/b.1/f1<br>    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2<br>    write /config/usb_gadget/g1/UDC $&#123;sys.usb.controller&#125;<br>    setprop sys.usb.state $&#123;sys.usb.config&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¼€æœºä¹‹å adb å’Œ mtp å°±èƒ½åŒæ—¶å·¥ä½œäº†ã€‚</p><p>ä¿®å¤ Resetprop</p><p>æ¥ä¸‹æ¥å°±å¯ä»¥ä¿®å¤å…¶å®ƒ bug äº†ï¼Œæˆ‘çœ‹åˆ°æ§åˆ¶å°æœ‰ä¸€å †çº¢è‰²çš„æŠ¥é”™:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">E:Unknown File System:&#x27;/mi_ext&#x27;<br>E:Unable to override &#x27;external_storage.projid.enabled&#x27; due to missing libresetprop<br>æŒ‚è½½&quot;/data&quot;å¤±è´¥(Invalid argument)<br></code></pre></td></tr></table></figure><p>è¿™ä¸‰ä¸ªæŠ¥é”™ä¸­ç¬¬äºŒä¸ªæœ€å¥½ä¿®ï¼Œç¬¬ä¸€ä¸ªæ¬¡ä¹‹ï¼Œç¬¬ä¸‰ä¸ªä¸è§£å¯†æœ‰å…³ï¼Œæ”¾åœ¨å¦ä¸€ä¸ªå¤§ç« èŠ‚è®²ã€‚ ç¬¬äºŒä¸ªæŠ¥é”™åªéœ€è¦åœ¨ BoardConfig.mk ä¸­æ·»åŠ </p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># Tool</span><br>TW_INCLUDE_RESETPROP := true<br>TW_INCLUDE_LIBRESETPROP := true<br></code></pre></td></tr></table></figure><p>ä¸ç”¨ç¼–è¯‘æµ‹è¯•ç›´æ¥ç§’æ€</p><p>ä¿®å¤æŒ‚è½½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">E:Unknown File System:&#x27;/mi_ext&#x27;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰“å¼€ recovery&#x2F;root&#x2F;system&#x2F;etc ä¸­çš„ recovery.fstabï¼Œå‘ç°é‡Œé¢æœ‰å¾ˆå¤šç©ºæ ¼ï¼Œæˆ‘ä»¬å…ˆå°†å®ƒæ ¼å¼åŒ–ä¸€ä¸‹ï¼Œæœ‰å®åŠ›çš„å¯ä»¥æŠŠåé¢çš„ flag ä¹Ÿå¯¹é½æ•´ç†å¥½ã€‚ æˆ‘æ¯”è¾ƒæ²¡å®åŠ›ï¼Œç®€å•æ ¼å¼åŒ–äº†ä¸€ä¸‹ï¼Œæ˜¯è¿™æ ·çš„</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 1</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="hljs-comment"># 341 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="hljs-comment"># 1 &quot;&lt;command line&gt;&quot; 1</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 2</span><br><span class="hljs-comment"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot; 2</span><br><span class="hljs-comment"># 173 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br>system <span class="hljs-regexp">/system erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>system <span class="hljs-regexp">/system ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>vendor /vendor erofs ro wait,slotselect,avb,logical,first_stage_mount<br>vendor /vendor ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>product /product erofs ro wait,slotselect,avb,logical,first_stage_mount<br>product /product ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>mi_ext <span class="hljs-regexp">/mnt/</span>vendor/mi_ext erofs ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail<br>mi_ext <span class="hljs-regexp">/mnt/</span>vendor/mi_ext ext4 ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail<br><span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext /mi</span>_ext none ro,bind wait,nofail<br>overlay <span class="hljs-regexp">/product/</span>overlay overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/overlay/</span>:<span class="hljs-regexp">/product/</span>overlay check,nofail<br>overlay <span class="hljs-regexp">/product/</span>app overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/app/</span>:<span class="hljs-regexp">/product/</span>app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>priv-app overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/priv-app/</span>:<span class="hljs-regexp">/product/</span>priv-app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>lib overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/lib/</span>:<span class="hljs-regexp">/product/</span>lib check,nofail<br>overlay <span class="hljs-regexp">/product/</span>lib64 overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/lib64/</span>:<span class="hljs-regexp">/product/</span>lib64 check,nofail<br>overlay <span class="hljs-regexp">/product/</span>bin overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/bin/</span>:<span class="hljs-regexp">/product/</span>bin check,nofail<br>overlay <span class="hljs-regexp">/product/</span>framework overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/framework/</span>:<span class="hljs-regexp">/product/</span>framework check,nofail<br>overlay <span class="hljs-regexp">/product/m</span>edia overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/media/</span>:<span class="hljs-regexp">/product/m</span>edia check,nofail<br>overlay <span class="hljs-regexp">/product/</span>opcust overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/opcust/</span>:<span class="hljs-regexp">/product/</span>opcust check,nofail<br>overlay <span class="hljs-regexp">/product/</span>data-app overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/data-app/</span>:<span class="hljs-regexp">/product/</span>data-app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/sysconfig overlay ro,lowerdir=/m</span>nt<span class="hljs-regexp">/vendor/mi</span>_ext<span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/sysconfig/</span>:<span class="hljs-regexp">/product/</span>etc/sysconfig check,nofail<br>overlay <span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/permissions overlay ro,lowerdir=/m</span>nt<span class="hljs-regexp">/vendor/mi</span>_ext<span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/product/</span>etc/permissions check,nofail<br>overlay <span class="hljs-regexp">/system/</span>app overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>system<span class="hljs-regexp">/app/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>app<span class="hljs-regexp">/:/</span>system/app check,nofail<br>overlay <span class="hljs-regexp">/system/</span>priv-app overlay ro,lowerdir=<span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext/</span>system<span class="hljs-regexp">/priv-app/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>priv-app<span class="hljs-regexp">/:/</span>system/priv-app check,nofail<br>overlay <span class="hljs-regexp">/system/</span>framework overlay ro,lowerdir=<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>framework<span class="hljs-regexp">/:/</span>system/framework check,nofail<br>overlay <span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/sysconfig overlay ro,lowerdir=/m</span>nt<span class="hljs-regexp">/vendor/mi</span>_ext<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/sysconfig/</span>:<span class="hljs-regexp">/system/</span>etc/sysconfig check,nofail<br>overlay <span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions overlay ro,lowerdir=/m</span>nt<span class="hljs-regexp">/vendor/mi</span>_ext<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/system/</span>etc/permissions check,nofail<br>system_ext <span class="hljs-regexp">/system_ext erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>system_ext <span class="hljs-regexp">/system_ext ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>odm /odm erofs ro wait,slotselect,avb,logical,first_stage_mount<br>odm /odm ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>vendor_dlkm /vendor_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount<br>odm_dlkm /odm_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>etadata /metadata ext4 noatime,nosuid,nodev,discard wait,check,formattable,first_stage_mount<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/u</span>serdata <span class="hljs-regexp">/data f2fs noatime,nosuid,nodev,discard,noflush_merge,fsync_mode=nobarrier,reserve_root=134217,resgid=1065,checkpoint_merge,gc_merge,inlinecrypt wait,check,formattable,quota,latemount,resize,reservedsize=128m,checkpoint=fs,fileencryption=aes-256-xts:aes-256-cts:v2+inlinecrypt_optimized,keydirectory=/m</span>etadata<span class="hljs-regexp">/vold/m</span>etadata_encryption,fsverity<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>rescue /cache ext4 noatime,nosuid,nodev,noauto_da_alloc,discard wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>protect1 <span class="hljs-regexp">/mnt/</span>vendor/protect_f ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>protect2 <span class="hljs-regexp">/mnt/</span>vendor/protect_s ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvdata <span class="hljs-regexp">/mnt/</span>vendor/nvdata ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvcfg <span class="hljs-regexp">/mnt/</span>vendor/nvcfg ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>persist <span class="hljs-regexp">/mnt/</span>vendor/persist ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/devices/</span>platform<span class="hljs-regexp">/soc/</span><span class="hljs-number">11240000</span>.mmc* auto auto defaults voldmanaged=sdcard1:auto,encryptable=userdata<br><span class="hljs-regexp">/devices/</span>platform/usb_xhci* auto vfat defaults voldmanaged=usbotg:auto<br><span class="hljs-regexp">/devices/</span>platform<span class="hljs-regexp">/soc/</span><span class="hljs-number">11201000</span>.usb0/<span class="hljs-number">11200000</span>.xhci* auto vfat defaults voldmanaged=usbotg:auto<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>frp /persistent emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvram /nvram emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>proinfo /proinfo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>lk /bootloader emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>lk2 /bootloader2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>para /para emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/mi</span>sc /misc emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>boot /boot emmc defaults first_stage_mount,nofail,slotselect<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta_vendor /vbmeta_vendor emmc defaults first_stage_mount,nofail,slotselect<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta_system /vbmeta_system emmc defaults first_stage_mount,nofail,slotselect,avb=vbmeta<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>logo /logo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>expdb /expdb emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>seccfg /seccfg emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>tee1 /tee1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>tee2 /tee2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>scp1 /scp1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>scp2 /scp2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>sspm_1 /sspm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>sspm_2 /sspm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dpm_1 /dpm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dpm_2 /dpm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>cupm_1 /mcupm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>cupm_2 /mcupm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1img /md1img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1dsp /md1dsp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1arm7 /md1arm7 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d3img /md3img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/g</span>z1 /gz1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/g</span>z2 /gz2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>spmfw /spmfw emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>audio_dsp /audio_dsp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>pi_img /pi_img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>boot_para /boot_para emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>odmdtbo /odmdtbo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dtbo /dtbo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>otp /otp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta /vbmeta emmc defaults defaults<br></code></pre></td></tr></table></figure><p>è¿™é‡Œé¢æœ‰å¾ˆå¤šæ— ç”¨åˆ†åŒºï¼Œæˆ‘ä»¬åœ¨ twrp ä¸­æ“ä½œä¸åˆ°ï¼Œä½†æ˜¯æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡é€‚é… MTK è®¾å¤‡ï¼Œæ‰€ä»¥ä¸â€çè¯´â€è¯¯äººå­å¼Ÿäº†ï¼Œå…ˆæŠŠ bug ä¿®å¥½ã€‚ åƒ xiaomi è¿™æ ·å¸¸è§çš„æŒ‚è½½é”™è¯¯ï¼Œæˆ‘è‡ªå·±ä¸€èˆ¬éƒ½æ˜¯å°è¯•æŠŠ&#x2F;mnt&#x2F;vendor ä½¿ç”¨ vscode å…¨éƒ¨åˆ é™¤ï¼Œè®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚å¹¶ä¸”è¦æŠŠè¿™ä¸€è¡Œåˆ é™¤ï¼Œè¿™è¡Œåœ¨æˆ‘çœ‹æ¥æ˜¯é‡å¤å®šä¹‰ï¼ˆï¼Ÿè€Œä¸”ä¹Ÿæ²¡æŒ‡å®šåˆ†åŒºæ ¼å¼ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/mnt/</span>vendor<span class="hljs-regexp">/mi_ext /mi</span>_ext none ro,bind wait,nofail<br></code></pre></td></tr></table></figure><p>æ•´ç†å®Œä¹‹åæ˜¯è¿™æ ·çš„</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 1</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="hljs-comment"># 341 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="hljs-comment"># 1 &quot;&lt;command line&gt;&quot; 1</span><br><span class="hljs-comment"># 1 &quot;&lt;built-in&gt;&quot; 2</span><br><span class="hljs-comment"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot; 2</span><br><span class="hljs-comment"># 173 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br>system <span class="hljs-regexp">/system erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>system <span class="hljs-regexp">/system ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>vendor /vendor erofs ro wait,slotselect,avb,logical,first_stage_mount<br>vendor /vendor ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>product /product erofs ro wait,slotselect,avb,logical,first_stage_mount<br>product /product ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>mi_ext /mi_ext erofs ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail<br>mi_ext /mi_ext ext4 ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail<br>overlay <span class="hljs-regexp">/product/</span>overlay overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/overlay/</span>:<span class="hljs-regexp">/product/</span>overlay check,nofail<br>overlay <span class="hljs-regexp">/product/</span>app overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/app/</span>:<span class="hljs-regexp">/product/</span>app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>priv-app overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/priv-app/</span>:<span class="hljs-regexp">/product/</span>priv-app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>lib overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/lib/</span>:<span class="hljs-regexp">/product/</span>lib check,nofail<br>overlay <span class="hljs-regexp">/product/</span>lib64 overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/lib64/</span>:<span class="hljs-regexp">/product/</span>lib64 check,nofail<br>overlay <span class="hljs-regexp">/product/</span>bin overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/bin/</span>:<span class="hljs-regexp">/product/</span>bin check,nofail<br>overlay <span class="hljs-regexp">/product/</span>framework overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/framework/</span>:<span class="hljs-regexp">/product/</span>framework check,nofail<br>overlay <span class="hljs-regexp">/product/m</span>edia overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/media/</span>:<span class="hljs-regexp">/product/m</span>edia check,nofail<br>overlay <span class="hljs-regexp">/product/</span>opcust overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/opcust/</span>:<span class="hljs-regexp">/product/</span>opcust check,nofail<br>overlay <span class="hljs-regexp">/product/</span>data-app overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>product<span class="hljs-regexp">/data-app/</span>:<span class="hljs-regexp">/product/</span>data-app check,nofail<br>overlay <span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/sysconfig overlay ro,lowerdir=/mi</span>_ext<span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/sysconfig/</span>:<span class="hljs-regexp">/product/</span>etc/sysconfig check,nofail<br>overlay <span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/permissions overlay ro,lowerdir=/mi</span>_ext<span class="hljs-regexp">/product/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/product/</span>etc/permissions check,nofail<br>overlay <span class="hljs-regexp">/system/</span>app overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>system<span class="hljs-regexp">/app/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>app<span class="hljs-regexp">/:/</span>system/app check,nofail<br>overlay <span class="hljs-regexp">/system/</span>priv-app overlay ro,lowerdir=<span class="hljs-regexp">/mi_ext/</span>system<span class="hljs-regexp">/priv-app/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>priv-app<span class="hljs-regexp">/:/</span>system/priv-app check,nofail<br>overlay <span class="hljs-regexp">/system/</span>framework overlay ro,lowerdir=<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>framework<span class="hljs-regexp">/:/</span>system/framework check,nofail<br>overlay <span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/sysconfig overlay ro,lowerdir=/mi</span>_ext<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/sysconfig/</span>:<span class="hljs-regexp">/system/</span>etc/sysconfig check,nofail<br>overlay <span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions overlay ro,lowerdir=/mi</span>_ext<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/product/</span>pangu<span class="hljs-regexp">/system/</span>etc<span class="hljs-regexp">/permissions/</span>:<span class="hljs-regexp">/system/</span>etc/permissions check,nofail<br>system_ext <span class="hljs-regexp">/system_ext erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>system_ext <span class="hljs-regexp">/system_ext ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/</span>avb<span class="hljs-regexp">/q-gsi.avbpubkey:/</span>avb<span class="hljs-regexp">/r-gsi.avbpubkey:/</span>avb/s-gsi.avbpubkey<br>odm /odm erofs ro wait,slotselect,avb,logical,first_stage_mount<br>odm /odm ext4 ro wait,slotselect,avb,logical,first_stage_mount<br>vendor_dlkm /vendor_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount<br>odm_dlkm /odm_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>etadata /metadata ext4 noatime,nosuid,nodev,discard wait,check,formattable,first_stage_mount<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/u</span>serdata <span class="hljs-regexp">/data f2fs noatime,nosuid,nodev,discard,noflush_merge,fsync_mode=nobarrier,reserve_root=134217,resgid=1065,checkpoint_merge,gc_merge,inlinecrypt wait,check,formattable,quota,latemount,resize,reservedsize=128m,checkpoint=fs,fileencryption=aes-256-xts:aes-256-cts:v2+inlinecrypt_optimized,keydirectory=/m</span>etadata<span class="hljs-regexp">/vold/m</span>etadata_encryption,fsverity<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>rescue /cache ext4 noatime,nosuid,nodev,noauto_da_alloc,discard wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>protect1 /protect_f ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>protect2 /protect_s ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvdata /nvdata ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvcfg /nvcfg ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>persist /persist ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=<span class="hljs-number">1</span>,nodelalloc wait,check,formattable<br><span class="hljs-regexp">/devices/</span>platform<span class="hljs-regexp">/soc/</span><span class="hljs-number">11240000</span>.mmc* auto auto defaults voldmanaged=sdcard1:auto,encryptable=userdata<br><span class="hljs-regexp">/devices/</span>platform/usb_xhci* auto vfat defaults voldmanaged=usbotg:auto<br><span class="hljs-regexp">/devices/</span>platform<span class="hljs-regexp">/soc/</span><span class="hljs-number">11201000</span>.usb0/<span class="hljs-number">11200000</span>.xhci* auto vfat defaults voldmanaged=usbotg:auto<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>frp /persistent emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>nvram /nvram emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>proinfo /proinfo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>lk /bootloader emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>lk2 /bootloader2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>para /para emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/mi</span>sc /misc emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>boot /boot emmc defaults first_stage_mount,nofail,slotselect<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta_vendor /vbmeta_vendor emmc defaults first_stage_mount,nofail,slotselect<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta_system /vbmeta_system emmc defaults first_stage_mount,nofail,slotselect,avb=vbmeta<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>logo /logo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>expdb /expdb emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>seccfg /seccfg emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>tee1 /tee1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>tee2 /tee2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>scp1 /scp1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>scp2 /scp2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>sspm_1 /sspm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>sspm_2 /sspm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dpm_1 /dpm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dpm_2 /dpm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>cupm_1 /mcupm_1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>cupm_2 /mcupm_2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1img /md1img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1dsp /md1dsp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d1arm7 /md1arm7 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/m</span>d3img /md3img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/g</span>z1 /gz1 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/g</span>z2 /gz2 emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>spmfw /spmfw emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>audio_dsp /audio_dsp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>pi_img /pi_img emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>boot_para /boot_para emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>odmdtbo /odmdtbo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>dtbo /dtbo emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>otp /otp emmc defaults defaults<br><span class="hljs-regexp">/dev/</span>block<span class="hljs-regexp">/by-name/</span>vbmeta /vbmeta emmc defaults defaults<br></code></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬ç¼–è¯‘è¯•ä¸€ä¸‹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œtwrp æ¯æ¬¡æ›´æ”¹æœ€å¥½åˆ é™¤ out é‡æ–°ç¼–è¯‘ï¼Œä¸è¦ä½¿ç”¨å¦‚make installcleanç­‰å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¼€æœºé»‘å±æˆ–æ›´æ”¹ä¸ç”Ÿæ•ˆã€‚ ç»è¿‡ä¸€åˆ†é’Ÿï¼Œç¼–è¯‘å¥½äº†ï¼Œåˆ·å…¥ï¼Œå¼€æœºï¼Œå¯åŠ¨ï¼å¯ä»¥çœ‹è§æŒ‚è½½æˆåŠŸè¢«ä¿®å¥½ã€‚</p><p>ä¿®å¤å±å¹•æ˜¾ç¤º</p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç°åœ¨å±å¹•çš„é¡¶éƒ¨çš„æ—¶é—´è¢«æ‘„åƒå¤´æŒ–å­”æŒ¡ä½äº†ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªåç§» Flag æ¥ä¿®å¤å®ƒã€‚ åœ¨ BoardConfig.mk ä¸­ï¼ŒåŠ å…¥ä»¥ä¸‹ flag</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile">TW_Y_OFFSET := 106 <span class="hljs-comment">#å¯¼èˆªæ å‘ä¸Š</span><br>TW_H_OFFSET := -106 <span class="hljs-comment">#ç•Œé¢æ•´ä½“å‘ä¸‹</span><br></code></pre></td></tr></table></figure><p>ä¿®å¤æŒ¯åŠ¨</p><p>ä»…ä¾›å‚è€ƒï¼Œç ”ç©¶åŠå¤©å‘ç°åªæœ‰è§£å¯†åŠŸèƒ½æ­£å¸¸æ‰èƒ½ä¿®æŒ¯åŠ¨ï¼Œä¸ç„¶ä¼šå†»å±ï¼ï¼ï¼</p><p>ä¸ä¸€å®šæ­£ç¡®ï¼Œä¹Ÿä¸ä¸€å®šæ™®éï¼Œä»…ä¾›æŒ‡è·¯</p><p>è€è®¾å¤‡ä¸€èˆ¬éƒ½æ˜¯æ­£å¸¸çš„ï¼Œä¸éœ€è¦é¢å¤–å¤„ç†ï¼Œæ–°è®¾å¤‡ä½¿ç”¨ aidl hal éœ€è¦æˆ‘ä»¬è‡ªå·±å¤„ç†ä¸€ä¸‹è®© service æ­£å¸¸å·¥ä½œã€‚ æŒ‚è½½ vendorï¼Œä½¿ç”¨ twrp çš„æ–‡ä»¶ç®¡ç†ï¼Œåœ¨ vendor&#x2F;etc&#x2F;vintf&#x2F;manifest æ‰¾åˆ°å«æœ‰ vibrator å­—æ ·çš„æ–‡ä»¶ã€‚æ‰“å¼€ä¹‹åæ£€æŸ¥æ˜¯å¦ç±»ä¼¼è¿™æ ·çš„æ–‡æ®µ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.0&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;device&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hal</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;aidl&quot;</span> <span class="hljs-attr">override</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>android.hardware.vibrator<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">fqname</span>&gt;</span>IVibrator/vibratorfeature<span class="hljs-tag">&lt;/<span class="hljs-name">fqname</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">hal</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é‚£æ­å–œä½ ï¼Œæ‰¾å¯¹äº†ï¼Œæˆ‘çš„æ–‡ä»¶åæ˜¯ vendor.xiaomi.hardware.vibratorfeature.service.xml å°†å®ƒä½¿ç”¨adb pullæ”¾åˆ°ç”µè„‘ä¸Šè‡ªå·±æ–¹ä¾¿çš„ä½ç½®å¤‡ç”¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /vendor/etc/vintf/manifest/vendor.xiaomi.hardware.vibratorfeature.service.xml .<br>/vendor/etc/vintf/manifest/vendor.xiao...ipped. 0.2 MB/s (1718 bytes in 0.009s)<br></code></pre></td></tr></table></figure><p>ä¸çœ‹æ‰©å±•åï¼Œåˆ° vendor&#x2F;bin&#x2F;hw&#x2F;æ‰¾åˆ°åŒåçš„ service åŒæ ·åˆ©ç”¨adb pullæ”¾ç”µè„‘å¤‡ç”¨ã€‚æ¯”å¦‚æˆ‘çš„å« vendor.xiaomi.hardware.vibratorfeature.service ç„¶ååˆ° vendor&#x2F;etc&#x2F;init&#x2F;æ‰¾åˆ°åŒå.rc æ–‡ä»¶ï¼Œæ‹‰åˆ°ç”µè„‘ä¸Šï¼Œåœ¨é‡Œé¢åŠ ä¸€æ¡ã€‚å¹¶åœ¨å®šä¹‰ service çš„æœ€ä¸‹é¢åŠ ä¸Šseclabel u:r:recovery:s0å¯ä»¥è¢« recovery ä½¿ç”¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">on boot<br>    start serviceè¢«å®šä¹‰çš„åå­—<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">on post-fs-data<br>    chown system system /sys/bus/i2c/drivers/aw8697_haptic/2-005a/f0_save<br>    chown system system /sys/bus/i2c/drivers/aw8697_haptic/2-005a/osc_save<br>    chown system system /sys/bus/i2c/drivers/aw8697_haptic/3-005a/osc_save<br>    # çœç•¥ä¸€ä¸‡å­—<br><br>on boot<br>    start vibratorfeature-hal-service<br><br>service vibratorfeature-hal-service /vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service<br>    class hal<br>    user system<br>    group system input<br>    onrestart restart vibratorfeature<br>    seclabel u:r:recovery:s0<br></code></pre></td></tr></table></figure><p>æ­¤å¤–è¿™ç§æ–°è®¾å¤‡åœ¨å†…æ ¸é‡Œè¿˜æœ‰æŒ¯åŠ¨æ¨¡å—éœ€è¦åŠ è½½ï¼Œè¯·åˆ°&#x2F;vendor&#x2F;modules&#x2F;1.1&#x2F;ä¸­å¯»æ‰¾ï¼Œä¾‹å¦‚æˆ‘è¿™å°è®¾å¤‡æ˜¯haptic.koï¼Œç”¨ adb pull æ‹‰å–åˆ°ç”µè„‘ä¸Šï¼Œç„¶å</p><p>Â· haptic.ko â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;modules&#x2F;1.1</p><p>è‡³æ­¤æ‰€æœ‰å¿…è¦çš„èµ„æ–™å°±å‡†å¤‡å¥½äº†ã€‚å¯èƒ½å¼€æœºåä»ç„¶ä¸å·¥ä½œï¼Œéœ€è¦æŠ“å– log è¡¥ç¼ºå¤±çš„ libraryï¼Œå½“ç„¶è¿™æ˜¯åè¯äº†ã€‚</p><p>å¼€å¹²ï¼</p><p>åœ¨ BoardConfig.mk ä¸­åŠ å…¥ä»¥ä¸‹ flag</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile">TW_SUPPORT_INPUT_AIDL_HAPTICS := true<br></code></pre></td></tr></table></figure><p>å°†å¤‡ç”¨æ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æ“ä½œå¤åˆ¶</p><p>Â· vendor.xiaomi.hardware.vibratorfeature.service.xml â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;etc&#x2F;vintf&#x2F;manifest<br>Â· vendor.xiaomi.hardware.vibratorfeature.service â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;bin&#x2F;hw<br>Â· vendor.xiaomi.hardware.vibratorfeature.service.rc â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;etc&#x2F;init</p><p>ä¹‹åç¼–è¯‘ï¼Œåˆ·å…¥ï¼Œå¼€æœºï¼Œå–œæå†»å±â€¦â€¦ é—®é¢˜ä¸å¤§ï¼Œä½¿ç”¨adb logcatæŠ“å–æ—¥å¿—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">adb logcat &gt; log.log<br></code></pre></td></tr></table></figure><p>æ‰“å¼€ logï¼Œæœç´¢F linkerã€linkerã€libraryã€beginning of crashè¿™å‡ ä¸ªå…³é”®è¯ï¼Œæˆ‘æœç´¢ç¬¬ä¸€ä¸ªå°±å‡ºæ¥äº†ã€‚</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">F linker  : CANNOT <span class="hljs-keyword">LINK</span> EXECUTABLE <span class="hljs-string">&quot;/vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service&quot;</span>: library <span class="hljs-string">&quot;android.hardware.vibrator-V1-ndk_platform.so&quot;</span> <span class="hljs-literal">not</span> found: needed <span class="hljs-keyword">by</span> main executable<br></code></pre></td></tr></table></figure><p>è¿™æ®µæŠ¥é”™çš„æ„æ€å°±æ˜¯vendor.xiaomi.hardware.vibratorfeature.serviceæ‰¾ä¸åˆ°android.hardware.vibrator-V1-ndk_platform.soè¿™ä¸ªåº“ï¼Œæ‰€ä»¥æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p><p>æ‰“å¼€ BoardConfig.mk åŠ å…¥ä»¥ä¸‹ flag</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># Library</span><br>TARGET_RECOVERY_DEVICE_MODULES += \<br>    android.hardware.vibrator-V1-ndk_platform.vendor<br><br>TW_RECOVERY_ADDITIONAL_RELINK_LIBRARY_FILES += \<br>    <span class="hljs-variable">$(TARGET_OUT_SHARED_LIBRARIES)</span>/android.hardware.vibrator-V1-ndk_platform.so<br></code></pre></td></tr></table></figure><p>å†æ¬¡ç¼–è¯‘å°è¯• å¼€æœºä¹‹åä¾ç„¶å†»å±ï¼Œç»§ç»­æŠ“ logï¼ŒæŸ¥æ‰¾</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">F linker  : CANNOT <span class="hljs-keyword">LINK</span> EXECUTABLE <span class="hljs-string">&quot;/vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service&quot;</span>: library <span class="hljs-string">&quot;vendor.hardware.vibratorfeature.IVibratorExt-V1-ndk_platform.so&quot;</span> <span class="hljs-literal">not</span> found: needed <span class="hljs-keyword">by</span> main executable<br></code></pre></td></tr></table></figure><p>vendor.hardware.vibratorfeatureå­—æ ·å’Œæˆ‘ä»¬ä¹‹å‰å¯¼å…¥çš„æ–‡ä»¶é•¿å¾—å·®ä¸å¤šï¼Œä¸€èˆ¬éƒ½æ˜¯ä¾›åº”å•†ä¸“æœ‰æ–‡ä»¶ï¼Œæ‰€ä»¥å»è®¾å¤‡æå–ï¼Œè·¯å¾„åœ¨ vendor&#x2F;lib64 é‡Œï¼Œè™½ç„¶è®¾å¤‡å†»å±äº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨adb pullç›´æ¥æ‹‰å–åˆ°ç”µè„‘ã€‚å°±åƒè¿™æ ·ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb shell mount /vendor<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /vendor/lib64/vendor.hardware.vibratorfeature.IVibratorExt-V1-ndk_platform.so .<br>/vendor/lib64/vendor.hardware.vibratorfeature.IVi...led, 0 skipped. 14.7 MB/s (33552 bytes in 0.002s<br></code></pre></td></tr></table></figure><p>å°†è¿™ä¸ªæ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æç¤ºæ“ä½œ</p><p>Â· vendor.hardware.vibratorfeature.IVibratorExt-V1-ndk_platform.so â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;lib64</p><p>ç»§ç»­ç¼–è¯‘æµ‹è¯• è¿˜æ˜¯å†»å±ï¼Œç»§ç»­æŠ“ log</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">F linker  : CANNOT <span class="hljs-keyword">LINK</span> EXECUTABLE <span class="hljs-string">&quot;/vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service&quot;</span>: library <span class="hljs-string">&quot;libtinyalsa.so&quot;</span> <span class="hljs-literal">not</span> found: needed <span class="hljs-keyword">by</span> main executable<br></code></pre></td></tr></table></figure><p>è¿™ä¸ª library twrp çš„æºç ä¸­åº”è¯¥æ²¡æœ‰ï¼Œå»è®¾å¤‡æ‹¿ä¸€ä¸ª prebuilt å§</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb shell mount /system_root<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /system_root/system/lib64/libtinyalsa.so .<br>/system_root/system/lib64/libtinyalsa.so: 1 file ...led, 0 skipped. 13.6 MB/s (45032 bytes in 0.003s<br></code></pre></td></tr></table></figure><p>å°†è¿™ä¸ªæ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æç¤ºæ“ä½œ</p><p>Â· libtinyalsa.so â€“&gt; recovery&#x2F;root&#x2F;system&#x2F;lib64</p><p>ç¼–è¯‘æµ‹è¯• æˆ‘è‰¹äº†ï¼Œè¿˜æ˜¯å†»å±ï¼Œè¿™æ¬¡æœé‚£å‡ ä¸ªå…³é”®è¯éƒ½æœä¸åˆ°äº†ï¼Œæœvibratorçœ‹çœ‹è¿™é¬¼ä¸œè¥¿æŠ¥ä»€ä¹ˆ</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">E vendor<span class="hljs-selector-class">.xiaomi</span><span class="hljs-selector-class">.hardware</span><span class="hljs-selector-class">.vibratorfeature</span><span class="hljs-selector-class">.service</span>: fail to load lib : /vendor/lib64/libaachaptics.so<br></code></pre></td></tr></table></figure><p>è¿™æ¬¡éƒ½ç›´æ¥ç»™è·¯å¾„äº†ï¼Œç›´æ¥æ‹¿ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb shell mount /vendor<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /vendor/lib64/libaachaptics.so .<br>/vendor/lib64/libaachaptics.so: 1 file pulled, 0 skipped. 15.8 MB/s (56232 bytes in 0.003s)<br></code></pre></td></tr></table></figure><p>å°†è¿™ä¸ªæ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æç¤ºæ“ä½œ</p><p>Â· libaachaptics.so â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;lib64</p><p>è‡³æ­¤åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜äº†ï¼Œä½†æ˜¯æœ‰ä¸ª flag è²Œä¼¼è¦æ“ä½œ data å†…çš„ä¸œè¥¿ï¼Œæœªè§£å¯†ä¼šå¯¼è‡´å†»å±ï¼Œæ‰€ä»¥ç­‰ä¿®å®Œè§£å¯†åå†æ¥ä¿®æŒ¯åŠ¨ã€‚</p><p>ä¿®å¤ CPU æ¸©åº¦</p><p>ä½¿ç”¨adb shell + grepå‘½ä»¤åœ¨æ‰‹æœºèŠ‚ç‚¹é‡Œæœç´¢ type å…³é”®è¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">xiaolegun@xiaoleGundeMac-Pro î‚° ~ î‚° adb shell &#x27;grep &quot;cp_master&quot; /sys/class/thermal/*/type&#x27;<br>/sys/class/thermal/thermal_zone54/type:cp_master<br>xiaolegun@xiaoleGundeMac-Pro î‚° ~ î‚° adb shell &#x27;grep &quot;cpu&quot; /sys/class/thermal/*/type&#x27;<br>/sys/class/thermal/thermal_zone1/type:cpu_little1<br>/sys/class/thermal/thermal_zone10/type:cpu_bigbig1<br>/sys/class/thermal/thermal_zone11/type:cpu_big6<br>/sys/class/thermal/thermal_zone12/type:cpu_bigbig2<br>/sys/class/thermal/thermal_zone2/type:cpu_little2<br>/sys/class/thermal/thermal_zone3/type:cpu_little3<br>/sys/class/thermal/thermal_zone4/type:cpu_little4<br>/sys/class/thermal/thermal_zone5/type:cpu_big1<br>/sys/class/thermal/thermal_zone6/type:cpu_big2<br>/sys/class/thermal/thermal_zone7/type:cpu_big3<br>/sys/class/thermal/thermal_zone8/type:cpu_big4<br>/sys/class/thermal/thermal_zone9/type:cpu_big5<br></code></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œé€‰ç”¨cp_masterèŠ‚ç‚¹æ¥è¯»å–æ¸©åº¦ã€‚æˆ‘çš„èŠ‚ç‚¹è·¯å¾„ä¸º&#x2F;sys&#x2F;class&#x2F;thermal&#x2F;thermal_zone54åœ¨åé¢æ·»åŠ  temp æ¥è¯»å–æ¸©åº¦ï¼Œä½ å¯ä»¥ä½¿ç”¨catæ¥æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å¯ä»¥æ­£å¸¸è¯»å–æ¸©åº¦</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">adb shell &#x27;cat /sys/class/thermal/thermal_zone54/temp&#x27;<br></code></pre></td></tr></table></figure><p>å¦‚æœè¿”å›å¦‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">28000<br></code></pre></td></tr></table></figure><p>è¿™ç§ç±»ä¼¼çš„æ•°å€¼ï¼Œé‚£å¤šåŠæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ æˆ‘ä»¬åœ¨ BoardConfig.mk ä¸­åŠ å…¥</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile">TW_CUSTOM_CPU_TEMP_PATH := <span class="hljs-string">&quot;/sys/class/thermal/thermal_zone54/temp&quot;</span><br></code></pre></td></tr></table></figure><p>è‡³æ­¤ cpu æ¸©åº¦å°±ä¿®å¤å¥½äº†ã€‚</p><p>ååº</p><p>è¿™æ˜¯æˆ‘ç© Android ä¸¤å¹´å†…ç¬¬ä¸€æ¬¡å†™å…³äº Android çš„æ–‡ç« ï¼Œå†…å®¹å’Œæªè¾å¯èƒ½ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œå†åŠ ä¸Šå¼€å­¦ç„¦è™‘ï¼Œç§Ÿæˆ¿å› ç§Ÿé‡‘å’Œæˆ¿æºä¸é¡ºåˆ©ï¼Œå†™çš„å¾ˆä¹±ï¼Œè¯·å„ä½æŒ‡æ­£ã€‚ è§£å¯†ç­‰æœ‰ç©ºè¡¥ï¼Œå…ˆè¡¥ä½œä¸šã€‚</p><p>æœ‰å®åŠ›çš„å·¨ä½¬ä»¬ç»™ç‚¹é¥­æ°ï¼ˆ çˆ±å‘ç”µï¼šxiaoleGunæˆ–åšå®¢å¾®ä¿¡æ— æ‰‹ç»­è´¹</p><p>å‚è€ƒèµ„æ–™</p><p>Google - æ·»åŠ æ–°è®¾å¤‡</p><p>Google - A&#x2F;Bï¼ˆæ— ç¼ï¼‰ç³»ç»Ÿæ›´æ–°</p><p>Lynnrin - å¿«é€Ÿä¸Šæ‰‹ Android Custom ROM é€‚é… - Prebuilt Vendor</p><p>Google - ä¾›åº”å•†æ¥å£å¯¹è±¡</p>]]></content>
    
    
    <categories>
      
      <category>åˆ·æœºæ—¥å¸¸</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ·æœº</tag>
      
      <tag>twrp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨avbtool ä¸ºAndroid é•œåƒç­¾åä»¥å¯åŠ¨ä¸»çº¿Linux</title>
    <link href="/avbtool.html"/>
    <url>/avbtool.html</url>
    
    <content type="html"><![CDATA[<h1 id="ä½¿ç”¨avbtool-ä¸ºAndroid-é•œåƒç­¾åä»¥å¯åŠ¨ä¸»çº¿Linux"><a href="#ä½¿ç”¨avbtool-ä¸ºAndroid-é•œåƒç­¾åä»¥å¯åŠ¨ä¸»çº¿Linux" class="headerlink" title="ä½¿ç”¨avbtool ä¸ºAndroid é•œåƒç­¾åä»¥å¯åŠ¨ä¸»çº¿Linux"></a>ä½¿ç”¨avbtool ä¸ºAndroid é•œåƒç­¾åä»¥å¯åŠ¨ä¸»çº¿Linux</h1><p>æœ¬æ–‡ä½¿ç”¨äº†AIè¿›è¡Œæ¶¦è‰²ï¼Œå› ä¸ºè¿™ç¯‡æ–‡ç« å‰åæ‰“ç£¨èŠ±è´¹äº†è¶…å‡ºé¢„æœŸçš„æ—¶é—´ï¼Œæ‰€ä»¥æ ¼å¼ä¸Šå°†ä¸å†è¿›è¡Œè°ƒæ•´ã€‚è¯·è‡ªè¡Œä½¿ç”¨ Markdown æ¸²æŸ“å™¨æŸ¥çœ‹ã€‚</p><p>æœ¬æ–‡è®°å½•äº†æˆ‘ä½¿ç”¨ avbtool ä¸º Android é•œåƒç­¾åã€ä»è€Œåœ¨è®¾å¤‡ä¸Šå¯åŠ¨ä¸»çº¿ Linux çš„è¿‡ç¨‹ã€‚<br>æœ¬äººå¯¹ AVB å’Œ Android äº†è§£æœ‰é™ï¼Œè®¡ç®—æœºç›¸å…³çŸ¥è¯†å¤§å¤šè‡ªå­¦è€Œæ¥ï¼Œ<strong>æœ¬æ–‡ä»…ä¾›å‚è€ƒï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯æˆ–ä¸ä¸¥è°¨ä¹‹å¤„ï¼Œè¯·å‹¿è¾ƒçœŸ</strong>ã€‚<br>æ–‡ä¸­æ‰€æœ‰å‘½ä»¤ä»…åœ¨ Linux ç¯å¢ƒä¸‹æµ‹è¯•ï¼Œå…¶ä»–å¹³å°ä¸ä¿è¯é€‚ç”¨ã€‚</p><hr><h2 id="AVB-ç®€ä»‹"><a href="#AVB-ç®€ä»‹" class="headerlink" title="AVB ç®€ä»‹"></a>AVB ç®€ä»‹</h2><p>AVBï¼ˆAndroid Verified Bootï¼‰ æ˜¯ Android ç”¨äºéªŒè¯å¯åŠ¨åˆ†åŒºåˆæ³•æ€§çš„ä¸€å¥—æ ‡å‡†ï¼Œç”¨æ¥å»ºç«‹ä» bootloader åˆ°ç³»ç»Ÿé•œåƒçš„<strong>ä¿¡ä»»é“¾</strong>ï¼Œå¹¶æä¾›<strong>å›æ»šä¿æŠ¤</strong>ç­‰å®‰å…¨åŠŸèƒ½ã€‚</p><p>å¯ç”¨ AVB éœ€è¦ä¸€å¯¹å¯†é’¥ï¼š</p><ul><li>å…¬é’¥ï¼ˆä¿¡ä»»æ ¹ï¼‰ çš„å“ˆå¸Œå€¼ç”±å‚å•†çƒ§å½•åˆ° SoCï¼›</li><li>ç§é’¥ ç”¨äºå¯¹ç³»ç»Ÿé•œåƒç­¾åã€‚</li></ul><p>åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œ<strong>ABLï¼ˆAndroid Bootloaderï¼‰</strong> ä¼šéªŒè¯ç­¾åä¸å“ˆå¸Œå€¼ã€‚<br>ç³»ç»Ÿä¸­è¿˜å­˜åœ¨ä¸€ä¸ªå…³é”®åˆ†åŒºâ€”â€”<code>vbmeta</code>ï¼Œå…¶ä¸­è®°å½•äº†å¤šä¸ªåˆ†åŒºçš„ç­¾ååŠå“ˆå¸Œä¿¡æ¯ã€‚<code>vbmeta</code> è¿˜å¯ä»¥æŒ‡å‘è‹¥å¹²â€œé“¾å¼éªŒè¯åˆ†åŒºâ€ï¼Œå…¶ç»“æ„ä¸ vbmeta ç›¸ä¼¼ï¼Œåªæ˜¯ä¸ä¼šå†åµŒå¥—æŒ‡å‘å…¶ä»–åˆ†åŒºã€‚ä¸»è¦å­—æ®µåŒ…æ‹¬ï¼š</p><ul><li>å…¬é’¥ï¼ˆå“ˆå¸Œå€¼ï¼‰</li><li>å›æ»šæŒ‡æ•°</li><li>åˆ†åŒºååŠå¯¹åº”å“ˆå¸Œç®—æ³•</li><li>æ•°æ®æ‘˜è¦ï¼ˆå›ºå®šé•¿åº¦å“ˆå¸Œå­—ç¬¦ä¸²ï¼‰ç­‰ã€‚</li></ul><hr><h2 id="æŸ¥çœ‹-vbmeta-ä¿¡æ¯"><a href="#æŸ¥çœ‹-vbmeta-ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ vbmeta ä¿¡æ¯"></a>æŸ¥çœ‹ vbmeta ä¿¡æ¯</h2><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯æŸ¥çœ‹ vbmeta ä¸­çš„ç›¸å…³ä¿¡æ¯ï¼š</p><p>avbtool info_image â€“image vbmeta.img</p><blockquote><p>æ³¨**ï¼š<code>avbtool</code> æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå¯ç›´æ¥ä»ç½‘ç»œè·å–ã€‚<br>Windows ç¯å¢ƒä¸‹å¯èƒ½éœ€è¦æ”¹ä¸º <code>python avbtool</code> å¹¶ç¡®ä¿ä¾èµ–æ¨¡å—å·²å®‰è£…ã€‚</p></blockquote><hr><h2 id="ä¸ºåˆ†åŒºæ·»åŠ -Hash-Footer"><a href="#ä¸ºåˆ†åŒºæ·»åŠ -Hash-Footer" class="headerlink" title="ä¸ºåˆ†åŒºæ·»åŠ  Hash Footer"></a>ä¸ºåˆ†åŒºæ·»åŠ  Hash Footer</h2><p>å¯¹ <strong>éé“¾å¼éªŒè¯åˆ†åŒº</strong>ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ·»åŠ  Hash Footerï¼ˆä½†ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸º ABL åªä¼šæ ¸å¯¹è¿™äº›åˆ†åŒºå¯¹åº”åœ¨ vbmeta ä¸­çš„ä¿¡æ¯ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">avbtool add_hash_footer \<br>--image &lt;path_to_image&gt; \<br>--partition_size &lt;partition_size&gt; \<br>--partition_name &lt;partition_name&gt; \<br>--algorithm &lt;algorithm&gt; \<br>--salt &lt;salt_string&gt; \<br>--key &lt;path_to_private_key&gt;<br></code></pre></td></tr></table></figure><p>åœ¨å­¦ä¹ å’Œä½¿ç”¨ä¸Šè¿°å‘½ä»¤æ—¶, ä¸ºäº†é¿å…å¯¹ openssl å‘½ä»¤çš„ä»‹ç»,<br>ç¤ºä¾‹ä¸­ç§é’¥ç›´æ¥ç”¨ AOSP æä¾›çš„ <strong>æµ‹è¯•å¯†é’¥</strong>ï¼ˆRSA4096ï¼‰ï¼Œå¯¹åº”ç®—æ³•ä¸º <code>SHA256_RSA4096</code>ã€‚<br>è¿™æ˜¯å…¬å¼€çš„æµ‹è¯•ç§é’¥ï¼Œä»…ä¾›å­¦ä¹ ï¼Œè¯·<strong>ç»ä¸èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒ</strong>ã€‚</p><blockquote><p>âš ï¸ <strong>è­¦å‘Š</strong>ï¼šå³ä¾¿å¦‚æ­¤ï¼Œä»æœ‰å‚å•†åœ¨é›¶å”®è®¾å¤‡ä¸­ä½¿ç”¨äº†æµ‹è¯•æˆ–å…¬å¼€å¯†é’¥ã€‚(å¦‚æŸä¸ªç”µè§†å¤§å‚å’Œé€šä¿¡å¤§å‚ï¼Œè¿™é‡Œå°±ä¸ç‚¹åäº†)</p></blockquote><p>å¸¸è§å…¬å¼€æµ‹è¯•å¯†é’¥æ±‡æ€»å¯å‚è€ƒï¼š<br><a href="https://github.com/nccgroup/test_avb_key">test_avb_key</a> </p><p>æå–å…¬é’¥å¹¶æŸ¥çœ‹å…¶å“ˆå¸Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> pem <span class="hljs-keyword">in</span> *.pem; <span class="hljs-keyword">do</span><br>avbtool extract_public_key --key <span class="hljs-string">&quot;<span class="hljs-variable">$pem</span>&quot;</span> --output <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;pem%.*&#125;</span>.bin&quot;</span><br><span class="hljs-built_in">sha1sum</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;pem%.*&#125;</span>.bin&quot;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­åŒ…å«</p><p>60daed9eaef7456fd487433866a56d597f25b326 testkey_rsa4096_oneplus.bin</p><p>ä¸å¹¸çš„æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æ–°çš„ä¸€åŠ è®¾å¤‡ä¸Šå‘ç°, å¯¹åº”çš„å…¬é’¥å“ˆå¸Œæ˜¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">avbtool info_image --image vbmeta.img | grep <span class="hljs-string">&#x27;Public key&#x27;</span><br><br>Public key (sha1): 521801a1ce15f70ee1cb3c1cbf2102da46fe5d5a<br></code></pre></td></tr></table></figure><hr><h2 id="é“¾å¼éªŒè¯åˆ†åŒºï¼ˆä»¥-boot-ä¸ºä¾‹ï¼‰"><a href="#é“¾å¼éªŒè¯åˆ†åŒºï¼ˆä»¥-boot-ä¸ºä¾‹ï¼‰" class="headerlink" title="é“¾å¼éªŒè¯åˆ†åŒºï¼ˆä»¥ boot ä¸ºä¾‹ï¼‰"></a>é“¾å¼éªŒè¯åˆ†åŒºï¼ˆä»¥ boot ä¸ºä¾‹ï¼‰</h2><p>é“¾å¼éªŒè¯åˆ†åŒºï¼ˆå¦‚ <code>boot</code>ï¼‰<strong>å¿…é¡»</strong>åŒ…å« Hash Footerï¼Œå› ä¸º <code>vbmeta</code> ä¸­åªè®°å½•å…¶å…¬é’¥ä¿¡æ¯ï¼Œä¸ä¿å­˜å…·ä½“å“ˆå¸Œã€‚<br>è‹¥ç¼ºå¤±ï¼Œå°†è§¦å‘ <code>avb_slot_verify.c</code> ä¸­çš„é”™è¯¯(load_and_verify_vbmeta())ï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">ERROR: </span>boot_a: Error verifying vbmeta image: invalid vbmeta header<br></code></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œè¿˜å¯èƒ½é‡åˆ°ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Footer osP_version prop <span class="hljs-keyword">not</span> <span class="hljs-built_in">found</span><br>Boot image <span class="hljs-keyword">header</span> OS version == <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>åŸå› æ˜¯ <code>VerifiedBoot.c</code> ä¸­çš„ <code>GetOsVerAndSecPactchLevel()</code> æœªèƒ½æ‰¾åˆ° Android ç‰ˆæœ¬ä¿¡æ¯ã€‚<br>è§£å†³æ–¹æ¡ˆï¼šåœ¨ <code>avbtool</code> å‘½ä»¤ä¸­åŠ å…¥ä»¥ä¸‹å±æ€§ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">--prop com.android.build.boot.os_version:<span class="hljs-string">&#x27;15&#x27;</span><br>--prop com.android.build.boot.security_patch:<span class="hljs-string">&#x27;2025-02-05&#x27;</span><br></code></pre></td></tr></table></figure><p>æˆ–åœ¨æ„å»º boot é•œåƒæ—¶ç›´æ¥è®¾ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkbootimg \<br>--kernel vmlinuz \<br>--ramdisk initramfs \<br>...<br>--os_version 15 \<br>--os_patch_level 2025-02-05 \<br>-o mainline-boot.img<br></code></pre></td></tr></table></figure><hr><h2 id="å›æ»šä¿æŠ¤"><a href="#å›æ»šä¿æŠ¤" class="headerlink" title="å›æ»šä¿æŠ¤"></a>å›æ»šä¿æŠ¤</h2><p>è‹¥æ·»åŠ  Hash Footer æ—¶æœªæŒ‡å®šå›æ»šæŒ‡æ•°ï¼Œé»˜è®¤å€¼ä¸º 0ã€‚<br>è‹¥è¯¥å€¼å°äº **RPMB ä¸­çš„å·²å­˜å›æ»šæŒ‡æ•°ï¼Œå¯åŠ¨æ—¶å°†æŠ¥é”™ï¼š</p><p>ERROR: boot_a: Image rollback index is less than the stored rollback index.</p><p>è§£å†³æ–¹æ³•ï¼šåœ¨ç­¾åæ—¶æŒ‡å®šä¸€ä¸ªä¸å°äºåŸå‚ç³»ç»Ÿå€¼çš„å›æ»šæŒ‡æ•°ï¼Œä¾‹å¦‚ï¼š</p><p>â€“rollback_index <rollback_index_value></p><hr><h2 id="å¯åŠ¨ä¸»çº¿-Linux"><a href="#å¯åŠ¨ä¸»çº¿-Linux" class="headerlink" title="å¯åŠ¨ä¸»çº¿ Linux"></a>å¯åŠ¨ä¸»çº¿ Linux</h2><p>è‡³æ­¤ï¼Œboot åˆ†åŒºå·²æ­£ç¡®ç­¾åï¼Œå¯ä»¥åœ¨è§£é”çŠ¶æ€ä¸‹é¡ºåˆ©å¯åŠ¨ä¸»çº¿ Linuxã€‚<br>ç‰¹åˆ«æ˜¯å‚å•†å®šåˆ¶çš„ ABL ç¦æ­¢å…³é—­ AVB(ä½†å…è®¸éƒ¨åˆ†åˆ†åŒº Hash Mismatch)ï¼Œè¿™ç§æ–¹å¼å°¤å…¶å¿…è¦ã€‚</p><hr><p>å†™åˆ°è¿™é‡Œï¼Œæœ¬æ–‡å·²ç»è¿œè¶…åŸè®¡åˆ’çš„ç¯‡å¹…ã€‚å‰©ä½™ç»†èŠ‚ç•™å¾…è¯»è€…è‡ªè¡Œæ¢ç´¢ã€‚</p><p>å‚è€ƒæ–‡çŒ®ï¼š<a href="https://www.coolapk.com/feed/67340605?s=NjAwMDE2Y2UzNTAxNjZnNjhjZmNhM2J6a1460&shareUid=3473766&shareFrom=com.coolapk.market_14.6.0">ç‚¹å‡»æŸ¥çœ‹</a></p><hr>]]></content>
    
    
    <categories>
      
      <category>åˆ·æœºæ—¥å¸¸</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ·æœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°å½•ä¸€æ¬¡ä¹±å®‰è£…systemuiå¯¼è‡´çš„é»‘å±æ— æ³•æ­£å¸¸ä½¿ç”¨çš„æ•‘ç –è¿‡ç¨‹</title>
    <link href="/save-brick.html"/>
    <url>/save-brick.html</url>
    
    <content type="html"><![CDATA[<p>å¦‚é¢˜æ‰€ç¤ºï¼Œå› ä¸ºå¤ªé—²ï¼Œå°±æƒ³ç€æå–iqooz10 turbo+çš„ç³»ç»Ÿè½¯ä»¶å®‰è£…åˆ°æˆ‘çš„iqooz9turbo+ä¸Šï¼Œç»“æœé‡å¯åç³»ç»Ÿç•Œé¢ç›´æ¥é»‘å±æ²¡åŠæ³•æ­£å¸¸ä½¿ç”¨ï¼Œå°±æœ‰äº†è¿™æ¬¡çš„æ•‘ç –è®°å½•</p><p>å› ä¸ºæ˜¯å®‰è£…åˆ°data&#x2F;appç›®å½•ä¸Šï¼Œæ•…åˆ é™¤æ‰å®‰è£…çš„systemuiå³å¯æ¢å¤æ­£å¸¸</p><p>ç†è®ºå­˜åœ¨ï¼Œå®è·µå¼€å§‹</p><p>å› ä¸ºæ²¡åŠæ³•æ­£å¸¸æ“ä½œæ‰‹æœºï¼Œåªèƒ½ç”¨adbæ¥è¿›è¡Œæ“ä½œ</p><p>é¦–å…ˆä¸Šæ¥å°±é‡åˆ°äº†éš¾é¢˜ï¼šä¹‹å‰æ²¡æœ‰ç»™shell rootæƒé™ï¼Œå¯¼è‡´æ²¡åŠæ³•æ­£å¸¸è¿›è¡Œæ“ä½œ<img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/jz1.png"><br>æ€ä¹ˆåŠï¼Ÿé—®é¢˜ä¸å¤§ï¼æ‹‰magiskæºç ç¼–è¯‘ä¸€ä¸ªæ•‘ç –ç‰ˆå°±å¥½å•¦ï¼Œè¿™é‡Œå·²ç»æœ‰å¤§ä½¬ç¼–è¯‘è¿‡äº†ï¼Œè¿™æ˜¯ä¸‹è½½é“¾æ¥ï¼š<a href="https://dashen666666.lanzouu.com/iTZVk32gli3e">ç‚¹æˆ‘ä¸‹è½½</a><br>ä¿®æ”¹éƒ¨åˆ†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ç¦ç”¨magiskç®¡ç†å™¨ç­¾åæ ¡éªŒ">æ”¾è¡Œæ‰€æœ‰rootè¯·æ±‚ï¼Œä¸å†ç›‘æ§rootæˆæƒ<br>åœç”¨æ‰€æœ‰magiskæ¨¡å—ï¼Œå¼ºåˆ¶å¯åŠ¨åˆ°magiskå®‰å…¨æ¨¡å¼<br>ç¦ç”¨post-fs-data.dã€service.dè„šæœ¬å¼€æœºæ‰§è¡Œ<br>å¼ºåˆ¶å¼€å¯usbè°ƒè¯•ï¼Œå…è®¸ä»»æ„ç”µè„‘è¿æ¥è°ƒè¯•<br>æ­¤ç‰ˆæœ¬magiskä»…ç”¨ä½œæ•‘ç –ç”¨é€”ï¼Œæ•‘ç –å®Œæˆåè¯·åˆ‡æ¢å›å®˜æ–¹magisk<br></code></pre></td></tr></table></figure><p>å®‰è£…æ­¤ç‰ˆæœ¬magiskåå°±å¯ä»¥è·å–rootæƒé™äº†<br><img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/jz.png"></p><p>æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾systemuiçš„å®‰è£…è·¯å¾„</p><p>é¦–å…ˆï¼Œç³»ç»Ÿç•Œé¢çš„åŒ…åæ˜¯<em><strong>com.android.systemui</strong></em><br>éšååœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š<code>pm path com.android.systemui</code> <img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/jz2.png"><br>å¯ä»¥çœ‹åˆ°è·¯å¾„æ˜¯ï¼š<code>/data/app/~~LXEkiAGX0pYanSo_XmZVTQ==/com.android.systemui-5JqV3um7bHzNveUxPQ_yWQ==/base.apk</code><br>æ¥ä¸‹æ¥æŠŠå®ƒåˆ é™¤æ‰ï¼Œè¾“å…¥ï¼š<code>rm /data/app/~~LXEkiAGX0pYanSo_XmZVTQ==/com.android.systemui-5JqV3um7bHzNveUxPQ_yWQ==/base.apk</code> <img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/jz3.png"><br>æœ€åä½¿ç”¨rebooté‡å¯æ‰‹æœºå³å¯æ¢å¤æ­£å¸¸</p>]]></content>
    
    
    <categories>
      
      <category>åˆ·æœºæ—¥å¸¸</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ·æœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°å½•ä¸€ä¸‹æ€ä¹ˆä¿®æ”¹â€timesuâ€é¢å…·ï¼ˆsuuåŒç†ï¼‰</title>
    <link href="/build-magisk-suu.html"/>
    <url>/build-magisk-suu.html</url>
    
    <content type="html"><![CDATA[<p>æ€»å…±ä¿®æ”¹å‡ å¤„</p><h2 id="1-ä¿®æ”¹applets"><a href="#1-ä¿®æ”¹applets" class="headerlink" title="1.ä¿®æ”¹applets"></a>1.ä¿®æ”¹applets</h2><p>è·¯å¾„ï¼šD:\MAGISK\Magisk\native\src\core\applets.cpp</p><p>ä½ç½®ï¼š16~19è¡Œ</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs prolog">onstexpr <span class="hljs-symbol">Applet</span> applets[] = &#123;<br>    &#123; <span class="hljs-string">&quot;su&quot;</span>, su_client_main &#125;,<br>    &#123; <span class="hljs-string">&quot;resetprop&quot;</span>, resetprop_main &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ”¹æˆ</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs prolog">onstexpr <span class="hljs-symbol">Applet</span> applets[] = &#123;<br>    &#123; <span class="hljs-string">&quot;timesu&quot;</span>, su_client_main &#125;,<br>    &#123; <span class="hljs-string">&quot;resetprop&quot;</span>, resetprop_main &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="2-ä¿®æ”¹consts-hpp"><a href="#2-ä¿®æ”¹consts-hpp" class="headerlink" title="2.ä¿®æ”¹consts.hpp"></a>2.ä¿®æ”¹consts.hpp</h2><p>è·¯å¾„ï¼šD:\MAGISK\Magisk\native\src\include\consts.hpp</p><p>ä½ç½®ï¼š29è¡Œ</p><p>æ”¹æˆ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *applet_names[] = &#123; <span class="hljs-string">&quot;timesu&quot;</span>, <span class="hljs-string">&quot;resetprop&quot;</span>, <span class="hljs-literal">nullptr</span> &#125;;<br></code></pre></td></tr></table></figure><h2 id="3-ä¿®æ”¹libsuåº“"><a href="#3-ä¿®æ”¹libsuåº“" class="headerlink" title="3.ä¿®æ”¹libsuåº“"></a>3.ä¿®æ”¹libsuåº“</h2><p>åœ¨magisk23.0ç‰ˆæœ¬åï¼Œä¸å†é‡‡ç”¨æœ¬åœ°libsuåº“ï¼Œé‡‡ç”¨çº¿ä¸Šlibsuåº“ï¼Œéœ€è¦è‡ªå»ºlibsuåº“æ‰èƒ½è®©æ”¹å¥½çš„magiskç®¡ç†å™¨è¯†åˆ«åˆ°timesuï¼Œä½œè€…åœ¨æ­¤å·²å»ºå¥½ï¼Œç›´æ¥ç”¨å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs agsl">val vLibsu = &quot;6.0-timesu&quot;<br>   api(&quot;com.github.morannlx.libhza:core:$&#123;vLibsu&#125;&quot;)<br>   api(&quot;com.github.morannlx.libhza:service:$&#123;vLibsu&#125;&quot;)<br>   api(&quot;com.github.morannlx.libhza:nio:$&#123;vLibsu&#125;&quot;)<br></code></pre></td></tr></table></figure><p>ç”¨æ³•ï¼šD:\MAGISK\Magisk\app\core\build.gradle.kts<br>è‡ªè¡Œå¯¹æ¯”ä¿®æ”¹æˆå¦‚å›¾<br><img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/magisk1.png"></p><p>æ”¹æˆsuuçš„è¯ï¼Œç›´æ¥ç”¨4accccçš„libsuuå°±è¡Œäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs agsl">val vLibsu = &quot;6.0.0&quot;<br>   implementation(&quot;com.github.4accccc.libsu:core:$&#123;vLibsu&#125;&quot;)<br>   implementation(&quot;com.github.4accccc.libsu:service:$&#123;vLibsu&#125;&quot;)<br>   implementation(&quot;com.github.4accccc.libsu:nio:$&#123;vLibsu&#125;&quot;)<br></code></pre></td></tr></table></figure><p>4.ä¿®æ”¹patchè¡¥ä¸(vivoä¿®è¡¥å¿…åŠ )<br>è·¯å¾„ï¼šD:\MAGISK\Magisk\scripts\boot_patch.sh</p><p>æ·»åŠ å¦‚ä¸‹ä»£ç </p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean"># patch vivo do_mount_check<br>    # /<span class="hljs-keyword">system</span> -&gt; /syswxl<br>    # python3 -c <span class="hljs-string">&quot;print(hex(int.from_bytes(b&#x27;/system&#x27;, &#x27;big&#x27;)^int(&#x27;bdbcbbbab9b8b7&#x27;, 16)))&quot;</span><br>    ./magiskboot hexpatch kernel <span class="hljs-number">0092</span>CFC2C9CDDDDA00 <span class="hljs-number">0092</span>CFC2C9CEC0DB00 &amp;&amp; PATCHEDKERNEL=true<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/magisk2.png"></p><p>ä¿®æ”¹å®Œæˆåï¼Œç›´æ¥ç¼–è¯‘å³å¯ï¼Œç¼–è¯‘å‘½ä»¤ï¼ˆwindowsï¼‰ï¼š<code>python build.py -r all</code></p><p>æœ¬æ–‡å‚è€ƒè‡ªï¼š!(wuxianlin&#x2F;build_magisk_vivo)[<a href="https://github.com/wuxianlin/build_magisk_vivo]">https://github.com/wuxianlin/build_magisk_vivo]</a></p>]]></content>
    
    
    <categories>
      
      <category>åˆ·æœºæ—¥å¸¸</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ·æœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è”æƒ³å°æ–°padpro12.7äºŒä»£è§£é”å·¥å…·ç®±</title>
    <link href="/TB375FCTOOL.html"/>
    <url>/TB375FCTOOL.html</url>
    
    <content type="html"><![CDATA[<p>å¶ç„¶å‘ç°è¿™ä¸ªå¹³æ¿åœ¨é”å®šbootloaderçš„æƒ…å†µä¸‹ä»ç„¶å¯ä»¥åˆ·å†™åˆ†åŒºï¼ˆç¦»è°±åˆ°å®¶ï¼‰ï¼Œæ‰€ä»¥èŠ±äº†ç‚¹æ—¶é—´ï¼Œæ¥å†™äº†ä¸€ä¸ªè§£é”åŠ rootçš„å·¥å…·ç®±<br>ç»“æ„å¦‚å›¾<img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/20250327100452270.png"></p><p>å·¥å…·ç®±ä¸»ç•Œé¢<img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/20250327100542271.png"><br>æ ¹æ®å·¥å…·ç®±æç¤ºæ“ä½œå°±å¯ä»¥äº†<br><strong>ä½¿ç”¨å‰éœ€æ³¨æ„ï¼šä»»ä½•åŠŸèƒ½åœ¨ä½¿ç”¨å‰éœ€åœ¨å¼€æœºçš„æƒ…å†µä¸‹ä¿è¯adbè¿æ¥ï¼Œç‰¹åˆ«æ˜¯rootåŠŸèƒ½ï¼Œå¦åˆ™ä¸èƒ½æ­£ç¡®å®‰è£…apkä»¥åŠé‡å¯è‡³fastbootåˆ·å†™init_boot</strong></p><p>æœ¬å·¥å…·ç®±çš„ä¼˜ç‚¹ä¸º<br><strong>é›¶å˜ç –ï¼Œé£é™©ä½</strong><br><strong>å·¥å…·ç®±å®Œå…¨ä¾èµ–adbï¼Œæ— éœ€è¿›è¡Œé¢å¤–æ“ä½œ</strong></p><h2 id="ä¸‹è½½é“¾æ¥ï¼šç‚¹æˆ‘ä¸‹è½½"><a href="#ä¸‹è½½é“¾æ¥ï¼šç‚¹æˆ‘ä¸‹è½½" class="headerlink" title="ä¸‹è½½é“¾æ¥ï¼šç‚¹æˆ‘ä¸‹è½½"></a>ä¸‹è½½é“¾æ¥ï¼š<a href="https://dashen666666.lanzn.com/inSvq2ryk7kb">ç‚¹æˆ‘ä¸‹è½½</a></h2><p><strong>ç›®å‰ä»…é€‚é…091ï¼Œ041ç‰ˆæœ¬ï¼Œå…¶å®ƒç‰ˆæœ¬ä¹Ÿå¯ä½¿ç”¨ä½†æ— æ³•è¿˜åŸlkä»¥åŠä½¿ç”¨è·å–rootåŠŸèƒ½</strong></p>]]></content>
    
    
    <categories>
      
      <category>åˆ·æœºæ—¥å¸¸</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ·æœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è”æƒ³å°æ–°padpro12.7äºŒä»£è§£é”blæ•™ç¨‹</title>
    <link href="/TB375FC.html"/>
    <url>/TB375FC.html</url>
    
    <content type="html"><![CDATA[<h2 id="æ­¤æ•™ç¨‹å·²ç»è¿‡æ—¶ï¼Œä½†ä»ç„¶å¯ç”¨ï¼Œæ¨èä½¿ç”¨å·¥å…·ç®±ä¸€é”®è§£é”ç‚¹æˆ‘å‰å¾€"><a href="#æ­¤æ•™ç¨‹å·²ç»è¿‡æ—¶ï¼Œä½†ä»ç„¶å¯ç”¨ï¼Œæ¨èä½¿ç”¨å·¥å…·ç®±ä¸€é”®è§£é”ç‚¹æˆ‘å‰å¾€" class="headerlink" title="æ­¤æ•™ç¨‹å·²ç»è¿‡æ—¶ï¼Œä½†ä»ç„¶å¯ç”¨ï¼Œæ¨èä½¿ç”¨å·¥å…·ç®±ä¸€é”®è§£é”ç‚¹æˆ‘å‰å¾€"></a>æ­¤æ•™ç¨‹å·²ç»è¿‡æ—¶ï¼Œä½†ä»ç„¶å¯ç”¨ï¼Œæ¨èä½¿ç”¨å·¥å…·ç®±ä¸€é”®è§£é”<a href="https://moranwp.eu.org/TB375FCTOOL.html">ç‚¹æˆ‘å‰å¾€</a></h2><p>æ­¤æ•™ç¨‹æºè‡ªäºæœ¬äººä¸€ä¸ªçŒœæƒ³ï¼Œç»è¿‡å®è·µéªŒè¯ç¡®å®å¯è¡Œï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œæ•™ç¨‹å¼€å§‹</p><h2 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h2><p>å‘å“¥ç‰¹æœ‰çš„lkåˆ†åŒºæ§åˆ¶fastbootï¼Œåˆ·å…¥æ”¯æŒè§£é”blçš„å·¥ç¨‹åŒ…lkåˆ†åŒºå³å¯è§£é”blï¼ˆç±»ä¼¼äºé«˜é€šçš„ablåˆ†åŒºï¼‰</p><p><strong>åˆ·å‰æé†’ï¼šè¯·ä¸¥æ ¼æŒ‰ç…§æœ¬æ•™ç¨‹è¿›è¡Œï¼Œå¦åˆ™æœ‰å¯èƒ½å˜ç –</strong></p><h1 id="å£°æ˜ï¼šæœ¬æ•™ç¨‹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œåœ¨æ“ä½œè¿‡ç¨‹ä¸­å‡ºä»»ä½•çŠ¶å†µå‡ä¸æœ¬äººæ— å…³"><a href="#å£°æ˜ï¼šæœ¬æ•™ç¨‹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œåœ¨æ“ä½œè¿‡ç¨‹ä¸­å‡ºä»»ä½•çŠ¶å†µå‡ä¸æœ¬äººæ— å…³" class="headerlink" title="å£°æ˜ï¼šæœ¬æ•™ç¨‹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œåœ¨æ“ä½œè¿‡ç¨‹ä¸­å‡ºä»»ä½•çŠ¶å†µå‡ä¸æœ¬äººæ— å…³"></a>å£°æ˜ï¼šæœ¬æ•™ç¨‹ä»…ä¾›å­¦ä¹ äº¤æµï¼Œåœ¨æ“ä½œè¿‡ç¨‹ä¸­å‡ºä»»ä½•çŠ¶å†µå‡ä¸æœ¬äººæ— å…³</h1><h1 id="åˆ·æœºå‰å‡†å¤‡ï¼š"><a href="#åˆ·æœºå‰å‡†å¤‡ï¼š" class="headerlink" title="åˆ·æœºå‰å‡†å¤‡ï¼š"></a>åˆ·æœºå‰å‡†å¤‡ï¼š</h1><p>1.å»å¼€å‘è€…æ¨¡å¼å¼€å¯usbè°ƒè¯•å’Œoemè§£é”<br>2.ä¸‹è½½å¥½æˆ‘æä¾›çš„å·¥å…·<br>3.ä¸€ä¸ªè„‘å­å’Œæ‰‹ğŸ‘‹<br>4.æœ€å¥½æ˜¯091ç‰ˆæœ¬ï¼Œå…¶ä»–ç‰ˆæœ¬ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡éœ€è¦è‡ªè¡Œå¤‡ä»½lkåˆ†åŒº<br>ä¸‹è½½é“¾æ¥ï¼š <a href="https://www.123684.com/s/S28VVv-ATPw">https://www.123684.com/s/S28VVv-ATPw</a> </p><h1 id="åˆ·æœºæ­¥éª¤ï¼š"><a href="#åˆ·æœºæ­¥éª¤ï¼š" class="headerlink" title="åˆ·æœºæ­¥éª¤ï¼š"></a>åˆ·æœºæ­¥éª¤ï¼š</h1><p>é¦–å…ˆè§£å‹æˆ‘æä¾›çš„å·¥å…·æ–‡ä»¶ï¼Œè¿è¡Œä¸€é”®å®‰è£…å®‰å“é©±åŠ¨ï¼ˆåé¢åŠ çš„ï¼Œå›¾é‡Œæ²¡æœ‰ï¼‰<br>è¿›å…¥SP_Flashæ–‡ä»¶å¤¹æ‰“å¼€<code>SPFlashToolV6.exe</code></p><p><img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/20250309194350174.jpg"></p><p>æœ€é¡¶ä¸Šæœ‰ä¸¤è¡Œï¼Œç‚¹æ—è¾¹çš„choose<br>ç¬¬ä¸€è¡Œï¼šé€‰å·¥ç¨‹æ–‡ä»¶&#x2F;download_agent&#x2F;flash.xml<br>ç¬¬äºŒè¡Œï¼šé€‰å·¥ç¨‹æ–‡ä»¶&#x2F;download_agent&#x2F;da.auth<br>ç„¶åæŠŠæœ€å·¦è¾¹çš„Auto Rebootç»™æ‰“é’©ä¸Šï¼Œæœ€åç‚¹å‡»<code>download</code></p><p><img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/20250309194837231.jpg"></p><p><strong>ç‰¹åˆ«æ³¨æ„ï¼šä¸€å®šè¦é€‰Download only</strong>ï¼ˆé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼‰</p><p>éšåæŠŠå¹³æ¿å…³æœºï¼Œæ’å…¥æ•°æ®çº¿ï¼Œå¹³æ¿ä¼šè‡ªåŠ¨è¿›å…¥ç«¯å£ï¼Œä¸å‡ºæ„å¤–åˆ·å®Œåå¹³æ¿ä¼šè‡ªåŠ¨é‡å¯</p><p>ç­‰å¾…å¹³æ¿å¼€æœºåï¼ŒåŒå‡»<code>ç‚¹æˆ‘è§£é”bl.cmd</code>ï¼Œç­‰å¾…è‡ªåŠ¨è¿è¡Œ<img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/20250309195023300.png"></p><p>éšåå¹³æ¿ä¼šå‡ºç°è¿™ä¸ªï¼ŒæŒ‰éŸ³é‡ä¸Šç¡®è®¤ï¼Œå¦‚æœæ²¡ååº”å¤šæŒ‰å‡ æ¬¡</p><p><img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/20250309195059255.jpg"></p><p>ç„¶åblå°±è§£å®Œäº†ï¼Œå¦‚å›¾<img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/20250309195137033.jpg" alt="å‡ºç°è§£é”è­¦å‘Š"></p><p>æ¥ä¸‹æ¥æ˜¯åˆ·å›å®˜æ–¹çš„<strong>lk</strong>åˆ†åŒºï¼Œè¿›å…¥<strong>å®˜æ–¹æ–‡ä»¶</strong>æ–‡ä»¶å¤¹ï¼ŒæŠŠé‡Œé¢çš„<strong>lk_a</strong>ã€<strong>lk_b</strong>æ›¿æ¢åˆ°å·¥ç¨‹æ–‡ä»¶é‡Œï¼Œç„¶åæ‰“å¼€SPFlashToolV6ï¼Œç›´æ¥ç‚¹å‡»dowlnload<br><strong>æ³¨æ„ï¼šæ¥¼ä¸»æä¾›çš„lkåˆ†åŒºæ˜¯091ç‰ˆæœ¬çš„ï¼Œå…¶ä»–ç‰ˆæœ¬çš„è¯·è‡ªè¡Œå¯»æ‰¾ç›¸åº”ç‰ˆæœ¬çš„lkæ–‡ä»¶ï¼Œå¦‚æœä¸è¿˜åŸlkæ–‡ä»¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ— æ³•æ­£å¸¸otaæ›´æ–°</strong></p><p><strong>å…³äºå¦‚ä½•å¯»æ‰¾lkæ–‡ä»¶ï¼Œå¯ä»¥ä»çº¿åˆ·åŒ…ï¼Œå¡åˆ·åŒ…æå–ï¼Œä¹Ÿå¯ä»¥åœ¨åˆ·å‰ç”¨spv6å·¥å…·å›è¯»å¤‡ä»½lkåˆ†åŒº</strong></p><p>è¿˜åŸæˆåŠŸåå°±å®Œäº‹äº†ï¼Œè§£é”blæˆåŠŸï¼</p><h1 id="ç»“å°¾ï¼š"><a href="#ç»“å°¾ï¼š" class="headerlink" title="ç»“å°¾ï¼š"></a>ç»“å°¾ï¼š</h1><p>æ„Ÿè°¢xdaè®ºå›æ”¾å‡ºæ¥çš„å·¥ç¨‹åŒ…ï¼Œ<a href="https://xdaforums.com/t/unofficial-unlocking-lenovo-xiaoxin-pad-pro-2025-tb375fc.4717695/">åŸå¸–é“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>åˆ·æœºæ—¥å¸¸</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ·æœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åšå®¢æ—¥å¿—</title>
    <link href="/blog-note.html"/>
    <url>/blog-note.html</url>
    
    <content type="html"><![CDATA[<h1 id="2023-6"><a href="#2023-6" class="headerlink" title="2023.6"></a>2023.6</h1><p>2023.6.22å¼€å§‹è¿è¥</p><h1 id="2023-7"><a href="#2023-7" class="headerlink" title="2023.7"></a>2023.7</h1><p>2023.7å…³äºé¡µé¢å‡ºç°é—®é¢˜ï¼Œæ‡’å¾—ä¿®å¤</p><h1 id="2023-8"><a href="#2023-8" class="headerlink" title="2023.8"></a>2023.8</h1><p>2023.8è¯„è®ºç³»ç»Ÿå‡ºç°é”™è¯¯</p><p>2023.8å›¾åºŠå‡ºç°é”™è¯¯</p><h1 id="2023-9"><a href="#2023-9" class="headerlink" title="2023.9"></a>2023.9</h1><p>2023.9å›¾åºŠä¿®å¤</p><h1 id="2023-10"><a href="#2023-10" class="headerlink" title="2023.10"></a>2023.10</h1><p>2023.10.1ä¿®å¤è¯„è®ºç³»ç»Ÿ</p><p>2023.10.2<br>é‡æ„æ•´ä¸ªåšå®¢çš„ç»“æ„<br>ç½‘ç›˜ï¼ˆå›¾åºŠï¼‰ä¼˜åŒ–è®¿é—®é€Ÿåº¦<br>4:03 ä¸ºåšå®¢è¯„è®ºç³»ç»Ÿæ·»åŠ é‚®ç®±é€šçŸ¥ï¼Œæ”¶å·¥ç¡è§‰</p><h1 id="2023-11"><a href="#2023-11" class="headerlink" title="2023.11"></a>2023.11</h1><p>11.05<br>cdnæ›´æ¢ä¸ºgcoreï¼Œå›½å†…è®¿é—®é€Ÿåº¦å¾—åˆ°å¤§å¹…åº¦æå‡</p><p>11.19<br>å¢åŠ äº†å°æ¸¸æˆåˆé›†ï¼Œ<br>æ·»åŠ æ¸¸æˆæœ‰2048ï¼ŒçŒ«é‡Œå¥¥ï¼Œå¤å¤å°æ¸¸æˆ</p><p>å¢åŠ ç•™è¨€æ¿</p><h1 id="2025-03"><a href="#2025-03" class="headerlink" title="2025.03"></a>2025.03</h1><p>3.02<br>åŸŸåè¿‡æœŸï¼Œæ¢å›cloudflare<br>åˆ é™¤å°æ¸¸æˆé¢æ¿<br>é‡æ–°é­”æ”¹ä¸»é¢˜</p>]]></content>
    
    
    <categories>
      
      <category>[object Object]</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>é…ç½®walineçš„è¯„è®ºé‚®ä»¶æé†’</title>
    <link href="/build-waline.html"/>
    <url>/build-waline.html</url>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>  é…ç½®å¥½hexoï¼‹fluidä¸»é¢˜åï¼Œå‘ç°åšå®¢æ²¡æœ‰æè¯„è®ºç³»ç»Ÿï¼Œä¸èƒ½å‹å¥½åœ°è·Ÿè·¯è¿‡çš„ç½‘å‹äº’åŠ¨ï¼Œæ‰€ä»¥å°±èŠ±åŠå¤©æ—¶é—´æ•´äº†è¯„è®ºç³»ç»Ÿã€‚</p><h3 id="ä½¿ç”¨vercelæ­å»º"><a href="#ä½¿ç”¨vercelæ­å»º" class="headerlink" title="ä½¿ç”¨vercelæ­å»º"></a>ä½¿ç”¨vercelæ­å»º</h3><p> å®é™…ä¸Šï¼Œå®˜æ–¹æ–‡æ¡£è®²çš„å·²ç»å¾ˆè¯¦ç»†ï¼Œå¯ä»¥è‡ªå·±å»çœ‹çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œç‚¹å‡»<a href="https://waline.js.org/guide/get-started/">ä¼ é€é—¨</a>å‰å¾€å®˜æ–¹æ–‡æ¡£</p><p> æœ¬ç¯‡æ–‡ç« åªè®²æ€ä¹ˆé…ç½®è¯„è®ºé€šçŸ¥</p><h3 id="é…ç½®é‚®ä»¶é€šçŸ¥"><a href="#é…ç½®é‚®ä»¶é€šçŸ¥" class="headerlink" title="é…ç½®é‚®ä»¶é€šçŸ¥"></a>é…ç½®é‚®ä»¶é€šçŸ¥</h3><p> ä»¥ä¸‹æ˜¯é‚®ä»¶é…ç½®æ—¶éœ€è¦åœ¨vercelå¢åŠ çš„å˜é‡</p><ul><li><code>SMTP_SERVICE</code>: SMTP é‚®ä»¶å‘é€æœåŠ¡æä¾›å•†ã€‚</li></ul><p>æç¤º</p><p><code>SMTP_SERVICE</code>çš„å˜é‡ä¸ºå¼•å·ä¸­çš„å€¼ï¼Œä¾‹å¦‚æˆ‘ä½¿ç”¨çš„æ˜¯163é‚®ç®±ï¼Œæ ¹æ®æ–‡ä»¶çš„å®šä¹‰æ­¤æ—¶çš„å˜é‡å€¼åº”ä¸º<code>163</code></p><p>ä½ å¯ä»¥åœ¨ <a href="https://github.com/nodemailer/nodemailer/blob/master/lib/well-known/services.json">è¿™é‡Œ</a> æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„è¿è¥å•†ã€‚</p><p>å¦‚æœä½ çš„è¿è¥å•†ä¸å—æ”¯æŒï¼Œä½ å¿…é¡»å¡«å†™ <code>SMTP_HOST</code> å’Œ <code>SMTP_PORT</code>ã€‚</p><ul><li><p><code>SMTP_HOST</code>: SMTP æœåŠ¡å™¨åœ°å€ï¼Œä¸€èˆ¬å¯ä»¥åœ¨é‚®ç®±çš„è®¾ç½®ä¸­æ‰¾åˆ°ã€‚</p></li><li><p><code>SMTP_PORT</code>: SMTP æœåŠ¡å™¨ç«¯å£ï¼Œä¸€èˆ¬å¯ä»¥åœ¨é‚®ç®±çš„è®¾ç½®ä¸­æ‰¾åˆ°ã€‚</p></li><li><p><code>SMTP_USER</code>: SMTP é‚®ä»¶å‘é€æœåŠ¡çš„ç”¨æˆ·åï¼Œä¸€èˆ¬ä¸ºç™»å½•é‚®ç®±ã€‚</p></li><li><p><code>SMTP_PASS</code>: SMTP é‚®ä»¶å‘é€æœåŠ¡çš„å¯†ç ï¼Œä¸€èˆ¬ä¸ºé‚®ç®±ç™»å½•å¯†ç ï¼Œéƒ¨åˆ†é‚®ç®±(ä¾‹å¦‚ 163)æ˜¯å•ç‹¬çš„ SMTP å¯†ç ã€‚<br><code> ps:ä½¿ç”¨ç½‘æ˜“163é‚®ç®±éœ€è¦ç™»é™†ç½‘é¡µç‰ˆå¼€å¯smtpï¼Œå¼€å¯åå®ƒä¼šç»™ä½ ä¸€ä¸ªå…¨æ˜¯å¤§å†™å­—æ¯çš„å¯†åŒ™ï¼Œè¿™ä¸ªå¯†åŒ™å°±æ˜¯`SMTP_PASS` çš„å€¼</code></p></li><li><p><code>SITE_NAME</code>: ç½‘ç«™åç§°ï¼Œç”¨äºåœ¨æ¶ˆæ¯ä¸­æ˜¾ç¤ºã€‚</p></li><li><p><code>SITE_URL</code>: ç½‘ç«™åœ°å€ï¼Œç”¨äºåœ¨æ¶ˆæ¯ä¸­æ˜¾ç¤ºã€‚</p></li><li><p><code>AUTHOR_EMAIL</code>: åšä¸»é‚®ç®±ï¼Œç”¨æ¥æ¥æ”¶æ–°è¯„è®ºé€šçŸ¥ã€‚å¦‚æœæ˜¯åšä¸»å‘å¸ƒçš„è¯„è®ºåˆ™ä¸è¿›è¡Œæé†’é€šçŸ¥ã€‚</p></li></ul><h3 id="æ“ä½œæµç¨‹"><a href="#æ“ä½œæµç¨‹" class="headerlink" title="æ“ä½œæµç¨‹"></a>æ“ä½œæµç¨‹</h3><h4 id="è¿›å…¥vercelï¼Œå¹¶æ‰“å¼€å½“å‰åº”ç”¨çš„è¯„è®ºé¡¹ç›®"><a href="#è¿›å…¥vercelï¼Œå¹¶æ‰“å¼€å½“å‰åº”ç”¨çš„è¯„è®ºé¡¹ç›®" class="headerlink" title="è¿›å…¥vercelï¼Œå¹¶æ‰“å¼€å½“å‰åº”ç”¨çš„è¯„è®ºé¡¹ç›®"></a>è¿›å…¥vercelï¼Œå¹¶æ‰“å¼€å½“å‰åº”ç”¨çš„è¯„è®ºé¡¹ç›®</h4><p>ä¾æ¬¡ç‚¹å‡»<code>Settings</code> <code>Environment Variables</code><br><img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/images/waline2.png"></p><p>è¿›å…¥å˜é‡é…ç½®åï¼Œåˆ†åˆ«å¡«å†™ä»¥ä¸Šåˆ—å‡ºçš„å˜é‡<img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/images/waline3.png"><br>å®Œæˆé…ç½®åï¼Œé‡æ–°éƒ¨ç½²ä¸€ä¸‹ï¼ŒåŸºæœ¬èƒ½ç”¨ï¼Œä½†æ˜¯ä¸å®Œæ•´ <img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/images/waline4.png"><br>æ­¤æ—¶å†æ‰“å¼€<a href="https://github.com/">github</a>ä¸Šè¿™ä¸ªé¡¹ç›®è‡ªåŠ¨ç”Ÿæˆçš„ä»“åº“</p><p>é¡¹ç›®å†…æœ‰ä¸€ä¸ª<code>index.js</code>çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Application</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@waline/vercel&#x27;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">Application</span>(&#123;<br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">postSave</span>(<span class="hljs-params">comment</span>) &#123;<br>    <span class="hljs-comment">//do what ever you want after save comment</span><br>  &#125;<br>&#125;);<br><br></code></pre></td></tr></table></figure><p>ç„¶åå°†æ•´ä¸ªå†…å®¹æ›¿æ¢æˆ</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">const Application = require(&#x27;@waline/vercel&#x27;);</span><br><span class="language-xml"></span><br><span class="language-xml">module.exports = Application(&#123;</span><br><span class="language-xml">  mailSubject: &#x27;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">parent.nick</span>&#125;&#125;</span><span class="language-xml">ï¼ŒğŸ‘‰ å®å’šï¼æ‚¨åœ¨åšå®¢ã€Œ</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">site.name</span>&#125;&#125;</span><span class="language-xml">ã€ä¸Šçš„è¯„è®ºæ”¶åˆ°äº†å›å¤&#x27;,</span><br><span class="language-xml">  mailTemplate: `</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-top:2px solid #12ADDB;box-shadow:0 1px 3px #AAAAAA;line-height:180%;padding:0 15px 12px;margin:50px auto;font-size:12px;&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-bottom:1px solid #DDD;font-size:14px;font-weight:normal;padding:13px 0 10px 8px;&quot;</span>&gt;</span>        </span><br><span class="language-xml">        ğŸ‘‰ å®å’šï¼æ‚¨åœ¨åšå®¢<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none;color: #12ADDB;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;</span></span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">site.url</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">site.name</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>ä¸Šçš„è¯„è®ºæœ‰äº†æ–°çš„å›å¤</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding:0 12px 0 12px;margin-top:18px&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">parent.nick</span>&#125;&#125;</span><span class="language-xml">ï¼Œæ‚¨æ›¾å‘è¡¨è¯„è®ºï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-color: #f5f5f5;padding: 10px 15px;margin:18px 0;word-wrap:break-word;&quot;</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">parent.comment</span> | safe&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">self.nick</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> å›å¤è¯´ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-color: #f5f5f5;padding: 10px 15px;margin:18px 0;word-wrap:break-word;&quot;</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">self.comment</span> | safe&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ‚¨å¯ä»¥ç‚¹å‡»<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none; color:#12addb&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;</span></span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">site.postUrl</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>å‰å¾€åŸæ–‡æŸ¥çœ‹å®Œæ•´çš„å›å¤å…§å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>ï¼Œæ¬¢è¿å†æ¬¡å…‰ä¸´<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none; color:#12addb&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;</span></span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">site.url</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">site.name</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-top:1px solid #DDD; padding:13px 0 0 8px;&quot;</span>&gt;</span></span><br><span class="language-xml">è¯¥é‚®ä»¶ä¸ºç³»ç»Ÿè‡ªåŠ¨å‘é€çš„é‚®ä»¶ï¼Œè¯·å‹¿ç›´æ¥å›å¤ã€‚</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>`,</span><br><span class="language-xml">  mailSubjectAdmin: &#x27;ğŸ‘‰ å®å’šï¼æ‚¨çš„åšå®¢ã€Œ</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">site.name</span>&#125;&#125;</span><span class="language-xml">ã€æ”¶åˆ°äº†æ–°è¯„è®º&#x27;,</span><br><span class="language-xml">  mailTemplateAdmin: `</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-top:2px solid #12ADDB;box-shadow:0 1px 3px #AAAAAA;line-height:180%;padding:0 15px 12px;margin:50px auto;font-size:12px;&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-bottom:1px solid #DDD;font-size:14px;font-weight:normal;padding:13px 0 10px 8px;&quot;</span>&gt;</span>        </span><br><span class="language-xml">        æœ‰äººåœ¨<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none;color: #12ADDB;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;</span></span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">site.url</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">site.name</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>å‘è¡¨äº†æ–°çš„è¯„è®º</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding:0 12px 0 12px;margin-top:18px&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">self.nick</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> è¯„è®ºè¯´ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-color: #f5f5f5;padding: 10px 15px;margin:18px 0;word-wrap:break-word;&quot;</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">self.comment</span> | safe&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ‚¨å¯ä»¥ç‚¹å‡»<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-decoration:none; color:#12addb&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;</span></span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">site.postUrl</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span>&gt;</span>å‰å¾€åŸæ–‡æŸ¥çœ‹å®Œæ•´çš„è¯„è®ºå†…å®¹ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-top:1px solid #DDD; padding:13px 0 0 8px;&quot;</span>&gt;</span></span><br><span class="language-xml">è¯¥é‚®ä»¶ä¸ºç³»ç»Ÿè‡ªåŠ¨å‘é€çš„é‚®ä»¶ï¼Œè¯·å‹¿ç›´æ¥å›å¤ã€‚</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>`</span><br><span class="language-xml">&#125;);</span><br><span class="language-xml"></span><br><span class="language-xml"></span><br></code></pre></td></tr></table></figure><p>éšåå®ƒä¼šè‡ªåŠ¨éƒ¨ç½²åˆ°vercelï¼Œæ­¤æ—¶é‚®ä»¶é…ç½®å°±ç®—å®Œæˆäº†,é™„ä¸Šç»“æœå›¾<img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/images/waline5.png"><br><img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/images/waline6.png"></p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢å»ºè®¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åšå®¢</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨åšå®¢é¡µè„šæ·»åŠ ä¸€ä¸ªè¿è¡Œå¤©æ•°</title>
    <link href="/add-runningday.html"/>
    <url>/add-runningday.html</url>
    
    <content type="html"><![CDATA[<p>æ„Ÿè§‰è‡ªå·±åšå®¢æœ‰ç‚¹ç®€æ´(ç®€é™‹)ï¼Œæ‰€ä»¥åœ¨é¡µè„šæ·»åŠ ä¸€ä¸ªè¿è¡Œå¤©æ•°è¯•å›¾æŒ½æ•‘</p><p>æœ¬åšå®¢ä½¿ç”¨çš„ä¸»é¢˜ä¸ºFluidï¼Œå…¶ä»–ä¸»é¢˜ä¸ä¿è¯å¯è¡Œ</p><p>é¦–å…ˆåœ¨åšå®¢ç›®å½•ä¸‹è¿›å…¥ <code>/source</code>ï¼Œç„¶åæ–°å»ºä¸€ä¸ª <code>js</code>æ–‡ä»¶å¤¹ï¼Œè¿›å…¥jsæ–‡ä»¶å¤¹æ–°å»º <code>runningday.js</code></p><p>ç¼–è¾‘ <code>runningday.js</code>å¹¶ä¿å­˜</p><p><img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/images/runningday.jpg"></p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs arcade">!(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">/** è®¡æ—¶èµ·å§‹æ—¶é—´ï¼Œè‡ªè¡Œä¿®æ”¹ **/</span><br>  <span class="hljs-keyword">var</span> start = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">&quot;2023/06/22 00:00:00&quot;</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-built_in">now</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();<br>    <span class="hljs-built_in">now</span>.setTime(<span class="hljs-built_in">now</span>.getTime()+<span class="hljs-number">250</span>);<br>    days = (<span class="hljs-built_in">now</span> - start) / <span class="hljs-number">1000</span> / <span class="hljs-number">60</span> / <span class="hljs-number">60</span> / <span class="hljs-number">24</span>;<br>    dnum = Math.<span class="hljs-built_in">floor</span>(days);<br>    hours = (<span class="hljs-built_in">now</span> - start) / <span class="hljs-number">1000</span> / <span class="hljs-number">60</span> / <span class="hljs-number">60</span> - (<span class="hljs-number">24</span> * dnum);<br>    hnum = Math.<span class="hljs-built_in">floor</span>(hours);<br>    <span class="hljs-keyword">if</span>(String(hnum).<span class="hljs-built_in">length</span> === <span class="hljs-number">1</span> )&#123;<br>      hnum = <span class="hljs-string">&quot;0&quot;</span> + hnum;<br>    &#125;<br>    minutes = (<span class="hljs-built_in">now</span> - start) / <span class="hljs-number">1000</span> /<span class="hljs-number">60</span> - (<span class="hljs-number">24</span> * <span class="hljs-number">60</span> * dnum) - (<span class="hljs-number">60</span> * hnum);<br>    mnum = Math.<span class="hljs-built_in">floor</span>(minutes);<br>    <span class="hljs-keyword">if</span>(String(mnum).<span class="hljs-built_in">length</span> === <span class="hljs-number">1</span> )&#123;<br>      mnum = <span class="hljs-string">&quot;0&quot;</span> + mnum;<br>    &#125;<br>    seconds = (<span class="hljs-built_in">now</span> - start) / <span class="hljs-number">1000</span> - (<span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * dnum) - (<span class="hljs-number">60</span> * <span class="hljs-number">60</span> * hnum) - (<span class="hljs-number">60</span> * mnum);<br>    snum = Math.<span class="hljs-built_in">round</span>(seconds);<br>    <span class="hljs-keyword">if</span>(String(snum).<span class="hljs-built_in">length</span> === <span class="hljs-number">1</span> )&#123;<br>      snum = <span class="hljs-string">&quot;0&quot;</span> + snum;<br>    &#125;<br>    document.getElementById(<span class="hljs-string">&quot;timeDate&quot;</span>).innerHTML = <span class="hljs-string">&quot;è¿è¡Œå¤©æ•°&amp;nbsp&quot;</span>+dnum+<span class="hljs-string">&quot;&amp;nbspå¤©&quot;</span>;<br>  &#125;<br><br>  update();<br>  setInterval(update, <span class="hljs-number">1000</span>);<br>&#125;)();<br></code></pre></td></tr></table></figure><p>ç„¶åç¼–è¾‘åšå®¢ç›®å½•ä¸‹çš„ <code>_config.fluid.yml</code><img src="https://cdn.jsdelivr.net/gh/morannlx/Picturebed/images/runningday1.jpg"></p><p>åœ¨ <code>431</code>è¡Œä¸­æ·»åŠ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size: 0.85rem&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;timeDate&quot;</span>&gt;</span>è½½å…¥å¤©æ•°...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/js/runningday.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¿å­˜å¹¶éƒ¨ç½²å°±å¯ä»¥äº†</p><p>æ–¹æ³•å€Ÿé‰´è‡ª(<a href="https://hyh1370039199.gitee.io/post/2/#:~:text=Hexo-Fluid%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96-%E6%B7%BB%E5%8A%A0%E7%BD%91%E7%AB%99%E8%BF%90%E8%A1%8C%E6%97%B6%E9%95%BF%202022-07-30%20%E6%8A%80%E6%9C%AF%20Fluid,1.8.4%E7%89%88%E6%9C%AC%E4%BB%A5%E4%B8%8A%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E8%84%9A%E5%86%85%E5%AE%B9%E3%80%82%20%E9%9C%80%E8%A6%81%E5%9C%A8%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE%E4%B8%AD%E7%9A%84%20footer%EF%BC%9Acontent%20%E6%B7%BB%E5%8A%A0%EF%BC%9A">Hexo-Fluid ä¸»é¢˜ç¾åŒ– - æ·»åŠ ç½‘ç«™è¿è¡Œæ—¶é•¿ | Blog (gitee.io)</a>)</p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢å»ºè®¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¹²è´§</tag>
      
      <tag>åšå®¢</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
